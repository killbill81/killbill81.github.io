import{h as b,q as h,c as y,d as l,w as f,g as C,l as v,a as g,f as w,o as L}from"./main--zY2HtAH.js";function H(){const e=E();return x(),()=>{typeof e=="function"&&e()}}async function x(){const e=document.getElementById("received-shares-container"),o=b();if(!(!o||!e)){e.innerHTML='<p class="text-gray-500">Chargement des partages reçus...</p>';try{const r=h(y(l,"plans"),f("userId","==",o),f("isShared","==",!0)),c=h(y(l,"plans"),f("collaborators","array-contains",o)),[s,d]=await Promise.all([C(r),C(c)]);let n=[];if(s.forEach(t=>n.push({id:t.id,type:"Planification (Copie)",...t.data()})),d.forEach(t=>n.push({id:t.id,type:"Planification (Collaboratif)",...t.data()})),n.length===0){e.innerHTML=`<p class="text-gray-500">Vous n'avez aucun contenu partagé par d'autres utilisateurs.</p>`;return}n.sort((t,a)=>(a.sharedAt?.seconds||a.lastUpdated?.seconds||0)-(t.sharedAt?.seconds||t.lastUpdated?.seconds||0)),e.innerHTML="";for(const t of n){const a=t.originalOwnerId||t.userId;if(!a)continue;const i=await v(g(l,"users",a)),u=i.exists()?i.data().displayName:"Utilisateur inconnu";e.appendChild(D(t,u))}}catch(r){console.error("Erreur lors du chargement des partages reçus : ",r),e.innerHTML='<p class="text-red-500">Une erreur est survenue.</p>'}}}function D(e,o){const r=document.createElement("div");r.className="bg-white rounded-lg p-4 flex justify-between items-center shadow-sm";const c=document.createElement("div"),s=document.createElement("p");s.className="font-bold text-gray-800";let d="";e.type.includes("Collaboratif")?d=' <span class="text-xs font-medium bg-blue-100 text-blue-800 px-2 py-1 rounded-full">Collab</span>':e.type.includes("Copie")&&(d=' <span class="text-xs font-medium bg-gray-200 text-gray-800 px-2 py-1 rounded-full">Copie</span>'),s.innerHTML=`${e.name}${d}`;const n=document.createElement("p");n.className="text-sm text-gray-500 mt-1";const t=e.sharedAt?new Date(e.sharedAt.seconds*1e3).toLocaleDateString("fr-FR"):e.lastUpdated?new Date(e.lastUpdated.seconds*1e3).toLocaleDateString("fr-FR"):"date inconnue";n.textContent=`Partagé par ${o} le ${t}`,c.appendChild(s),c.appendChild(n),r.appendChild(c);const a=document.createElement("button");return a.className="btn btn-ghost text-red-500 btn-sm",a.innerHTML='<i class="fas fa-trash"></i>',a.title="Supprimer ce contenu partagé",a.addEventListener("click",()=>S(e.id,e.type)),r.appendChild(a),r}async function S(e,o){if(confirm(`Voulez-vous vraiment supprimer cette ${o.toLowerCase()} partagée ?`))try{const r=o.startsWith("Planification")?"plans":"shopping_lists",c=g(l,r,e),s=await v(c);s.exists()&&s.data().userId===b()?(await w(c),x()):(alert("Vous n'avez pas la permission de supprimer cet élément ou il a déjà été supprimé."),x())}catch(r){console.error("Erreur de suppression: ",r),alert("Une erreur est survenue.")}}async function E(){const e=document.getElementById("sent-shares-container"),o=b();if(!o||!e)return()=>{};e.innerHTML='<p class="text-gray-500">Chargement des partages envoyés...</p>';const r=y(l,"shares"),c=h(r,f("senderId","==",o));return L(c,async s=>{if(s.empty){e.innerHTML=`<p class="text-gray-500">Vous n'avez envoyé aucun partage.</p>`;return}const d=s.docs.sort((n,t)=>(t.data().createdAt?.seconds||0)-(n.data().createdAt?.seconds||0));e.innerHTML="";for(const n of d){const t=n.data();try{const a=await v(g(l,"users",t.receiverId));if(a.exists()){const i=a.data();e.appendChild(I(t,i.displayName,n.id))}}catch(a){console.error("Could not load receiver for sent share",a)}}},s=>{console.error("Erreur lors du chargement des partages envoyés : ",s),e&&(e.innerHTML='<p class="text-red-500">Une erreur est survenue.</p>')})}function I(e,o,r){const c=document.createElement("div");c.className="bg-white rounded-lg p-4 flex justify-between items-center shadow-sm";const s=document.createElement("div"),d=document.createElement("p");d.className="font-bold text-gray-800";let n=[];e.plan&&n.push("Planification"),e.shoppingList&&n.push("Liste de courses"),d.textContent=n.join(" et ");const t=document.createElement("p");t.className="text-sm text-gray-500";const a=new Date(e.createdAt.seconds*1e3).toLocaleDateString("fr-FR");t.textContent=`Envoyé à ${o} le ${a}`,s.appendChild(d),s.appendChild(t),c.appendChild(s);const i=document.createElement("div");i.className="flex items-center space-x-4";const u=document.createElement("span");u.textContent=e.status;let m="bg-gray-200 text-gray-800";switch(e.status){case"accepted":m="bg-green-100 text-green-800";break;case"declined":m="bg-red-100 text-red-800";break;case"pending":m="bg-yellow-100 text-yellow-800";break}u.className=`text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full ${m}`,i.appendChild(u);const p=document.createElement("button");return p.className="btn btn-ghost text-red-500 btn-sm",p.innerHTML='<i class="fas fa-trash"></i>',p.title="Annuler le partage",p.addEventListener("click",()=>N(r)),i.appendChild(p),c.appendChild(i),c}async function N(e){if(confirm("Voulez-vous vraiment annuler ce partage ? L'autre utilisateur ne le verra plus."))try{await w(g(l,"shares",e)),E()}catch(o){console.error("Erreur lors de la suppression du partage: ",o),alert("Une erreur est survenue.")}}export{H as default};
