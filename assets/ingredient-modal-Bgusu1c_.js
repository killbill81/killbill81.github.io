import{g as r,c as l,d as a,s as d,b as u,a as m}from"./firebase-config-DV_efyn3.js";class g{constructor(){this.units=["g","kg","ml","l","pièce(s)","c.à.s.","c.à.c.","pincée(s)"],this.onSuccessCallback=null,this.bindElements(),this.init()}bindElements(){this.modal||(this.modal=document.getElementById("ingredient-form-modal"),this.form=document.getElementById("ingredient-form"),this.title=document.getElementById("ingredient-modal-title"),this.idInput=document.getElementById("ingredient-id"),this.nameInput=document.getElementById("ingredient-name"),this.unitSelect=document.getElementById("ingredient-unit"),this.categorySelect=document.getElementById("ingredient-category"),this.imageUrlInput=document.getElementById("ingredient-image-url"),this.closeBtn=document.getElementById("close-ingredient-modal"),this.cancelBtn=document.getElementById("cancel-ingredient-btn"))}init(){this.eventsAttached=!1,this.attachEvents()}attachEvents(){!this.modal||this.eventsAttached||(this.closeBtn?.addEventListener("click",()=>this.close()),this.cancelBtn?.addEventListener("click",()=>this.close()),this.form?.addEventListener("submit",e=>this.handleSubmit(e)),this.setupSeasonalityBindings(),this.eventsAttached=!0)}setupSeasonalityBindings(){const e=this.modal.querySelectorAll(".season-checkbox"),o=this.modal.querySelectorAll(".month-checkbox");e.forEach(n=>{n.addEventListener("change",t=>{const i=t.target.value,s=t.target.checked;this.modal.querySelectorAll(`.month-checkbox[data-season="${i}"]`).forEach(h=>h.checked=s)})}),o.forEach(n=>{n.addEventListener("change",t=>{const i=t.target.dataset.season,s=this.modal.querySelector(`.season-checkbox[value="${i}"]`);if(t.target.checked)s&&(s.checked=!0);else{const c=this.modal.querySelectorAll(`.month-checkbox[data-season="${i}"]:checked`);s&&c.length===0&&(s.checked=!1)}})})}async open(e=null,o=null){if(this.bindElements(),!this.form){console.error("Ingredient Modal elements not found!");return}this.eventsAttached||this.attachEvents(),this.onSuccessCallback=o,this.form.reset(),this.unitSelect.innerHTML="",this.units.forEach(n=>{const t=document.createElement("option");t.value=n,t.textContent=n,this.unitSelect.appendChild(t)}),await this.populateCategories(),typeof e=="string"?this.prepareNew(e):e&&typeof e=="object"?this.prepareEdit(e):this.prepareNew(),this.modal.classList.remove("hidden")}async populateCategories(){try{const o=(await r(l(a,"ingredient_categories"))).docs.map(n=>n.data().name).sort();this.categorySelect.innerHTML="",o.forEach(n=>{const t=document.createElement("option");t.value=n,t.textContent=n,this.categorySelect.appendChild(t)})}catch(e){console.error("Error fetching categories for modal",e)}}prepareNew(e=""){this.title.textContent="Ajouter un ingrédient",this.idInput.value="",this.nameInput.value=e,this.unitSelect.value=this.units[0],this.modal.querySelectorAll('input[type="checkbox"]').forEach(o=>o.checked=!1)}prepareEdit(e){this.title.textContent="Modifier l'ingrédient",this.idInput.value=e.id,this.nameInput.value=e.name,this.unitSelect.value=e.unit||"",this.categorySelect.value=e.category||"",this.imageUrlInput.value=e.imageUrl||"";const o=e.seasons||[],n=e.months||[];["Printemps","Eté","Automne","Hiver"].forEach(t=>{const i=`season-${t.toLowerCase().replace("é","e")}`,s=document.getElementById(i);s&&(s.checked=o.includes(t))}),this.modal.querySelectorAll(".month-checkbox").forEach(t=>{t.checked=n.includes(t.value)})}close(){this.modal.classList.add("hidden")}async handleSubmit(e){e.preventDefault();const o=this.idInput.value,n=[];this.modal.querySelectorAll(".season-checkbox:checked").forEach(s=>{n.push(s.value)});const t=[];this.modal.querySelectorAll(".month-checkbox:checked").forEach(s=>{t.push(s.value)});const i={name:this.nameInput.value,unit:this.unitSelect.value,category:this.categorySelect.value,seasons:n,months:t,imageUrl:this.imageUrlInput.value||`https://tse2.mm.bing.net/th?q=${encodeURIComponent(this.nameInput.value)}%20ingredient&w=400&h=300&c=7&rs=1&p=0`};if(!i.name||!i.category){alert("Le nom et la catégorie sont requis.");return}try{o?await d(u(a,"ingredients",o),i):await m(l(a,"ingredients"),i),this.close(),this.onSuccessCallback&&await this.onSuccessCallback(i.name)}catch(s){console.error("Erreur de sauvegarde de l'ingrédient: ",s)}}}const f=new g;export{g as IngredientModalManager,f as ingredientModalManager};
