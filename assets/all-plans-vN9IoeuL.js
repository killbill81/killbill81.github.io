import{q as m,w as p,c as f,d as u,o as v,f as b,b as g}from"./firebase-config-9gANoKOS.js";import{g as x,n as h,d as y,a as C}from"./main-CPC2Lv91.js";async function E(e){if(confirm("Êtes-vous sûr de vouloir supprimer cette sauvegarde ? Cette action est définitive."))try{await b(g(u,"plan_saves",e))}catch(t){console.error("Erreur lors de la suppression de la sauvegarde:",t),alert("La suppression a échoué.")}}function T(){const e=document.getElementById("all-plans-list"),t=x();if(!t||!e)return e.innerHTML="<p>Erreur de chargement.</p>",()=>{};const l=m(f(u,"plan_saves"),p("userId","==",t)),r=v(l,a=>{if(e.innerHTML="",a.empty)e.innerHTML=`<p class="text-center text-gray-500 p-10 col-span-full">Vous n'avez aucune sauvegarde.</p>`;else{const o=a.docs.map(s=>({id:s.id,...s.data()}));o.sort((s,d)=>d.savedAt.toMillis()-s.savedAt.toMillis()),o.forEach(s=>{const d=w(s);e.appendChild(d)})}}),n=document.getElementById("archived-plans-list"),c=m(f(u,"plans"),p("archivedBy","array-contains",t));console.log("[Archives-Debug] Initialisation du listener pour:",t);const i=v(c,a=>{if(n){if(n.innerHTML="",console.log("[Archives-Debug] Snapshot reçu. Empty ?",a.empty,"Count:",a.size),a.empty){n.innerHTML='<p class="text-center text-gray-500 p-10 col-span-full">Aucun menu archivé.</p>';return}a.docs.forEach(o=>{const s={id:o.id,...o.data()};console.log("[Archives-Debug] Plan archivé trouvé:",s.name,s.id);const d=L(s);n.appendChild(d)})}});return()=>{r(),i()}}function w(e){const t=document.createElement("div");t.className="bg-white rounded-xl shadow-md p-4 flex flex-col justify-between";const l=e.savedAt?.toDate().toLocaleString("fr-FR")||"Date inconnue",r=e.planData;let n="Plan vide ou sans données.";if(r&&r.weeks){const s=Object.keys(r.weeks).length;s>0&&(n=`Contient ${s} semaine(s).`)}const c=document.createElement("div");c.innerHTML=`
        <h3 class="text-lg font-bold text-gray-800 mb-2 font-display">${e.name}</h3>
        <p class="text-sm text-gray-500"><i class="far fa-calendar-alt mr-2"></i>Sauvegardé le : ${l}</p>
        <p class="text-sm text-gray-600 mt-2">${n}</p>
    `;const i=document.createElement("div");i.className="mt-4 pt-4 border-t border-gray-200 flex items-center justify-end space-x-2";const a=document.createElement("button");a.className="text-red-500 hover:bg-red-100 text-sm px-3 py-1 rounded-md transition-colors",a.innerHTML='<i class="fas fa-trash"></i>',a.title="Supprimer la sauvegarde",a.addEventListener("click",()=>E(e.id));const o=document.createElement("button");return o.className="btn btn-secondary btn-sm",o.textContent="Consulter",o.addEventListener("click",()=>{localStorage.setItem("selectedPlanId",e.id),h("view-plan")}),i.appendChild(a),i.appendChild(o),t.appendChild(c),t.appendChild(i),t}function L(e){const t=document.createElement("div");t.className="bg-white rounded-xl shadow-md p-4 border-l-4 border-gray-300 flex flex-col justify-between";const l=document.createElement("div");l.innerHTML=`
        <h3 class="text-lg font-bold text-gray-800 mb-1 font-display">${e.name}</h3>
        <p class="text-xs text-gray-500 mb-2 uppercase tracking-wider font-semibold">Menu de travail archivé</p>
        <p class="text-sm text-gray-600 italic">Masqué du planning, mais utilisé par Chef Gusto pour la mémoire du menu.</p>
    `;const r=document.createElement("div");r.className="mt-4 pt-4 border-t border-gray-200 flex items-center justify-end space-x-2";const n=document.createElement("button");n.className="text-red-500 hover:bg-red-100 text-sm px-3 py-1 rounded-md transition-colors",n.innerHTML='<i class="fas fa-trash"></i>',n.title="Supprimer définitivement",n.addEventListener("click",async()=>{confirm(`Voulez-vous supprimer DÉFINITIVEMENT le menu "${e.name}" ? Cette action est irréversible et Chef Gusto perdra l'historique de ce menu.`)&&await y(e.id)});const c=document.createElement("button");c.className="btn btn-primary btn-sm",c.innerHTML='<i class="fas fa-box-open mr-2"></i>Désarchiver',c.addEventListener("click",async()=>{confirm(`Voulez-vous remettre le menu "${e.name}" dans votre liste de plannings actifs ?`)&&await C(e.id,!1)});const i=document.createElement("button");return i.className="btn btn-secondary btn-sm",i.textContent="Consulter",i.addEventListener("click",()=>{localStorage.setItem("selectedPlanId",e.id),localStorage.setItem("selectedPlanCollection","plans"),h("view-plan")}),r.appendChild(n),r.appendChild(i),r.appendChild(c),t.appendChild(l),t.appendChild(r),t}export{T as default};
