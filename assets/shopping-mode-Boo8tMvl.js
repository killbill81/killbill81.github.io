const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/main-BGm1g1S0.js","assets/firebase-config-CDPbqvnt.js","assets/login-T7ppBFTz.css"])))=>i.map(i=>d[i]);
import{_ as Z,a as W}from"./main-BGm1g1S0.js";import{a as F,o as X,g as G,c as O,i as ee}from"./firebase-config-CDPbqvnt.js";const T=ee();let S=null,L=null,K=[],R=[],P={};function q(u){return u?u.replace(/\./g,"_"):""}function oe(){let u=document.getElementById("shopping-mode-container");const B=document.getElementById("shopping-mode-plan-select");document.getElementById("shopping-mode-trash-btn");const z=document.getElementById("shopping-trash-modal");let _=null;function A(e){const t=document.getElementById("shopping-mode-trash-btn"),n=document.getElementById("shopping-trash-modal");t&&t.classList.add("hidden"),n&&n.classList.add("hidden")}function V(){console.log("[DEBUG] Resetting UI and State"),L=null,u&&(u.innerHTML='<div class="flex justify-center p-10"><i class="fas fa-spinner fa-spin text-tomato text-2xl"></i></div>'),z&&z.classList.add("hidden"),A()}function Q(e){console.log(`[DEBUG] loadPlan called for: ${e}`),_=e,S&&(console.log("[DEBUG] Unsubscribing from previous plan"),S(),S=null),V();const t=F(T,"plans",e);S=X(t,n=>{if(console.log(`[DEBUG] Snapshot received for doc: ${n.id}`),_!==e){console.warn(`[DEBUG] Ignored snapshot for ${e} because active is ${_}`);return}n.exists()?(console.log(`[DEBUG] Plan data found for ID: ${n.id}`),L={id:n.id,...n.data()},P=L.checkedItems||{},j()):(console.log("[DEBUG] Plan not found"),u&&(u.innerHTML='<p class="text-center p-4 text-red-500">Plan introuvable.</p>'))})}function j(){if(!L||!u){console.log("[DEBUG] renderShoppingList aborted: missing plan or container");return}console.log(`[DEBUG] Rendering shopping list for plan: ${L.name} (${L.id})`);const{active:e}=Y(L);A(),u.innerHTML="";const t=[],n=[];if(e.forEach(o=>{const s=`${o.name}_${o.unit||""}`,r=q(s);(P.hasOwnProperty(r)?P[r]:P[s]||!1)?n.push(o):t.push(o)}),t.length===0&&n.length===0){u.innerHTML='<p class="text-center p-10 text-gray-500">Votre liste de courses est vide pour ce plan.</p>';return}const I=t.reduce((o,s)=>{const r=s.category||"Inconnue";return o[r]||(o[r]=[]),o[r].push(s),o},{}),h=Object.keys(I).sort((o,s)=>o==="Inconnue"?1:s==="Inconnue"?-1:o.localeCompare(s)),a=document.createElement("div");a.id="shopping-category-tabs",a.className="flex overflow-x-auto space-x-2 py-2 bg-white z-20 mb-4",u.appendChild(a);const E=o=>"category-"+o.replace(/[^a-zA-Z0-9]/g,"-").toLowerCase();if(h.forEach(o=>{const s=document.createElement("button");s.className="btn btn-sm btn-outline flex-shrink-0",s.textContent=o,s.onclick=()=>{const r=document.getElementById(E(o));if(r){const c=document.querySelector("header"),i=c?c.offsetHeight:0,f=r.getBoundingClientRect().top+window.pageYOffset-i-40;window.scrollTo({top:f,behavior:"smooth"})}},a.appendChild(s)}),h.forEach(o=>{const s=document.createElement("h3");s.className="font-bold text-lg text-gray-700 mt-6 mb-3 border-b border-gray-200 pb-1 sticky top-0 bg-white z-10",s.textContent=o,s.id=E(o),u.appendChild(s);const r=document.createElement("ul");r.className="space-y-3",I[o].sort((c,i)=>c.name.localeCompare(i.name)).forEach(c=>{const i=`${c.name}_${c.unit||""}`,d=q(i),f=P.hasOwnProperty(d)?P[d]:P[i]||!1,p=c.hasManualEntry===!0||!c.sources||c.sources.length===0,y=document.createElement("li");p&&(y.dataset.isManual="true",y.style.backgroundColor="#ffedd5");const w=f?"bg-gray-100":p?"bg-orange-100 shadow-sm border border-orange-200":"bg-white shadow-sm border border-gray-100";y.className=`flex flex-col p-3 rounded-lg transition-colors duration-200 ${w}`;const $=document.createElement("div");$.className="flex items-center w-full";const l=document.createElement("input");l.type="checkbox",l.className="form-checkbox h-6 w-6 text-tomato rounded-full border-gray-300 focus:ring-tomato cursor-pointer transition duration-150 ease-in-out",l.checked=f;const b=document.createElement("div");b.className="ml-3 flex-grow cursor-pointer select-none";const D=Number.isInteger(c.totalQuantity)?c.totalQuantity:parseFloat(c.totalQuantity.toFixed(2)),m=document.createElement("span");m.className=`font-medium text-base ${f?"line-through text-gray-400":"text-gray-800"}`,m.textContent=c.name;const C=document.createElement("span");C.className=`ml-2 font-bold text-base ${f?"text-gray-400":"text-gray-800"}`,C.textContent=` - ${D} ${c.unit||""}`.trim(),b.appendChild(m),b.appendChild(C);const M=()=>{const g=!l.checked;l.checked=g,U(d,g,y,l,m,C)};if(l.addEventListener("change",g=>{U(d,g.target.checked,y,l,m,C)}),b.addEventListener("click",M),$.appendChild(l),$.appendChild(b),y.appendChild($),c.sources&&c.sources.length>0){const g=document.createElement("div");g.className="mt-2 ml-9 text-xs text-gray-500 space-y-1";const k=c.sources.reduce((x,v)=>{const H=`${v.recipeName} (${v.day} ${v.time})`;return x[H]||(x[H]=0),x[H]+=v.quantity,x},{});for(const x in k){const v=document.createElement("div");v.textContent=`↳ ${x}`,g.appendChild(v)}y.appendChild(g)}r.appendChild(y)}),u.appendChild(r)}),n.length>0){const o=document.createElement("div");o.className="my-8 border-t-2 border-dashed border-gray-300 pt-4 text-center";const s=document.createElement("h3");s.className="text-lg font-semibold text-gray-500",s.textContent="Articles cochés",o.appendChild(s),u.appendChild(o);const r=n.reduce((i,d)=>{const f=d.category||"Inconnue";return i[f]||(i[f]=[]),i[f].push(d),i},{});Object.keys(r).sort((i,d)=>i==="Inconnue"?1:d==="Inconnue"?-1:i.localeCompare(d)).forEach(i=>{const d=document.createElement("h3");d.className="font-bold text-lg text-gray-700 mt-6 mb-3 border-b border-gray-200 pb-1",d.textContent=i,u.appendChild(d);const f=document.createElement("ul");f.className="space-y-3",r[i].sort((p,y)=>p.name.localeCompare(y.name)).forEach(p=>{const y=`${p.name}_${p.unit||""}`,w=q(y),$=!0,l=p.hasManualEntry===!0||!p.sources||p.sources.length===0,b=document.createElement("li");l&&(b.dataset.isManual="true"),b.className="flex flex-col p-3 rounded-lg transition-colors duration-200 bg-gray-100";const D=document.createElement("div");D.className="flex items-center w-full";const m=document.createElement("input");m.type="checkbox",m.className="form-checkbox h-6 w-6 text-tomato rounded-full border-gray-300 focus:ring-tomato cursor-pointer transition duration-150 ease-in-out",m.checked=$;const C=document.createElement("div");C.className="ml-3 flex-grow cursor-pointer select-none";const M=Number.isInteger(p.totalQuantity)?p.totalQuantity:parseFloat(p.totalQuantity.toFixed(2)),g=document.createElement("span");g.className="font-medium text-base line-through text-gray-400",g.textContent=p.name;const k=document.createElement("span");k.className="ml-2 font-bold text-base text-gray-400",k.textContent=` - ${M} ${p.unit||""}`.trim(),C.appendChild(g),C.appendChild(k);const x=()=>{const v=!m.checked;m.checked=v,U(w,v,b,m,g,k)};m.addEventListener("change",v=>{U(w,v.target.checked,b,m,g,k)}),C.addEventListener("click",x),D.appendChild(m),D.appendChild(C),b.appendChild(D),f.appendChild(b)}),u.appendChild(f)})}}function U(e,t,n,I,h,a){if(!L)return;const E=n.dataset.isManual==="true";t?(n.classList.remove("bg-white","bg-orange-100","shadow-sm","border","border-gray-100","border-orange-200"),n.classList.add("bg-gray-100"),n.style.backgroundColor="",h.classList.add("line-through","text-gray-400"),h.classList.remove("text-gray-800"),a.classList.add("text-gray-400"),a.classList.remove("text-gray-800")):(n.classList.remove("bg-gray-100"),E?(n.classList.add("bg-orange-100","shadow-sm","border","border-orange-200"),n.style.backgroundColor="#ffedd5"):(n.classList.add("bg-white","shadow-sm","border","border-gray-100"),n.style.backgroundColor=""),h.classList.remove("line-through","text-gray-400"),h.classList.add("text-gray-800"),a.classList.remove("text-gray-400"),a.classList.add("text-gray-800"));const o=F(T,"plans",L.id),s={};s[`checkedItems.${e}`]=t,s.lastUpdated=new Date,Z(()=>import("./main-BGm1g1S0.js").then(r=>r.d),__vite__mapDeps([0,1,2])).then(r=>{r.updateDoc(o,s)}).catch(r=>{console.error("Error updating checked item:",r)})}function Y(e){const t=new Map;(e.manualItems||[]).forEach(a=>{const E=`${a.name.trim().toLowerCase()}_${a.unit||""}`;t.set(E,{name:a.name.trim(),totalQuantity:a.totalQuantity,unit:a.unit,category:a.category||"Inconnue",hasManualEntry:!0})});const I=["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"];if(e.weeks)for(const a in e.weeks){const E=e.weeks[a],o=E.menuData||{},s=E.servingsData||{};for(const r in o){const c=o[r];if(!Array.isArray(c))continue;const[i,d]=r.split("-"),f=`${i}-${d}`,p=parseInt(s[f]||e.defaultNumPeople||1,10);c.forEach(y=>{const w=K.find(l=>l.id===y.id)||y;if(!w||!w.ingredients)return;const $=w.servings||1;w.ingredients.forEach(l=>{if(!l.name||!l.quantity)return;const b=R.find(x=>x.name.toLowerCase()===l.name.toLowerCase()),D=b?b.category:"Inconnue",m=parseFloat(String(l.quantity).replace(",","."));if(isNaN(m))return;const M=m/$*p,g=l.unit||"",k=`${l.name.trim().toLowerCase()}_${g}`;if(t.has(k)){const x=t.get(k);x.totalQuantity+=M,x.sources||(x.sources=[]),x.sources.push({recipeName:w.name,day:I[parseInt(i,10)],time:d==="lunch"?"Midi":"Soir",quantity:M})}else t.set(k,{name:l.name.trim(),totalQuantity:M,unit:g,category:D,sources:[{recipeName:w.name,day:I[parseInt(i,10)],time:d==="lunch"?"Midi":"Soir",quantity:M}]})})})}}const h=[];return t.forEach(a=>{a.totalQuantity>0&&h.push(a)}),{active:h}}const N=document.createElement("button");if(N.id="scroll-to-top-btn",N.className="hidden fixed bottom-20 right-5 bg-tomato text-white rounded-full w-12 h-12 shadow-lg z-50",N.innerHTML='<i class="fas fa-arrow-up"></i>',document.body.appendChild(N),window.addEventListener("scroll",()=>{window.pageYOffset>200?N.classList.remove("hidden"):N.classList.add("hidden")}),N.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}),B){const e=B.cloneNode(!0);B.parentNode.replaceChild(e,B),e.addEventListener("change",t=>{const n=t.target.value;localStorage.setItem("lastActivePlanId",n),Q(n)})}async function J(){try{R=(await G(O(T,"ingredients"))).docs.map(t=>({id:t.id,...t.data()}))}catch(e){console.error("Error fetching ingredients",e)}try{K=(await G(O(T,"recipes"))).docs.map(t=>({id:t.id,...t.data()}))}catch(e){console.error("Error fetching recipes",e)}W(e=>{const t=document.getElementById("shopping-mode-plan-select");if(!t)return;const n=t.value;if(t.innerHTML="",e.length===0){u&&(u.innerHTML='<p class="text-center p-4">Aucun plan trouvé.</p>');return}e.forEach(a=>{const E=document.createElement("option");E.value=a.id,E.textContent=a.name,t.appendChild(E)});const I=localStorage.getItem("lastActivePlanId");let h=null;I&&e.some(a=>a.id===I)?h=I:e.length>0&&(h=e[0].id),h&&(n&&e.some(a=>a.id===n)?(t.value=n,L||Q(n)):(t.value=h,Q(h)))})}return J(),()=>{S&&S(),N&&N.remove()}}export{oe as default};
