import{h as v,c as I,d as p,b as L,l as g,a as y}from"./main--zY2HtAH.js";const e={modal:document.getElementById("share-modal"),closeBtn:document.getElementById("close-share-modal"),title:document.getElementById("share-modal-title"),friendsList:document.getElementById("share-friends-list"),sharePlanCheckbox:document.getElementById("share-planning-checkbox"),shareShoppingListCheckbox:document.getElementById("share-shopping-list-checkbox"),confirmBtn:document.getElementById("confirm-share-btn")};let n={};function h(){e.modal.classList.add("hidden")}async function b(){const a=v();if(!a||!n.plan)return;const r=Array.from(e.friendsList.querySelectorAll('input[type="checkbox"]:checked')).map(t=>t.value),s=document.querySelector('input[name="share-mode"]:checked')?.value;if(r.length===0){alert("Veuillez sélectionner au moins un ami.");return}if(!s){alert("Veuillez sélectionner un mode de partage.");return}e.confirmBtn.disabled=!0,e.confirmBtn.textContent="Envoi en cours...";try{const t=I(p,"shares");let d={};s==="collaborate"?d={senderId:a,createdAt:new Date,type:"collaborative_plan_invite",planId:n.plan.id,planName:n.plan.name}:d={senderId:a,createdAt:new Date,type:"share",plan:{name:n.plan.name,weeks:n.plan.weeks||{},manualItems:n.plan.manualItems||[],defaultNumPeople:n.plan.defaultNumPeople||1,startDay:n.plan.startDay||"Lundi"}};for(const c of r)await L(t,{...d,receiverId:c,status:"pending"});h(),alert("Partage envoyé avec succès !")}catch(t){console.error("Erreur lors de l'envoi du partage : ",t),alert("Une erreur est survenue lors de l'envoi du partage.")}finally{e.confirmBtn.disabled=!1,e.confirmBtn.textContent="Envoyer le partage"}}async function k(a={}){const{plan:r}=a;if(!r){alert("Aucun plan sélectionné à partager.");return}n={plan:r},e.title.textContent=`Partager le plan "${r.name}"`,e.friendsList.innerHTML='<p class="text-gray-500">Chargement des amis...</p>',e.modal.classList.remove("hidden");const s=v();if(s)try{const t=await g(y(p,"users",s));if(t.exists()){const c=t.data().friends||[];if(c.length===0){e.friendsList.innerHTML=`<p class="text-gray-500">Vous n'avez pas d'amis à qui partager.</p>`;return}e.friendsList.innerHTML="";for(const x of c){const f=await g(y(p,"users",x));if(f.exists()){const o=f.data(),l=document.createElement("label");l.className="flex items-center p-2 hover:bg-gray-100 rounded-lg cursor-pointer";const i=document.createElement("input");i.type="checkbox",i.value=o.uid,i.className="form-checkbox h-5 w-5 text-tomato rounded focus:ring-tomato",l.appendChild(i);const m=document.createElement("img");m.src=o.photoURL||"https://placehold.co/40x40",m.alt=o.displayName,m.className="w-8 h-8 rounded-full ml-3 mr-3",l.appendChild(m);const u=document.createElement("span");u.className="font-medium",u.textContent=o.displayName||o.email,l.appendChild(u),e.friendsList.appendChild(l)}}}}catch(t){console.error("Erreur lors du chargement des amis pour le partage : ",t),e.friendsList.innerHTML='<p class="text-red-500">Une erreur est survenue.</p>'}}e.closeBtn?.addEventListener("click",h);e.modal?.addEventListener("click",a=>{a.target===e.modal&&h()});e.confirmBtn?.addEventListener("click",b);export{k as openShareModal};
