import{d as i,g as M,c as x,a as re,s as se,b as O,q as F,w as J,e as U,f as P}from"./firebase-config-d8WEO_B0.js";import{s as b}from"./main-Ca5URGHw.js";import{ingredientModalManager as G}from"./ingredient-modal-DDwFGodq.js";function le(){const T=document.getElementById("ingredients-list-container"),K=document.getElementById("add-ingredient-btn"),$=document.getElementById("category-tabs"),Q=document.getElementById("search-bar"),V=document.getElementById("manage-categories-btn"),j=document.getElementById("category-management-modal"),W=document.getElementById("close-category-modal"),X=document.getElementById("done-category-modal-btn"),Y=document.getElementById("add-category-form"),z=document.getElementById("new-category-name"),D=document.getElementById("category-list");let h=[],p=[],u="",g="",C=null;async function H(){await R(),await v()}async function R(){if(i)try{p=(await M(x(i,"ingredient_categories"))).docs.map(t=>({id:t.id,...t.data()})),p.sort((t,n)=>t.name.localeCompare(n.name))}catch(a){console.error("Erreur lors de la r√©cup√©ration des cat√©gories: ",a)}}async function v(){if(i)try{h=(await M(x(i,"ingredients"))).docs.map(t=>({id:t.id,...t.data()})),w(),N()}catch(a){console.error("Erreur de chargement des ingr√©dients: ",a)}}function Z(){E(),j.classList.remove("hidden")}function _(){j.classList.add("hidden")}function E(){if(D.innerHTML="",p.length===0){D.innerHTML='<p class="text-gray-500">Aucune cat√©gorie d√©finie.</p>';return}p.forEach(a=>{const t=document.createElement("div");t.className="flex items-center justify-between p-2 border-b";const n=document.createElement("span");n.textContent=a.name,t.appendChild(n);const e=document.createElement("div");e.className="flex space-x-2";const o=document.createElement("button");o.className="text-blue-500 hover:bg-blue-50 text-xs px-2 py-1 rounded-md",o.innerHTML='<i class="fas fa-edit"></i>',o.addEventListener("click",()=>te(a)),e.appendChild(o);const l=document.createElement("button");l.className="text-red-500 hover:bg-red-50 text-xs px-2 py-1 rounded-md",l.innerHTML='<i class="fas fa-trash"></i>',l.addEventListener("click",()=>ne(a)),e.appendChild(l),t.appendChild(e),D.appendChild(t)})}async function ee(a){a.preventDefault();const t=z.value.trim();if(t&&!p.find(n=>n.name.toLowerCase()===t.toLowerCase()))try{await re(x(i,"ingredient_categories"),{name:t}),z.value="",await R(),E(),w()}catch(n){console.error("Erreur d'ajout de cat√©gorie: ",n)}else alert("Cette cat√©gorie existe d√©j√† ou le nom est invalide.")}async function te(a){const t=a.name,n=prompt(`Entrez le nouveau nom pour la cat√©gorie "${t}":`,t);if(n&&n.trim()!==""&&n!==t)try{await se(O(i,"ingredient_categories",a.id),{name:n});const e=F(x(i,"ingredients"),J("category","==",t)),o=await M(e),l=U(i);o.forEach(m=>{l.update(m.ref,{category:n})}),await l.commit(),await H(),E()}catch(e){console.error("Erreur de renommage: ",e)}}async function ne(a){if(confirm(`√ätes-vous s√ªr de vouloir supprimer la cat√©gorie "${a.name}"?

Tous les ingr√©dients associ√©s seront d√©plac√©s vers la cat√©gorie "Inconnue".`))try{await P(O(i,"ingredient_categories",a.id));const t=F(x(i,"ingredients"),J("category","==",a.name)),n=await M(t),e=U(i);n.forEach(o=>{e.update(o.ref,{category:"Inconnue"})}),await e.commit(),u="",await H(),E()}catch(t){console.error("Erreur de suppression: ",t)}}function w(){$.innerHTML="";const a=p.map(e=>e.name),t=[...new Set(h.map(e=>e.category||"Inconnue"))];let n=[...new Set([...a,...t])];n.sort((e,o)=>e.localeCompare(o)),n.includes("Inconnue")&&(n=n.filter(e=>e!=="Inconnue"),n.push("Inconnue")),n.length===0&&h.length>0&&n.push("Inconnue"),!u&&n.length>0&&(u=n[0]),n.forEach(e=>{const o=document.createElement("button"),l=e===u;o.className=`px-4 py-2 text-sm font-medium rounded-t-lg ${l?"bg-tomato text-white":"text-gray-500 hover:text-tomato"}`,o.textContent=e,o.addEventListener("click",()=>ae(e)),$.appendChild(o)})}function ae(a){u=a,w(),N()}function N(){T.innerHTML="";const a=u||(p.length>0?p[0].name:"Inconnue");let t=h.filter(e=>(e.category||"Inconnue")===a);if(g){const e=g.toLowerCase();t=t.filter(o=>o.name.toLowerCase().includes(e))}if(t.forEach(e=>e.seasonScore=b.getIngredientScore(e)),b.config.offSeasonBehavior==="hide"&&(t=t.filter(e=>e.seasonScore>0)),t.length===0){T.innerHTML='<p class="text-center text-gray-500 p-10">Aucun ingr√©dient dans cette cat√©gorie (ou tout est masqu√©).</p>';return}b.config.offSeasonBehavior==="last"||b.config.offSeasonBehavior==="dim"?t.sort((e,o)=>o.seasonScore!==e.seasonScore?o.seasonScore-e.seasonScore:e.name.localeCompare(o.name,"fr",{sensitivity:"base"})):t.sort((e,o)=>e.name.localeCompare(o.name,"fr",{sensitivity:"base"}));const n=document.createElement("div");n.className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",t.forEach(e=>{const o=e.seasonScore===0,l=o&&b.config.offSeasonBehavior==="dim"?"opacity-50 grayscale transition-all hover:grayscale-0 hover:opacity-100":"",m=document.createElement("div");if(m.className=`p-3 bg-white shadow-sm rounded-lg flex flex-col items-start space-y-2 relative border border-transparent ${l}`,e.imageUrl){const r=document.createElement("div");r.className="relative w-full h-24 mb-2";const c=document.createElement("img");if(c.src=e.imageUrl,c.alt=e.name,c.className="w-full h-full object-cover rounded-md",r.appendChild(c),e.seasonScore===2){const s=document.createElement("div");s.className="absolute top-1 right-1 bg-green-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow-sm z-10",s.textContent="De saison",r.appendChild(s)}else if(o){const s=document.createElement("div");s.className="absolute top-1 right-1 bg-gray-500/80 text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow-sm backdrop-blur-sm z-10",s.textContent="Hors saison",r.appendChild(s)}m.appendChild(r)}else if(e.seasonScore===2){m.classList.add("border-green-100");const r=document.createElement("div");r.className="absolute top-2 right-2 bg-green-100 text-green-700 text-[10px] font-bold px-2 py-0.5 rounded-full border border-green-200 shadow-sm z-10",r.textContent="De saison",m.appendChild(r)}else if(o){const r=document.createElement("div");r.className="absolute top-2 right-2 bg-gray-100 text-gray-500 text-[10px] font-bold px-2 py-0.5 rounded-full border border-gray-200 shadow-sm z-10",r.textContent="Hors saison",m.appendChild(r)}const L=document.createElement("div");L.className="flex-grow w-full flex justify-between items-center";const k=document.createElement("span");k.className="font-medium text-gray-800",k.textContent=e.name;const q=document.createElement("span");q.className="text-gray-500 text-sm bg-gray-100 px-2 py-1 rounded-full",q.textContent=e.unit,L.appendChild(k),L.appendChild(q),m.appendChild(L);const y=document.createElement("div");y.className="w-full flex flex-col gap-1 mt-1 px-1";let A=!1;if(e.seasons&&e.seasons.length>0){A=!0;const r=document.createElement("div");r.className="flex flex-wrap gap-1";const c={Printemps:"üå∏",Et√©:"‚òÄÔ∏è",Automne:"üçÇ",Hiver:"‚ùÑÔ∏è"},s=["Printemps","Et√©","Automne","Hiver"];e.seasons.sort((d,f)=>s.indexOf(d)-s.indexOf(f)).forEach(d=>{const f=document.createElement("span");f.textContent=`${c[d]||""} ${d}`,f.title=d,f.className="text-[10px] text-gray-600 bg-gray-100 px-1.5 py-0.5 rounded-full border border-gray-200 whitespace-nowrap",r.appendChild(f)}),y.appendChild(r)}if(e.months&&e.months.length>0){A=!0;const r=document.createElement("div");r.className="flex flex-wrap gap-1";const c=["Janvier","F√©vrier","Mars","Avril","Mai","Juin","Juillet","Ao√ªt","Septembre","Octobre","Novembre","D√©cembre"];e.months.sort((s,d)=>c.indexOf(s)-c.indexOf(d)),e.months.forEach(s=>{const d=document.createElement("span");d.textContent=s.slice(0,3)+".",d.title=s,d.className="text-[10px] text-gray-600 bg-blue-50 px-1.5 py-0.5 rounded-full border border-blue-100 whitespace-nowrap",r.appendChild(d)}),y.appendChild(r)}if(!A){const r=document.createElement("div");r.className="flex flex-wrap gap-1";const c=document.createElement("span");c.textContent="Toute l'ann√©e üåç",c.className="text-[10px] text-green-700 bg-green-50 px-1.5 py-0.5 rounded-full border border-green-200 whitespace-nowrap",r.appendChild(c),y.appendChild(r)}m.appendChild(y);const I=document.createElement("div");I.className="w-full flex justify-end items-center space-x-2 border-t pt-2 mt-2";const S=document.createElement("button");S.className="text-blue-500 hover:bg-blue-50 text-xs px-2 py-1 rounded-md",S.innerHTML='<i class="fas fa-edit"></i>',S.addEventListener("click",()=>G.open(e,v));const B=document.createElement("button");B.className="text-red-500 hover:bg-red-50 text-xs px-2 py-1 rounded-md",B.innerHTML='<i class="fas fa-trash-alt"></i>',B.addEventListener("click",()=>oe(e.id,e.name)),I.appendChild(S),I.appendChild(B),m.appendChild(I),n.appendChild(m)}),T.appendChild(n)}async function oe(a,t){if(confirm(`√ätes-vous s√ªr de vouloir supprimer l'ingr√©dient "${t}" ?`))try{await P(O(i,"ingredients",a)),await v()}catch(n){console.error("Erreur de suppression de l'ingr√©dient: ",n)}}window.addEventListener("seasonality-config-changed",()=>{N()}),Q.addEventListener("input",a=>{const t=a.target.value.toLowerCase();if(!g&&t&&(C=u),g=t,g){const n=h.find(e=>e.name.toLowerCase().includes(g));n&&(u=n.category||"Inconnue")}else C&&(u=C,C=null);w(),N()}),K.addEventListener("click",()=>G.open(null,v)),V.addEventListener("click",Z),W.addEventListener("click",_),X.addEventListener("click",_),Y.addEventListener("submit",ee),H()}export{le as default};
