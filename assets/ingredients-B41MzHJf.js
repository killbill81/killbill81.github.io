import{d as i,g as L,c as f,s as J,a as B,b as K,q as Q,w as V,e as W,f as X}from"./firebase-config-CDPbqvnt.js";function fe(){const N=document.getElementById("ingredients-list-container"),Y=document.getElementById("add-ingredient-btn"),q=document.getElementById("category-tabs"),Z=document.getElementById("search-bar"),$=document.getElementById("ingredient-form-modal"),j=document.getElementById("ingredient-modal-title"),ee=document.getElementById("close-ingredient-modal"),te=document.getElementById("cancel-ingredient-btn"),U=document.getElementById("ingredient-form"),M=document.getElementById("ingredient-id"),S=document.getElementById("ingredient-name"),y=document.getElementById("ingredient-unit"),h=document.getElementById("ingredient-category"),ne=document.getElementById("manage-categories-btn"),F=document.getElementById("category-management-modal"),ae=document.getElementById("close-category-modal"),oe=document.getElementById("done-category-modal-btn"),re=document.getElementById("add-category-form"),P=document.getElementById("new-category-name"),T=document.getElementById("category-list");let m=[],d=[],s="",u="",v=null;const _=["g","kg","ml","l","pi√®ce(s)","c.√†.s.","c.√†.c.","pinc√©e(s)"];async function k(){await O(),await D()}async function O(){if(i)try{d=(await L(f(i,"ingredient_categories"))).docs.map(t=>({id:t.id,...t.data()})),d.sort((t,n)=>t.name.localeCompare(n.name))}catch(a){console.error("Erreur lors de la r√©cup√©ration des cat√©gories: ",a)}}async function D(){if(i)try{m=(await L(f(i,"ingredients"))).docs.map(t=>({id:t.id,...t.data()})),x(),A()}catch(a){console.error("Erreur de chargement des ingr√©dients: ",a)}}function R(a=null){U.reset(),y.innerHTML="",_.forEach(r=>{const c=document.createElement("option");c.value=r,c.textContent=r,y.appendChild(c)});const t=d.map(r=>r.name),n=[...new Set(m.map(r=>r.category).filter(Boolean))],e=[...new Set([...t,...n])];e.sort((r,c)=>r.localeCompare(c.name)),h.innerHTML="",e.forEach(r=>{const c=document.createElement("option");c.value=r,c.textContent=r,h.appendChild(c)}),a?(j.textContent="Modifier l'ingr√©dient",M.value=a.id,S.value=a.name,y.value=a.unit||"",h.value=a.category||(e.length>0?e[0]:""),document.getElementById("ingredient-image-url").value=a.imageUrl||""):(j.textContent="Ajouter un ingr√©dient",M.value="",y.value=_[0],h.value=s||(e.length>0?e[0]:""));const o=a?a.seasons||[]:[];["Printemps","Et√©","Automne","Hiver"].forEach(r=>{const c=`season-${r.toLowerCase().replace("√©","e")}`,g=document.getElementById(c);g&&(g.checked=o.includes(r))}),$.classList.remove("hidden")}function H(){$.classList.add("hidden")}async function ce(a){a.preventDefault();const t=M.value,n=[];["Printemps","Et√©","Automne","Hiver"].forEach(o=>{const r=`season-${o.toLowerCase().replace("√©","e")}`,c=document.getElementById(r);c&&c.checked&&n.push(o)});const e={name:S.value,unit:y.value,category:h.value,seasons:n,imageUrl:document.getElementById("ingredient-image-url").value||`https://tse2.mm.bing.net/th?q=${encodeURIComponent(S.value)}%20ingredient&w=400&h=300&c=7&rs=1&p=0`};if(!e.name||!e.category){alert("Le nom et la cat√©gorie sont requis.");return}try{t?await J(B(i,"ingredients",t),e):await K(f(i,"ingredients"),e),H(),await D()}catch(o){console.error("Erreur de sauvegarde de l'ingr√©dient: ",o)}}function ie(){C(),F.classList.remove("hidden")}function z(){F.classList.add("hidden")}function C(){if(T.innerHTML="",d.length===0){T.innerHTML='<p class="text-gray-500">Aucune cat√©gorie d√©finie.</p>';return}d.forEach(a=>{const t=document.createElement("div");t.className="flex items-center justify-between p-2 border-b";const n=document.createElement("span");n.textContent=a.name,t.appendChild(n);const e=document.createElement("div");e.className="flex space-x-2";const o=document.createElement("button");o.className="text-blue-500 hover:bg-blue-50 text-xs px-2 py-1 rounded-md",o.innerHTML='<i class="fas fa-edit"></i>',o.addEventListener("click",()=>de(a)),e.appendChild(o);const r=document.createElement("button");r.className="text-red-500 hover:bg-red-50 text-xs px-2 py-1 rounded-md",r.innerHTML='<i class="fas fa-trash"></i>',r.addEventListener("click",()=>le(a)),e.appendChild(r),t.appendChild(e),T.appendChild(t)})}async function se(a){a.preventDefault();const t=P.value.trim();if(t&&!d.find(n=>n.name.toLowerCase()===t.toLowerCase()))try{await K(f(i,"ingredient_categories"),{name:t}),P.value="",await O(),C(),x()}catch(n){console.error("Erreur d'ajout de cat√©gorie: ",n)}else alert("Cette cat√©gorie existe d√©j√† ou le nom est invalide.")}async function de(a){const t=a.name,n=prompt(`Entrez le nouveau nom pour la cat√©gorie "${t}":`,t);if(n&&n.trim()!==""&&n!==t)try{await J(B(i,"ingredient_categories",a.id),{name:n});const e=Q(f(i,"ingredients"),V("category","==",t)),o=await L(e),r=W(i);o.forEach(c=>{r.update(c.ref,{category:n})}),await r.commit(),await k(),C()}catch(e){console.error("Erreur de renommage: ",e)}}async function le(a){if(confirm(`√ätes-vous s√ªr de vouloir supprimer la cat√©gorie "${a.name}"?

Tous les ingr√©dients associ√©s seront d√©plac√©s vers la cat√©gorie "Inconnue".`))try{await X(B(i,"ingredient_categories",a.id));const t=Q(f(i,"ingredients"),V("category","==",a.name)),n=await L(t),e=W(i);n.forEach(o=>{e.update(o.ref,{category:"Inconnue"})}),await e.commit(),s="",await k(),C()}catch(t){console.error("Erreur de suppression: ",t)}}function x(){q.innerHTML="";const a=d.map(e=>e.name),t=[...new Set(m.map(e=>e.category||"Inconnue"))];let n=[...new Set([...a,...t])];n.sort((e,o)=>e.localeCompare(o)),n.includes("Inconnue")&&(n=n.filter(e=>e!=="Inconnue"),n.push("Inconnue")),n.length===0&&m.length>0&&n.push("Inconnue"),!s&&n.length>0&&(s=n[0]),n.forEach(e=>{const o=document.createElement("button"),r=e===s;o.className=`px-4 py-2 text-sm font-medium rounded-t-lg ${r?"bg-tomato text-white":"text-gray-500 hover:text-tomato"}`,o.textContent=e,o.addEventListener("click",()=>me(e)),q.appendChild(o)})}function me(a){s=a,x(),A()}function A(){N.innerHTML="";const a=s||(d.length>0?d[0].name:"Inconnue");let t=m.filter(e=>(e.category||"Inconnue")===a);if(u){const e=u.toLowerCase();t=t.filter(o=>o.name.toLowerCase().includes(e))}if(t.length===0){N.innerHTML='<p class="text-center text-gray-500 p-10">Aucun ingr√©dient dans cette cat√©gorie.</p>';return}t.sort((e,o)=>e.name.localeCompare(o.name,"fr",{sensitivity:"base"}));const n=document.createElement("div");n.className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",t.forEach(e=>{const o=document.createElement("div");if(o.className="p-3 bg-white shadow-sm rounded-lg flex flex-col items-start space-y-2",e.imageUrl){const l=document.createElement("img");l.src=e.imageUrl,l.alt=e.name,l.className="w-full h-24 object-cover rounded-md mb-2",o.appendChild(l)}const r=document.createElement("div");r.className="flex-grow w-full flex justify-between items-center";const c=document.createElement("span");c.className="font-medium text-gray-800",c.textContent=e.name;const g=document.createElement("span");if(g.className="text-gray-500 text-sm bg-gray-100 px-2 py-1 rounded-full",g.textContent=e.unit,r.appendChild(c),r.appendChild(g),o.appendChild(r),e.seasons&&e.seasons.length>0){const l=document.createElement("div");l.className="w-full flex flex-wrap gap-1 mt-1 px-1";const ge={Printemps:"üå∏",Et√©:"‚òÄÔ∏è",Automne:"üçÇ",Hiver:"‚ùÑÔ∏è"},G=["Printemps","Et√©","Automne","Hiver"];e.seasons.sort((E,p)=>G.indexOf(E)-G.indexOf(p)).forEach(E=>{const p=document.createElement("span");p.textContent=`${ge[E]||""} ${E}`,p.title=E,p.className="text-[10px] text-gray-600 bg-gray-100 px-1.5 py-0.5 rounded-full border border-gray-200 whitespace-nowrap",l.appendChild(p)}),o.appendChild(l)}const w=document.createElement("div");w.className="w-full flex justify-end items-center space-x-2 border-t pt-2 mt-2";const I=document.createElement("button");I.className="text-blue-500 hover:bg-blue-50 text-xs px-2 py-1 rounded-md",I.innerHTML='<i class="fas fa-edit"></i>',I.addEventListener("click",()=>R(e));const b=document.createElement("button");b.className="text-red-500 hover:bg-red-50 text-xs px-2 py-1 rounded-md",b.innerHTML='<i class="fas fa-trash-alt"></i>',b.addEventListener("click",()=>ue(e.id,e.name)),w.appendChild(I),w.appendChild(b),o.appendChild(w),n.appendChild(o)}),N.appendChild(n)}async function ue(a,t){if(confirm(`√ätes-vous s√ªr de vouloir supprimer l'ingr√©dient "${t}" ?`))try{await X(B(i,"ingredients",a)),await D()}catch(n){console.error("Erreur de suppression de l'ingr√©dient: ",n)}}Z.addEventListener("input",a=>{const t=a.target.value.toLowerCase();if(!u&&t&&(v=s),u=t,u){const n=m.find(e=>e.name.toLowerCase().includes(u));n&&(s=n.category||"Inconnue")}else v&&(s=v,v=null);x(),A()}),Y.addEventListener("click",()=>R()),ee.addEventListener("click",H),te.addEventListener("click",H),U.addEventListener("submit",ce),ne.addEventListener("click",ie),ae.addEventListener("click",z),oe.addEventListener("click",z),re.addEventListener("submit",se),k()}export{fe as default};
