import{g as j,c as O,a as q,s as J,b as P,d as D,u as _,o as G,f as Q}from"./firebase-config-d8WEO_B0.js";import{s as T}from"./main-Ca5URGHw.js";class K{constructor(s,r,i,c,a,o,e,b,u,E,C,w,F,L,p,g){this.db=s,this.modal=document.getElementById(r),this.form=document.getElementById(i),this.modalTitle=document.getElementById(c),this.recipeIdInput=document.getElementById(a),this.recipeNameInput=document.getElementById(o),this.recipeCategoryInput=document.getElementById(e),this.recipeServingsInput=document.getElementById(b),this.recipePrepTimeInput=document.getElementById(u),this.recipeDifficultyInput=document.getElementById(E),this.recipeImageUrlInput=document.getElementById("edit-recipe-image-url"),this.recipeStepsTextarea=document.getElementById(C),this.ingredientsListDiv=document.getElementById(w),this.addIngredientBtn=document.getElementById(F),this.saveRecipeBtn=document.getElementById(L),this.closeButton=document.getElementById(p),this.cancelButton=document.getElementById(g),this.masterIngredientList=[],this.activityUpdater=null,this.boundAddIngredient=()=>this.addIngredientInput(void 0,this.form.ingredients),this.boundCloseForm=()=>this.closeForm(),this.boundHandleSubmit=N=>this.handleSubmit(N),this.addIngredientBtn.addEventListener("click",this.boundAddIngredient),this.closeButton.addEventListener("click",this.boundCloseForm),this.cancelButton.addEventListener("click",this.boundCloseForm),this.saveRecipeBtn.addEventListener("click",this.boundHandleSubmit),this.initSeasonalityListeners()}initSeasonalityListeners(){const s=document.querySelectorAll(".recipe-season-checkbox"),r=document.querySelectorAll(".recipe-month-checkbox");s.forEach(i=>{i.addEventListener("change",c=>{const a=c.target.value;document.querySelectorAll(`.recipe-month-checkbox[data-season="${a}"]`).forEach(e=>e.checked=c.target.checked)})}),r.forEach(i=>{i.addEventListener("change",c=>{const a=c.target.dataset.season,o=document.querySelector(`.recipe-season-checkbox[value="${a}"]`);if(c.target.checked)o&&(o.checked=!0);else{const e=document.querySelectorAll(`.recipe-month-checkbox[data-season="${a}"]:checked`);o&&e.length===0&&(o.checked=!1)}})})}setActivityUpdater(s){this.activityUpdater=s}destroy(){this.addIngredientBtn.removeEventListener("click",this.boundAddIngredient),this.closeButton.removeEventListener("click",this.boundCloseForm),this.cancelButton.removeEventListener("click",this.boundCloseForm),this.saveRecipeBtn.removeEventListener("click",this.boundHandleSubmit)}async openForm(s=null,r="Ajouter une recette"){this.activityUpdater&&this.activityUpdater("editing_recipe"),await this.fetchMasterIngredients(),console.log("openForm called with recipe:",s,"and title:",r),this.form.reset(),this.ingredientsListDiv.innerHTML="",this.modalTitle.textContent=r;const i=[];if(this.form.ingredients=i,s){this.recipeIdInput.value=s.id||"",this.recipeNameInput.value=s.name||"";const c=s.category||"Plat";for(const e of this.recipeCategoryInput.options)if(e.value.toLowerCase()===c.toLowerCase()){e.selected=!0;break}this.recipeServingsInput.value=parseInt(s.servings)||"",this.recipePrepTimeInput.value=parseInt(s.prepTime)||"",this.recipeDifficultyInput.value=s.difficulty||"Moyen",this.recipeImageUrlInput.value=s.imageUrl||"",this.recipeStepsTextarea.value=s.steps||"";const a=s.seasons||[];["Printemps","Et√©","Automne","Hiver"].forEach(e=>{const b=`recipe-season-${e.toLowerCase().replace("√©","e")}`,u=document.getElementById(b);u&&(u.checked=a.includes(e))});const o=s.months||[];document.querySelectorAll(".recipe-month-checkbox").forEach(e=>{e.checked=o.includes(e.value)}),s.ingredients&&s.ingredients.length>0?s.ingredients.forEach(e=>this.addIngredientInput({...e},i)):this.addIngredientInput(void 0,i)}else this.recipeIdInput.value="",["Printemps","Et√©","Automne","Hiver"].forEach(c=>{const a=`recipe-season-${c.toLowerCase().replace("√©","e")}`,o=document.getElementById(a);o&&(o.checked=!1)}),document.querySelectorAll(".recipe-month-checkbox").forEach(c=>c.checked=!1),this.addIngredientInput(void 0,i);this.modal.classList.remove("hidden")}closeForm(){this.activityUpdater&&this.activityUpdater("idle"),this.modal.classList.add("hidden")}async fetchMasterIngredients(){if(this.masterIngredientList=[],!!this.db)try{const s=await j(O(this.db,"ingredients"));this.masterIngredientList=s.docs.map(r=>({id:r.id,...r.data()})),this.masterIngredientList.sort((r,i)=>r.name.localeCompare(i.name))}catch(s){console.error("Erreur lors de la r√©cup√©ration de la liste des ingr√©dients: ",s),alert("Impossible de charger la liste des ingr√©dients de base. La recherche ne fonctionnera pas.")}}addIngredientInput(s={quantity:"",name:"",unit:""},r){const i=document.createElement("div");i.className="relative flex items-stretch space-x-2 ingredient-row";const c={...s};r.push(c);const a=r.length-1,o=document.createElement("input");o.type="text",o.className="ingredient-quantity mt-1 block w-1/4 rounded-md border-gray-300 shadow-sm",o.placeholder="Qt√©",o.value=c.quantity,o.addEventListener("change",w=>{r[a].quantity=w.target.value});const e=document.createElement("input");e.type="text",e.className="ingredient-unit mt-1 block w-1/4 rounded-md border-gray-300 shadow-sm bg-gray-100",e.placeholder="Unit√©",e.readOnly=!0,e.value=c.unit||"";const b=document.createElement("div");b.className="relative w-1/2";const u=document.createElement("input");u.type="text",u.className="ingredient-name mt-1 block w-full rounded-md border-gray-300 shadow-sm",u.placeholder="Chercher un ingr√©dient...",u.value=c.name,b.appendChild(u);const E=document.createElement("div");E.className="absolute z-10 w-full bg-white border border-gray-300 rounded-md shadow-lg mt-1 hidden max-h-48 overflow-y-auto",b.appendChild(E),u.addEventListener("input",()=>{const w=u.value.toLowerCase();if(!w){E.classList.add("hidden");return}const F=this.masterIngredientList.filter(p=>p.name.toLowerCase().includes(w));E.innerHTML="",F.forEach(p=>{const g=document.createElement("div");g.className="p-2 ingredient-search-item cursor-pointer",g.textContent=p.name,g.addEventListener("click",()=>{u.value=p.name,e.value=p.unit,E.classList.add("hidden"),r[a].name=p.name,r[a].unit=p.unit,r[a].id=p.id}),E.appendChild(g)});const L=document.createElement("div");L.className="p-2 bg-blue-50 hover:bg-blue-200 cursor-pointer font-bold text-blue-700",L.textContent=`+ Cr√©er "${u.value}"`,L.addEventListener("click",async()=>{const p=u.value,g="pi√®ce(s)";try{const N=await q(O(this.db,"ingredients"),{name:p,unit:g});await this.fetchMasterIngredients(),u.value=p,e.value=g,E.classList.add("hidden"),r[a].name=p,r[a].unit=g,r[a].id=N.id}catch(N){console.error("Erreur d'ajout d'ingr√©dient",N),alert("L'ingr√©dient n'a pas pu √™tre cr√©√©.")}}),E.appendChild(L),E.classList.remove("hidden")});const C=document.createElement("button");C.type="button",C.className="text-red-500 hover:bg-red-50 text-sm px-3 py-1 rounded-md mt-1",C.innerHTML='<i class="fas fa-trash"></i>',C.addEventListener("click",()=>{i.remove(),r[a]=null}),i.appendChild(b),i.appendChild(o),i.appendChild(e),i.appendChild(C),this.ingredientsListDiv.appendChild(i)}async handleSubmit(s){s.preventDefault(),this.saveRecipeBtn.disabled=!0,this.saveRecipeBtn.innerHTML='<i class="fas fa-spinner fa-spin mr-2"></i> Sauvegarde...',console.log("Ingredients array from form before filter:",this.form.ingredients);const r=this.form.ingredients.filter(e=>e!==null&&e.quantity&&e.name),i=[];["Printemps","Et√©","Automne","Hiver"].forEach(e=>{const b=`recipe-season-${e.toLowerCase().replace("√©","e")}`,u=document.getElementById(b);u&&u.checked&&i.push(e)});const c=[];document.querySelectorAll(".recipe-month-checkbox:checked").forEach(e=>{c.push(e.value)});const a={name:this.recipeNameInput.value,category:this.recipeCategoryInput.value,servings:parseInt(this.recipeServingsInput.value)||0,prepTime:parseInt(this.recipePrepTimeInput.value)||0,difficulty:this.recipeDifficultyInput.value,seasons:i,months:c,steps:this.recipeStepsTextarea.value,ingredients:r,imageUrl:this.recipeImageUrlInput.value||`https://tse2.mm.bing.net/th?q=${encodeURIComponent(this.recipeNameInput.value)}%20recette&w=400&h=300&c=7&rs=1&p=0`};console.log("Recipe data being sent to Firebase:",a);const o=this.recipeIdInput.value;try{o?await J(P(this.db,"recipes",o),a):await q(O(this.db,"recipes"),a),this.closeForm(),console.log("Recipe saved successfully!"),this.onSaveCallback&&this.onSaveCallback()}catch(e){console.error("Erreur de sauvegarde: ",e),alert("Une erreur est survenue lors de la sauvegarde.")}finally{this.saveRecipeBtn.disabled=!1,this.saveRecipeBtn.textContent="Sauvegarder"}}setOnSaveCallback(s){this.onSaveCallback=s}}let M=null;async function $(A,s){if(!A)return;const r=P(D,"recipes",A);try{await _(r,{isFavorite:!s})}catch(i){console.error("Error toggling favorite status:",i)}}function V(){const A=document.getElementById("search-bar"),s=document.getElementById("category-tabs"),r=document.getElementById("recipe-list-container"),i=document.getElementById("add-recipe-btn");M&&M.destroy(),M=new K(D,"edit-recipe-form-modal","edit-recipe-form","edit-recipe-modal-title","edit-recipe-id","edit-recipe-name","edit-recipe-category","edit-recipe-servings","edit-recipe-prep-time","edit-recipe-difficulty","edit-recipe-steps","edit-ingredients-list","edit-add-ingredient-btn","edit-save-recipe-btn","close-edit-recipe-modal","edit-cancel-recipe-btn"),M.setOnSaveCallback(()=>{});let c=[],a="",o="",e=null;const b=["Entr√©e","Plat","Accompagnement","Dessert"],u={PLAT:"bg-orange-100",DESSERT:"bg-amber-100",ENTREE:"bg-lime-100",ACCOMPAGNEMENT:"bg-stone-200","PETIT-DEJEUNER":"bg-orange-100",BOISSON:"bg-cyan-100",SAUCE:"bg-red-100"},E={PLAT:"text-orange-800",DESSERT:"text-amber-800",ENTREE:"text-lime-800",ACCOMPAGNEMENT:"text-stone-800","PETIT-DEJEUNER":"text-orange-800",BOISSON:"text-cyan-800",SAUCE:"text-red-800"},C="bg-gray-100",w="text-gray-800";function F(){return D?G(O(D,"recipes"),d=>{console.log("Recipe data updated on /recipes page from listener."),c=d.docs.map(n=>({id:n.id,...n.data()})),p(),g()},d=>{console.error("Erreur lors de l'√©coute des recettes: ",d)}):()=>{}}function L(t){a=t,p(),g()}function p(){if(!s)return;s.innerHTML="";const d=[...new Set(c.map(n=>n.category||"Non class√©"))].sort((n,l)=>{const f=B=>{const H=B.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase();for(let I=0;I<b.length;I++)if(b[I].normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()===H)return I;return-1},S=f(n),x=f(l);return S>-1&&x>-1?S-x:S>-1?-1:x>-1?1:n.localeCompare(l)});!a&&d.length>0&&(a=d[0]),d.forEach(n=>{const l=document.createElement("button"),f=n.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toUpperCase();if(n===a){const x=u[f]||C,B=E[f]||w;l.className=`px-4 py-2 text-sm font-bold rounded-t-lg ${x} ${B}`}else l.className="px-4 py-2 text-sm font-medium text-gray-500 hover:text-tomato";l.textContent=n,l.addEventListener("click",()=>L(n)),s.appendChild(l)})}function g(){if(!r)return;r.innerHTML="";let t=c.filter(n=>(n.category||"Non class√©")===a);if(o){const n=o.toLowerCase();t=t.filter(l=>l.name.toLowerCase().includes(n))}if(t.forEach(n=>n.seasonScore=T.getRecipeScore(n)),T.config.offSeasonBehavior==="hide"&&(t=t.filter(n=>n.seasonScore>0)),T.config.recipeRules.prioritizeSeasonal?t.sort((n,l)=>l.seasonScore!==n.seasonScore?l.seasonScore-n.seasonScore:n.name.localeCompare(l.name)):t.sort((n,l)=>n.name.localeCompare(l.name)),t.length===0){r.innerHTML='<p class="text-gray-500 text-center p-10">Aucune recette trouv√©e (ou masqu√©e par la saison).</p>';return}const d=document.createElement("div");d.className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",t.forEach(n=>{d.appendChild(N(n))}),r.appendChild(d)}function N(t){const d=document.createElement("div");if(d.className="bg-white shadow-md rounded-lg flex flex-col p-3",t.imageUrl){const m=document.createElement("div");m.className="relative w-full h-24 mb-2";const v=document.createElement("img");v.src=t.imageUrl,v.alt=t.name,v.className="w-full h-full object-cover rounded-md",m.appendChild(v);const k=t.seasonScore!==void 0?t.seasonScore:T.getRecipeScore(t);if(k===2&&T.config.mode!=="disabled"){const h=document.createElement("div");h.className="absolute top-1 right-1 bg-green-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow-sm",h.textContent="De saison",m.appendChild(h)}else if(k===0&&T.config.mode!=="disabled"&&T.config.recipeRules.warnOffSeason){const h=document.createElement("div");h.className="absolute top-1 right-1 bg-gray-500/80 text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow-sm backdrop-blur-sm",h.textContent="Hors saison",m.appendChild(h),v.classList.add("grayscale-[50%]")}d.appendChild(m)}const n=document.createElement("div");n.className="w-full flex justify-between items-start";const l=document.createElement("h4");l.className="font-bold text-gray-800 pr-2",l.textContent=t.name,l.title=t.name,n.appendChild(l);const f=document.createElement("button");f.className="text-lg flex-shrink-0",f.innerHTML='<i class="fas fa-heart"></i>',t.isFavorite?f.classList.add("text-red-500"):f.classList.add("text-gray-300","hover:text-red-400"),f.addEventListener("click",m=>{m.stopPropagation(),$(t.id,t.isFavorite)}),n.appendChild(f),d.appendChild(n);const S=document.createElement("p");S.className="text-sm text-gray-600 mt-1 w-full",S.textContent=`${t.difficulty||""} - Pour ${t.servings||"?"} pers.`,d.appendChild(S);const x=document.createElement("div");x.className="w-full flex flex-col gap-1 mt-1 px-1";let B=!1;if(t.seasons&&t.seasons.length>0){B=!0;const m=document.createElement("div");m.className="flex flex-wrap gap-1";const v={Printemps:"üå∏",Et√©:"‚òÄÔ∏è",Automne:"üçÇ",Hiver:"‚ùÑÔ∏è"},k=["Printemps","Et√©","Automne","Hiver"];t.seasons.sort((h,y)=>k.indexOf(h)-k.indexOf(y)).forEach(h=>{const y=document.createElement("span");y.textContent=`${v[h]||""} ${h}`,y.title=h,y.className="text-[10px] text-gray-600 bg-gray-100 px-1.5 py-0.5 rounded-full border border-gray-200 whitespace-nowrap",m.appendChild(y)}),x.appendChild(m)}if(t.months&&t.months.length>0){B=!0;const m=document.createElement("div");m.className="flex flex-wrap gap-1";const v=["Janvier","F√©vrier","Mars","Avril","Mai","Juin","Juillet","Ao√ªt","Septembre","Octobre","Novembre","D√©cembre"];let k=[...t.months];k.sort((h,y)=>v.indexOf(h)-v.indexOf(y)),k.forEach(h=>{const y=document.createElement("span");y.textContent=h.slice(0,3)+".",y.title=h,y.className="text-[10px] text-gray-600 bg-blue-50 px-1.5 py-0.5 rounded-full border border-blue-100 whitespace-nowrap",m.appendChild(y)}),x.appendChild(m)}if(!B){const m=document.createElement("div");m.className="flex flex-wrap gap-1";const v=document.createElement("span");v.textContent="Toute l'ann√©e üåç",v.className="text-[10px] text-green-700 bg-green-50 px-1.5 py-0.5 rounded-full border border-green-200 whitespace-nowrap",m.appendChild(v),x.appendChild(m)}d.appendChild(x);const H=document.createElement("div");H.className="flex-grow",d.appendChild(H);const I=document.createElement("div");I.className="w-full flex justify-end items-center space-x-2 border-t pt-2 mt-2";const R=document.createElement("button");R.className="text-blue-500 hover:bg-blue-50 text-sm px-3 py-1 rounded-md",R.innerHTML='<i class="fas fa-edit"></i>',R.title="Modifier",R.addEventListener("click",()=>M.openForm(t,"Modifier la recette")),I.appendChild(R);const U=document.createElement("button");return U.className="text-red-500 hover:bg-red-50 text-sm px-3 py-1 rounded-md",U.innerHTML='<i class="fas fa-trash-alt"></i>',U.title="Supprimer",U.addEventListener("click",()=>z(t.id,t.name)),I.appendChild(U),d.appendChild(I),d}async function z(t,d){if(confirm(`√ätes-vous s√ªr de vouloir supprimer la recette "${d}" ?`))try{await Q(P(D,"recipes",t)),fetchAllRecipes()}catch(n){console.error("Erreur lors de la suppression: ",n)}}if(i.addEventListener("click",()=>M.openForm(null,"Ajouter une recette")),A.addEventListener("input",t=>{const d=t.target.value;if(!o&&d&&(e=a),o=d,o){const n=o.toLowerCase(),l=c.find(f=>f.name.toLowerCase().includes(n));l&&(a=l.category||"Non class√©")}else e&&(a=e,e=null);p(),g()}),D)return F()}const Y=Object.freeze(Object.defineProperty({__proto__:null,default:V,toggleFavoriteStatus:$},Symbol.toStringTag,{value:"Module"}));export{K as R,Y as r,$ as t};
