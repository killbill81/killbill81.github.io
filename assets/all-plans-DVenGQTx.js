import{q as b,w as y,c as x,d,o as k,b as f,h as D,g as I,u as S,f as L}from"./firebase-config-d8WEO_B0.js";import{g as E,n as C}from"./main-Ca5URGHw.js";async function P(a){if(confirm("Voulez-vous charger cette sauvegarde ? Attention, cela écrasera la planification de la semaine correspondante dans votre plan de travail actuel."))try{const t=E();if(!t)throw new Error("Utilisateur non trouvé");const v=f(d,"plan_saves",a),i=await D(v);if(!i.exists())throw new Error("Sauvegarde non trouvée.");const s=i.data(),u=s.weekData.weekNumber,e=b(x(d,"plans"),y("userId","==",t)),n=await I(e);if(n.empty)throw new Error("Aucun plan de travail trouvé pour y charger la sauvegarde.");const p=n.docs[0],r=f(d,"plans",p.id);await S(r,{[`weeks.${u}`]:s.weekData}),localStorage.setItem("selectedPlanId",p.id),C("menu")}catch(t){console.error("Erreur lors du chargement de la sauvegarde:",t),alert(t.message)}}async function A(a){if(confirm("Êtes-vous sûr de vouloir supprimer cette sauvegarde ? Cette action est définitive."))try{await L(f(d,"plan_saves",a))}catch(t){console.error("Erreur lors de la suppression de la sauvegarde:",t),alert("La suppression a échoué.")}}function T(){const a=document.getElementById("all-plans-list"),t=E();if(!t||!a)return a.innerHTML="<p>Erreur de chargement.</p>",()=>{};const v=b(x(d,"plan_saves"),y("userId","==",t)),i=k(v,s=>{if(a.innerHTML="",s.empty){a.innerHTML=`<p class="text-center text-gray-500 p-10 col-span-full">Vous n'avez aucune sauvegarde.</p>`;return}const u=s.docs.map(e=>({id:e.id,...e.data()}));u.sort((e,n)=>n.savedAt.toMillis()-e.savedAt.toMillis()),u.forEach(e=>{const n=document.createElement("div");n.className="bg-white rounded-xl shadow-md p-4 flex flex-col justify-between";const p=e.savedAt?.toDate().toLocaleString("fr-FR")||"Date inconnue",r=e.planData;let g="Plan vide ou sans données.";if(r&&r.weeks){const w=Object.keys(r.weeks).length;w>0&&(g=`Contient ${w} semaine(s).`)}const h=document.createElement("div");h.innerHTML=`
                <h3 class="text-lg font-bold text-gray-800 mb-2">${e.name}</h3>
                <p class="text-sm text-gray-500">Sauvegardé le : ${p}</p>
                <p class="text-sm text-gray-600 mt-2">${g}</p>
            `;const o=document.createElement("div");o.className="mt-4 pt-4 border-t border-gray-200 flex items-center justify-end space-x-2";const m=document.createElement("button");m.className="btn btn-secondary btn-sm",m.textContent="Voir",m.addEventListener("click",()=>{localStorage.setItem("selectedPlanId",e.id),C("view-plan")});const l=document.createElement("button");l.className="btn btn-primary btn-sm",l.textContent="Charger",l.addEventListener("click",()=>P(e.id)),l.style.display="none";const c=document.createElement("button");c.className="text-red-500 hover:bg-red-100 text-sm px-3 py-1 rounded-md",c.innerHTML='<i class="fas fa-trash"></i>',c.title="Supprimer la sauvegarde",c.addEventListener("click",()=>A(e.id)),o.appendChild(c),o.appendChild(m),o.appendChild(l),n.appendChild(h),n.appendChild(o),a.appendChild(n)})});return()=>{i()}}export{T as default};
