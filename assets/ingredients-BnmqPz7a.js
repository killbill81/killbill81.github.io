import{d as i,g as b,c as m,s as R,a as I,b as G,q as J,w as K,e as O,f as P}from"./main-CZsIi34i.js";function le(){const w=document.getElementById("ingredients-list-container"),Q=document.getElementById("add-ingredient-btn"),D=document.getElementById("category-tabs"),V=document.getElementById("search-bar"),k=document.getElementById("ingredient-form-modal"),q=document.getElementById("ingredient-modal-title"),W=document.getElementById("close-ingredient-modal"),X=document.getElementById("cancel-ingredient-btn"),H=document.getElementById("ingredient-form"),x=document.getElementById("ingredient-id"),A=document.getElementById("ingredient-name"),u=document.getElementById("ingredient-unit"),g=document.getElementById("ingredient-category"),Y=document.getElementById("manage-categories-btn"),j=document.getElementById("category-management-modal"),Z=document.getElementById("close-category-modal"),ee=document.getElementById("done-category-modal-btn"),te=document.getElementById("add-category-form"),F=document.getElementById("new-category-name"),L=document.getElementById("category-list");let d=[],s=[],c="",l="",f=null;const _=["g","kg","ml","l","pièce(s)","c.à.s.","c.à.c.","pincée(s)"];async function B(){await $(),await M()}async function $(){if(i)try{s=(await b(m(i,"ingredient_categories"))).docs.map(t=>({id:t.id,...t.data()})),s.sort((t,n)=>t.name.localeCompare(n.name))}catch(a){console.error("Erreur lors de la récupération des catégories: ",a)}}async function M(){if(i)try{d=(await b(m(i,"ingredients"))).docs.map(t=>({id:t.id,...t.data()})),h(),T()}catch(a){console.error("Erreur de chargement des ingrédients: ",a)}}function U(a=null){H.reset(),u.innerHTML="",_.forEach(o=>{const r=document.createElement("option");r.value=o,r.textContent=o,u.appendChild(r)});const t=s.map(o=>o.name),n=[...new Set(d.map(o=>o.category).filter(Boolean))],e=[...new Set([...t,...n])];e.sort((o,r)=>o.localeCompare(r.name)),g.innerHTML="",e.forEach(o=>{const r=document.createElement("option");r.value=o,r.textContent=o,g.appendChild(r)}),a?(q.textContent="Modifier l'ingrédient",x.value=a.id,A.value=a.name,u.value=a.unit||"",g.value=a.category||(e.length>0?e[0]:"")):(q.textContent="Ajouter un ingrédient",x.value="",u.value=_[0],g.value=c||(e.length>0?e[0]:"")),k.classList.remove("hidden")}function N(){k.classList.add("hidden")}async function ne(a){a.preventDefault();const t=x.value,n={name:A.value,unit:u.value,category:g.value};if(!n.name||!n.category){alert("Le nom et la catégorie sont requis.");return}try{t?await R(I(i,"ingredients",t),n):await G(m(i,"ingredients"),n),N(),await M()}catch(e){console.error("Erreur de sauvegarde de l'ingrédient: ",e)}}function ae(){y(),j.classList.remove("hidden")}function z(){j.classList.add("hidden")}function y(){if(L.innerHTML="",s.length===0){L.innerHTML='<p class="text-gray-500">Aucune catégorie définie.</p>';return}s.forEach(a=>{const t=document.createElement("div");t.className="flex items-center justify-between p-2 border-b";const n=document.createElement("span");n.textContent=a.name,t.appendChild(n);const e=document.createElement("div");e.className="flex space-x-2";const o=document.createElement("button");o.className="btn btn-ghost btn-xs text-blue-500",o.innerHTML='<i class="fas fa-edit"></i>',o.addEventListener("click",()=>re(a)),e.appendChild(o);const r=document.createElement("button");r.className="btn btn-ghost btn-xs text-red-500",r.innerHTML='<i class="fas fa-trash"></i>',r.addEventListener("click",()=>ie(a)),e.appendChild(r),t.appendChild(e),L.appendChild(t)})}async function oe(a){a.preventDefault();const t=F.value.trim();if(t&&!s.find(n=>n.name.toLowerCase()===t.toLowerCase()))try{await G(m(i,"ingredient_categories"),{name:t}),F.value="",await $(),y(),h()}catch(n){console.error("Erreur d'ajout de catégorie: ",n)}else alert("Cette catégorie existe déjà ou le nom est invalide.")}async function re(a){const t=a.name,n=prompt(`Entrez le nouveau nom pour la catégorie "${t}":`,t);if(n&&n.trim()!==""&&n!==t)try{await R(I(i,"ingredient_categories",a.id),{name:n});const e=J(m(i,"ingredients"),K("category","==",t)),o=await b(e),r=O(i);o.forEach(p=>{r.update(p.ref,{category:n})}),await r.commit(),await B(),y()}catch(e){console.error("Erreur de renommage: ",e)}}async function ie(a){if(confirm(`Êtes-vous sûr de vouloir supprimer la catégorie "${a.name}"?

Tous les ingrédients associés seront déplacés vers la catégorie "Inconnue".`))try{await P(I(i,"ingredient_categories",a.id));const t=J(m(i,"ingredients"),K("category","==",a.name)),n=await b(t),e=O(i);n.forEach(o=>{e.update(o.ref,{category:"Inconnue"})}),await e.commit(),c="",await B(),y()}catch(t){console.error("Erreur de suppression: ",t)}}function h(){D.innerHTML="";const a=s.map(e=>e.name),t=[...new Set(d.map(e=>e.category||"Inconnue"))];let n=[...new Set([...a,...t])];n.sort((e,o)=>e.localeCompare(o)),n.includes("Inconnue")&&(n=n.filter(e=>e!=="Inconnue"),n.push("Inconnue")),n.length===0&&d.length>0&&n.push("Inconnue"),!c&&n.length>0&&(c=n[0]),n.forEach(e=>{const o=document.createElement("button"),r=e===c;o.className=`px-4 py-2 text-sm font-medium rounded-t-lg ${r?"bg-tomato text-white":"text-gray-500 hover:text-tomato"}`,o.textContent=e,o.addEventListener("click",()=>ce(e)),D.appendChild(o)})}function ce(a){c=a,h(),T()}function T(){w.innerHTML="";const a=c||(s.length>0?s[0].name:"Inconnue");let t=d.filter(e=>(e.category||"Inconnue")===a);if(l){const e=l.toLowerCase();t=t.filter(o=>o.name.toLowerCase().includes(e))}if(t.length===0){w.innerHTML='<p class="text-center text-gray-500 p-10">Aucun ingrédient dans cette catégorie.</p>';return}t.sort((e,o)=>e.name.localeCompare(o.name,"fr",{sensitivity:"base"}));const n=document.createElement("div");n.className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",t.forEach(e=>{const o=document.createElement("div");o.className="p-3 bg-white shadow-sm rounded-lg flex flex-col items-start space-y-2";const r=document.createElement("div");r.className="flex-grow w-full flex justify-between items-center";const p=document.createElement("span");p.className="font-medium text-gray-800",p.textContent=e.name;const S=document.createElement("span");S.className="text-gray-500 text-sm bg-gray-100 px-2 py-1 rounded-full",S.textContent=e.unit,r.appendChild(p),r.appendChild(S);const E=document.createElement("div");E.className="w-full flex justify-end items-center space-x-2 border-t pt-2 mt-2";const v=document.createElement("button");v.className="btn btn-ghost btn-xs text-blue-500 hover:bg-blue-50",v.innerHTML='<i class="fas fa-edit"></i>',v.addEventListener("click",()=>U(e));const C=document.createElement("button");C.className="btn btn-ghost btn-xs text-red-500 hover:bg-red-50",C.innerHTML='<i class="fas fa-trash-alt"></i>',C.addEventListener("click",()=>se(e.id,e.name)),E.appendChild(v),E.appendChild(C),o.appendChild(r),o.appendChild(E),n.appendChild(o)}),w.appendChild(n)}async function se(a,t){if(confirm(`Êtes-vous sûr de vouloir supprimer l'ingrédient "${t}" ?`))try{await P(I(i,"ingredients",a)),await M()}catch(n){console.error("Erreur de suppression de l'ingrédient: ",n)}}V.addEventListener("input",a=>{const t=a.target.value.toLowerCase();if(!l&&t&&(f=c),l=t,l){const n=d.find(e=>e.name.toLowerCase().includes(l));n&&(c=n.category||"Inconnue")}else f&&(c=f,f=null);h(),T()}),Q.addEventListener("click",()=>U()),W.addEventListener("click",N),X.addEventListener("click",N),H.addEventListener("submit",ne),Y.addEventListener("click",ae),Z.addEventListener("click",z),ee.addEventListener("click",z),te.addEventListener("submit",oe),B()}export{le as default};
