import{b as k,d as E,j as L,g as M,c as _}from"./firebase-config-9gANoKOS.js";import{n as $}from"./main-CPC2Lv91.js";function R(){const r=localStorage.getItem("selectedPlanId"),e=localStorage.getItem("selectedPlanCollection")||"plan_saves",t=document.getElementById("plan-view-name"),n=document.getElementById("meal-plan-grid"),l=document.getElementById("close-view-plan-btn");if(l&&l.addEventListener("click",()=>{localStorage.removeItem("selectedPlanId"),localStorage.removeItem("selectedPlanCollection"),$("plans")}),!r)return t&&(t.textContent="Aucun plan sélectionné"),n&&(n.innerHTML=`<p class="text-center text-red-500">Erreur : Aucun ID trouvé. Veuillez retourner à la page 'Mes Plans' et en sélectionner un.</p>`),()=>{};async function s(){try{const a=k(E,e,r),c=await L(a);if(!c.exists())throw new Error("Plan non trouvé");const i=c.data();let d=i,p=i.name;if(e==="plan_saves"&&(d=i.planData,p=`Sauvegarde : ${i.name}`),!d||!d.weeks){t&&(t.textContent=p),n.innerHTML='<p class="text-center text-gray-500 p-10 col-span-full">Ce plan ne contient aucune planification enregistrée.</p>';return}let m=[];e==="plans"&&(m=(await M(_(E,"recipes"))).docs.map(o=>({id:o.id,...o.data()}))),t&&(t.textContent=p),H(n,d,m)}catch(a){console.error("Error fetching plan:",a),t&&(t.textContent="Erreur"),n&&(n.innerHTML=`<p class="text-center text-red-500">${a.message}</p>`)}}return s(),()=>{localStorage.removeItem("selectedPlanId"),localStorage.removeItem("selectedPlanCollection")}}function H(r,e,t=[]){if(!r)return;r.innerHTML="";const n=Object.keys(e.weeks||{}).sort((l,s)=>parseInt(l)-parseInt(s));if(n.length===0){r.innerHTML='<p class="text-center text-gray-500 p-10 col-span-full">Ce plan est vide.</p>';return}n.forEach(l=>{const s=e.weeks[l],a=document.createElement("h3");a.className="text-lg font-bold text-gray-700 mt-6 mb-2 col-span-full",a.textContent=`Semaine ${l}`,r.appendChild(a);const c=document.createElement("div");N(c,s,e.startDay,e.defaultNumPeople,t),r.appendChild(c)})}function N(r,e,t,n,l=[]){const s=["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"],a=s.indexOf(t||"Lundi"),c=[...s.slice(a),...s.slice(0,a)],i=e.menuData||{},d=e.servingsData||{},p=e.remarksData||{};c.forEach(m=>{const g=s.indexOf(m),o=document.createElement("div");o.className="grid grid-cols-[100px_35px_repeat(5,_minmax(0,_1fr))_35px_repeat(5,_minmax(0,_1fr))] items-stretch border-b border-gray-300";const x=document.createElement("div");x.className="font-bold p-2 flex items-center justify-center bg-gray-100 text-sm border-r border-gray-300",x.textContent=m.toUpperCase(),o.appendChild(x),["lunch","dinner"].forEach(C=>{const P=`${g}-${C}`,w=d[P]||n||1,v=document.createElement("div");v.className="border-r border-gray-300 flex items-center justify-center",v.innerHTML=`<div class="text-center"><i class="fas fa-users fa-xs mb-1"></i><br>${w}</div>`,o.appendChild(v);for(let u=0;u<5;u++){const b=`${g}-${C}-${u}`,f=document.createElement("div");if(f.className="meal-slot p-1 min-h-[50px] border-r border-gray-300",u===4)f.textContent=p[b]||"",f.classList.add("text-xs","italic","text-gray-600");else{const y=i[b];Array.isArray(y)&&y.length>0&&y.forEach(I=>{const h=document.createElement("div");h.className="p-1 bg-white rounded shadow-sm text-center text-xs font-medium";const S=l.find(D=>D.id===I.id)||I;h.textContent=S.name,f.appendChild(h)})}o.appendChild(f)}}),r.appendChild(o)})}export{R as default};
