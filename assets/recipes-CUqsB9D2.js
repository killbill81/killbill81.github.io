import{g as H,c as R,b as F,s as O,a as D,d as T,u as P,o as A,f as z}from"./firebase-config-CDPbqvnt.js";class j{constructor(e,t,a,c,n,l,u,v,m,g,b,y,k,E,o,p){this.db=e,this.modal=document.getElementById(t),this.form=document.getElementById(a),this.modalTitle=document.getElementById(c),this.recipeIdInput=document.getElementById(n),this.recipeNameInput=document.getElementById(l),this.recipeCategoryInput=document.getElementById(u),this.recipeServingsInput=document.getElementById(v),this.recipePrepTimeInput=document.getElementById(m),this.recipeDifficultyInput=document.getElementById(g),this.recipeImageUrlInput=document.getElementById("edit-recipe-image-url"),this.recipeStepsTextarea=document.getElementById(b),this.ingredientsListDiv=document.getElementById(y),this.addIngredientBtn=document.getElementById(k),this.saveRecipeBtn=document.getElementById(E),this.closeButton=document.getElementById(o),this.cancelButton=document.getElementById(p),this.masterIngredientList=[],this.activityUpdater=null,this.boundAddIngredient=()=>this.addIngredientInput(void 0,this.form.ingredients),this.boundCloseForm=()=>this.closeForm(),this.boundHandleSubmit=L=>this.handleSubmit(L),this.addIngredientBtn.addEventListener("click",this.boundAddIngredient),this.closeButton.addEventListener("click",this.boundCloseForm),this.cancelButton.addEventListener("click",this.boundCloseForm),this.saveRecipeBtn.addEventListener("click",this.boundHandleSubmit)}setActivityUpdater(e){this.activityUpdater=e}destroy(){this.addIngredientBtn.removeEventListener("click",this.boundAddIngredient),this.closeButton.removeEventListener("click",this.boundCloseForm),this.cancelButton.removeEventListener("click",this.boundCloseForm),this.saveRecipeBtn.removeEventListener("click",this.boundHandleSubmit)}async openForm(e=null,t="Ajouter une recette"){this.activityUpdater&&this.activityUpdater("editing_recipe"),await this.fetchMasterIngredients(),console.log("openForm called with recipe:",e,"and title:",t),this.form.reset(),this.ingredientsListDiv.innerHTML="",this.modalTitle.textContent=t;const a=[];if(this.form.ingredients=a,e){this.recipeIdInput.value=e.id||"",this.recipeNameInput.value=e.name||"";const c=e.category||"Plat";for(const n of this.recipeCategoryInput.options)if(n.value.toLowerCase()===c.toLowerCase()){n.selected=!0;break}this.recipeServingsInput.value=parseInt(e.servings)||"",this.recipePrepTimeInput.value=parseInt(e.prepTime)||"",this.recipeDifficultyInput.value=e.difficulty||"Moyen",this.recipeImageUrlInput.value=e.imageUrl||"",this.recipeStepsTextarea.value=e.steps||"",e.ingredients&&e.ingredients.length>0?e.ingredients.forEach(n=>this.addIngredientInput({...n},a)):this.addIngredientInput(void 0,a)}else this.recipeIdInput.value="",this.addIngredientInput(void 0,a);this.modal.classList.remove("hidden")}closeForm(){this.activityUpdater&&this.activityUpdater("idle"),this.modal.classList.add("hidden")}async fetchMasterIngredients(){if(this.masterIngredientList=[],!!this.db)try{const e=await H(R(this.db,"ingredients"));this.masterIngredientList=e.docs.map(t=>({id:t.id,...t.data()})),this.masterIngredientList.sort((t,a)=>t.name.localeCompare(a.name))}catch(e){console.error("Erreur lors de la récupération de la liste des ingrédients: ",e),alert("Impossible de charger la liste des ingrédients de base. La recherche ne fonctionnera pas.")}}addIngredientInput(e={quantity:"",name:"",unit:""},t){const a=document.createElement("div");a.className="relative flex items-stretch space-x-2 ingredient-row";const c={...e};t.push(c);const n=t.length-1,l=document.createElement("input");l.type="text",l.className="ingredient-quantity mt-1 block w-1/4 rounded-md border-gray-300 shadow-sm",l.placeholder="Qté",l.value=c.quantity,l.addEventListener("change",y=>{t[n].quantity=y.target.value});const u=document.createElement("input");u.type="text",u.className="ingredient-unit mt-1 block w-1/4 rounded-md border-gray-300 shadow-sm bg-gray-100",u.placeholder="Unité",u.readOnly=!0,u.value=c.unit||"";const v=document.createElement("div");v.className="relative w-1/2";const m=document.createElement("input");m.type="text",m.className="ingredient-name mt-1 block w-full rounded-md border-gray-300 shadow-sm",m.placeholder="Chercher un ingrédient...",m.value=c.name,v.appendChild(m);const g=document.createElement("div");g.className="absolute z-10 w-full bg-white border border-gray-300 rounded-md shadow-lg mt-1 hidden max-h-48 overflow-y-auto",v.appendChild(g),m.addEventListener("input",()=>{const y=m.value.toLowerCase();if(!y){g.classList.add("hidden");return}const k=this.masterIngredientList.filter(o=>o.name.toLowerCase().includes(y));g.innerHTML="",k.forEach(o=>{const p=document.createElement("div");p.className="p-2 ingredient-search-item cursor-pointer",p.textContent=o.name,p.addEventListener("click",()=>{m.value=o.name,u.value=o.unit,g.classList.add("hidden"),t[n].name=o.name,t[n].unit=o.unit,t[n].id=o.id}),g.appendChild(p)});const E=document.createElement("div");E.className="p-2 bg-blue-50 hover:bg-blue-200 cursor-pointer font-bold text-blue-700",E.textContent=`+ Créer "${m.value}"`,E.addEventListener("click",async()=>{const o=m.value,p="pièce(s)";try{const L=await F(R(this.db,"ingredients"),{name:o,unit:p});await this.fetchMasterIngredients(),m.value=o,u.value=p,g.classList.add("hidden"),t[n].name=o,t[n].unit=p,t[n].id=L.id}catch(L){console.error("Erreur d'ajout d'ingrédient",L),alert("L'ingrédient n'a pas pu être créé.")}}),g.appendChild(E),g.classList.remove("hidden")});const b=document.createElement("button");b.type="button",b.className="text-red-500 hover:bg-red-50 text-sm px-3 py-1 rounded-md mt-1",b.innerHTML='<i class="fas fa-trash"></i>',b.addEventListener("click",()=>{a.remove(),t[n]=null}),a.appendChild(v),a.appendChild(l),a.appendChild(u),a.appendChild(b),this.ingredientsListDiv.appendChild(a)}async handleSubmit(e){e.preventDefault(),this.saveRecipeBtn.disabled=!0,this.saveRecipeBtn.innerHTML='<i class="fas fa-spinner fa-spin mr-2"></i> Sauvegarde...',console.log("Ingredients array from form before filter:",this.form.ingredients);const t=this.form.ingredients.filter(n=>n!==null&&n.quantity&&n.name);console.log("Ingredients array after filter:",t);const a={name:this.recipeNameInput.value,category:this.recipeCategoryInput.value,servings:parseInt(this.recipeServingsInput.value)||0,prepTime:parseInt(this.recipePrepTimeInput.value)||0,difficulty:this.recipeDifficultyInput.value,steps:this.recipeStepsTextarea.value,ingredients:t,imageUrl:this.recipeImageUrlInput.value||`https://tse2.mm.bing.net/th?q=${encodeURIComponent(this.recipeNameInput.value)}%20recette&w=400&h=300&c=7&rs=1&p=0`};console.log("Recipe data being sent to Firebase:",a);const c=this.recipeIdInput.value;try{c?await O(D(this.db,"recipes",c),a):await F(R(this.db,"recipes"),a),this.closeForm(),console.log("Recipe saved successfully!"),this.onSaveCallback&&this.onSaveCallback()}catch(n){console.error("Erreur de sauvegarde: ",n),alert("Une erreur est survenue lors de la sauvegarde.")}finally{this.saveRecipeBtn.disabled=!1,this.saveRecipeBtn.textContent="Sauvegarder"}}setOnSaveCallback(e){this.onSaveCallback=e}}let N=null;async function M(S,e){if(!S)return;const t=D(T,"recipes",S);try{await P(t,{isFavorite:!e})}catch(a){console.error("Error toggling favorite status:",a)}}function q(){const S=document.getElementById("search-bar"),e=document.getElementById("category-tabs"),t=document.getElementById("recipe-list-container"),a=document.getElementById("add-recipe-btn");N&&N.destroy(),N=new j(T,"edit-recipe-form-modal","edit-recipe-form","edit-recipe-modal-title","edit-recipe-id","edit-recipe-name","edit-recipe-category","edit-recipe-servings","edit-recipe-prep-time","edit-recipe-difficulty","edit-recipe-steps","edit-ingredients-list","edit-add-ingredient-btn","edit-save-recipe-btn","close-edit-recipe-modal","edit-cancel-recipe-btn"),N.setOnSaveCallback(()=>{});let c=[],n="",l="",u=null;const v=["Entrée","Plat","Accompagnement","Dessert"],m={PLAT:"bg-orange-100",DESSERT:"bg-amber-100",ENTREE:"bg-lime-100",ACCOMPAGNEMENT:"bg-stone-200","PETIT-DEJEUNER":"bg-orange-100",BOISSON:"bg-cyan-100",SAUCE:"bg-red-100"},g={PLAT:"text-orange-800",DESSERT:"text-amber-800",ENTREE:"text-lime-800",ACCOMPAGNEMENT:"text-stone-800","PETIT-DEJEUNER":"text-orange-800",BOISSON:"text-cyan-800",SAUCE:"text-red-800"},b="bg-gray-100",y="text-gray-800";function k(){return T?A(R(T,"recipes"),s=>{console.log("Recipe data updated on /recipes page from listener."),c=s.docs.map(i=>({id:i.id,...i.data()})),o(),p()},s=>{console.error("Erreur lors de l'écoute des recettes: ",s)}):()=>{}}function E(r){n=r,o(),p()}function o(){if(!e)return;e.innerHTML="";const s=[...new Set(c.map(i=>i.category||"Non classé"))].sort((i,d)=>{const h=x=>{const w=x.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase();for(let f=0;f<v.length;f++)if(v[f].normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()===w)return f;return-1},I=h(i),C=h(d);return I>-1&&C>-1?I-C:I>-1?-1:C>-1?1:i.localeCompare(d)});!n&&s.length>0&&(n=s[0]),s.forEach(i=>{const d=document.createElement("button"),h=i.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toUpperCase();if(i===n){const C=m[h]||b,x=g[h]||y;d.className=`px-4 py-2 text-sm font-bold rounded-t-lg ${C} ${x}`}else d.className="px-4 py-2 text-sm font-medium text-gray-500 hover:text-tomato";d.textContent=i,d.addEventListener("click",()=>E(i)),e.appendChild(d)})}function p(){if(!t)return;t.innerHTML="";let r=c.filter(i=>(i.category||"Non classé")===n);if(l){const i=l.toLowerCase();r=r.filter(d=>d.name.toLowerCase().includes(i))}if(r.sort((i,d)=>i.name.localeCompare(d.name)),r.length===0){t.innerHTML='<p class="text-gray-500 text-center p-10">Aucune recette trouvée.</p>';return}const s=document.createElement("div");s.className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",r.forEach(i=>{s.appendChild(L(i))}),t.appendChild(s)}function L(r){const s=document.createElement("div");if(s.className="bg-white dark:bg-gray-800 shadow-md rounded-lg flex flex-col p-3",r.imageUrl){const B=document.createElement("img");B.src=r.imageUrl,B.alt=r.name,B.className="w-full h-24 object-cover rounded-md mb-2",s.appendChild(B)}const i=document.createElement("div");i.className="w-full flex justify-between items-start";const d=document.createElement("h4");d.className="font-bold text-gray-800 dark:text-gray-200 pr-2",d.textContent=r.name,d.title=r.name,i.appendChild(d);const h=document.createElement("button");h.className="text-lg flex-shrink-0",h.innerHTML='<i class="fas fa-heart"></i>',r.isFavorite?h.classList.add("text-red-500"):h.classList.add("text-gray-300","dark:text-gray-500","hover:text-red-400"),h.addEventListener("click",B=>{B.stopPropagation(),M(r.id,r.isFavorite)}),i.appendChild(h),s.appendChild(i);const I=document.createElement("p");I.className="text-sm text-gray-600 dark:text-gray-400 mt-1 w-full",I.textContent=`${r.difficulty||""} - Pour ${r.servings||"?"} pers.`,s.appendChild(I);const C=document.createElement("div");C.className="flex-grow",s.appendChild(C);const x=document.createElement("div");x.className="w-full flex justify-end items-center space-x-2 border-t dark:border-gray-700 pt-2 mt-2";const w=document.createElement("button");w.className="text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/50 text-sm px-3 py-1 rounded-md",w.innerHTML='<i class="fas fa-edit"></i>',w.title="Modifier",w.addEventListener("click",()=>N.openForm(r,"Modifier la recette")),x.appendChild(w);const f=document.createElement("button");return f.className="text-red-500 hover:bg-red-50 dark:hover:bg-red-900/50 text-sm px-3 py-1 rounded-md",f.innerHTML='<i class="fas fa-trash-alt"></i>',f.title="Supprimer",f.addEventListener("click",()=>U(r.id,r.name)),x.appendChild(f),s.appendChild(x),s}async function U(r,s){if(confirm(`Êtes-vous sûr de vouloir supprimer la recette "${s}" ?`))try{await z(D(T,"recipes",r)),fetchAllRecipes()}catch(i){console.error("Erreur lors de la suppression: ",i)}}if(a.addEventListener("click",()=>N.openForm(null,"Ajouter une recette")),S.addEventListener("input",r=>{const s=r.target.value;if(!l&&s&&(u=n),l=s,l){const i=l.toLowerCase(),d=c.find(h=>h.name.toLowerCase().includes(i));d&&(n=d.category||"Non classé")}else u&&(n=u,u=null);o(),p()}),T)return k()}const _=Object.freeze(Object.defineProperty({__proto__:null,default:q,toggleFavoriteStatus:M},Symbol.toStringTag,{value:"Module"}));export{j as R,_ as r,M as t};
