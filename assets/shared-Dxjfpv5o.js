import{q as h,c as y,d as l,w as f,g as C,j as v,b as g,f as w,o as L}from"./firebase-config-DVWBM_53.js";import{g as b}from"./main-3FHrQZxb.js";function M(){const e=E();return x(),()=>{typeof e=="function"&&e()}}async function x(){const e=document.getElementById("received-shares-container"),o=b();if(!(!o||!e)){e.innerHTML='<p class="text-gray-500">Chargement des partages reçus...</p>';try{const s=h(y(l,"plans"),f("userId","==",o),f("isShared","==",!0)),c=h(y(l,"plans"),f("collaborators","array-contains",o)),[a,d]=await Promise.all([C(s),C(c)]);let n=[];if(a.forEach(t=>n.push({id:t.id,type:"Planification (Copie)",...t.data()})),d.forEach(t=>n.push({id:t.id,type:"Planification (Collaboratif)",...t.data()})),n.length===0){e.innerHTML=`<p class="text-gray-500">Vous n'avez aucun contenu partagé par d'autres utilisateurs.</p>`;return}n.sort((t,r)=>(r.sharedAt?.seconds||r.lastUpdated?.seconds||0)-(t.sharedAt?.seconds||t.lastUpdated?.seconds||0)),e.innerHTML="";for(const t of n){const r=t.originalOwnerId||t.userId;if(!r)continue;const i=await v(g(l,"users",r)),u=i.exists()?i.data().displayName:"Utilisateur inconnu";e.appendChild(D(t,u))}}catch(s){console.error("Erreur lors du chargement des partages reçus : ",s),e.innerHTML='<p class="text-red-500">Une erreur est survenue.</p>'}}}function D(e,o){const s=document.createElement("div");s.className="bg-white rounded-lg p-4 flex justify-between items-center shadow-sm";const c=document.createElement("div"),a=document.createElement("p");a.className="font-bold text-gray-800";let d="";e.type.includes("Collaboratif")?d=' <span class="text-xs font-medium bg-blue-100 text-blue-800 px-2 py-1 rounded-full">Collab</span>':e.type.includes("Copie")&&(d=' <span class="text-xs font-medium bg-gray-200 text-gray-800 px-2 py-1 rounded-full">Copie</span>'),a.innerHTML=`${e.name}${d}`;const n=document.createElement("p");n.className="text-sm text-gray-500 mt-1";const t=e.sharedAt?new Date(e.sharedAt.seconds*1e3).toLocaleDateString("fr-FR"):e.lastUpdated?new Date(e.lastUpdated.seconds*1e3).toLocaleDateString("fr-FR"):"date inconnue";n.textContent=`Partagé par ${o} le ${t}`,c.appendChild(a),c.appendChild(n),s.appendChild(c);const r=document.createElement("button");return r.className="text-red-500 hover:bg-red-50 text-sm px-3 py-1 rounded-md",r.addEventListener("click",()=>S(e.id,e.type)),s.appendChild(r),s}async function S(e,o){if(confirm(`Voulez-vous vraiment supprimer cette ${o.toLowerCase()} partagée ?`))try{const s=o.startsWith("Planification")?"plans":"shopping_lists",c=g(l,s,e),a=await v(c);a.exists()&&a.data().userId===b()?(await w(c),x()):(alert("Vous n'avez pas la permission de supprimer cet élément ou il a déjà été supprimé."),x())}catch(s){console.error("Erreur de suppression: ",s),alert("Une erreur est survenue.")}}async function E(){const e=document.getElementById("sent-shares-container"),o=b();if(!o||!e)return()=>{};e.innerHTML='<p class="text-gray-500">Chargement des partages envoyés...</p>';const s=y(l,"shares"),c=h(s,f("senderId","==",o));return L(c,async a=>{if(a.empty){e.innerHTML=`<p class="text-gray-500">Vous n'avez envoyé aucun partage.</p>`;return}const d=a.docs.sort((n,t)=>(t.data().createdAt?.seconds||0)-(n.data().createdAt?.seconds||0));e.innerHTML="";for(const n of d){const t=n.data();try{const r=await v(g(l,"users",t.receiverId));if(r.exists()){const i=r.data();e.appendChild(I(t,i.displayName,n.id))}}catch(r){console.error("Could not load receiver for sent share",r)}}},a=>{console.error("Erreur lors du chargement des partages envoyés : ",a),e&&(e.innerHTML='<p class="text-red-500">Une erreur est survenue.</p>')})}function I(e,o,s){const c=document.createElement("div");c.className="bg-white rounded-lg p-4 flex justify-between items-center shadow-sm";const a=document.createElement("div"),d=document.createElement("p");d.className="font-bold text-gray-800";let n=[];e.plan&&n.push("Planification"),e.shoppingList&&n.push("Liste de courses"),d.textContent=n.join(" et ");const t=document.createElement("p");t.className="text-sm text-gray-500";const r=new Date(e.createdAt.seconds*1e3).toLocaleDateString("fr-FR");t.textContent=`Envoyé à ${o} le ${r}`,a.appendChild(d),a.appendChild(t),c.appendChild(a);const i=document.createElement("div");i.className="flex items-center space-x-4";const u=document.createElement("span");u.textContent=e.status;let m="bg-gray-200 text-gray-800";switch(e.status){case"accepted":m="bg-green-100 text-green-800";break;case"declined":m="bg-red-100 text-red-800";break;case"pending":m="bg-yellow-100 text-yellow-800";break}u.className=`text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full ${m}`,i.appendChild(u);const p=document.createElement("button");return p.className="text-red-500 hover:bg-red-50 text-sm px-3 py-1 rounded-md",p.innerHTML='<i class="fas fa-trash"></i>',p.title="Annuler le partage",p.addEventListener("click",()=>N(s)),i.appendChild(p),c.appendChild(i),c}async function N(e){if(confirm("Voulez-vous vraiment annuler ce partage ? L'autre utilisateur ne le verra plus."))try{await w(g(l,"shares",e)),E()}catch(o){console.error("Erreur lors de la suppression du partage: ",o),alert("Une erreur est survenue.")}}export{M as default};
