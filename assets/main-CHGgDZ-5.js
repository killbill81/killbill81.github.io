import{o as Zt,s as en,a as Bt,g as de,c as H,b as Ie,d as ot,e as j,q as me,f,w as Z,u as Ee,h as Xe,i as Se,j as tn,k as $e,l as $t,m as Mt,n as nn,r as an,_ as sn}from"./firebase-config-D04zk_Ph.js";const rn=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));let lt=null;function jt(){return new Promise(e=>{Zt(Bt,t=>{if(lt=t,t){console.log("User is logged in:",t.uid);const n=document.getElementById("logout-btn"),r=document.getElementById("profile-btn");n&&n.classList.remove("hidden"),r&&r.classList.remove("hidden"),n&&!n.hasAttribute("data-listener-attached")&&(n.addEventListener("click",()=>{en(Bt).catch(l=>{console.error("Sign Out Error",l)})}),n.setAttribute("data-listener-attached","true")),e(t)}else{console.log("User not logged in. Redirecting to login.html");const n=window.location.origin+"/login.html";window.location.href!==n&&(window.location.href=n),e(null)}})})}function Ce(){return lt?lt.uid:null}function Te(){return lt}const on=Object.freeze(Object.defineProperty({__proto__:null,getCurrentUser:Te,getCurrentUserId:Ce,protectPage:jt},Symbol.toStringTag,{value:"Module"}));class Ct{constructor(t,n,r,l,c,p,m,g,b,S,M,L,O,v,U,Y){this.db=t,this.modal=document.getElementById(n),this.form=document.getElementById(r),this.modalTitle=document.getElementById(l),this.recipeIdInput=document.getElementById(c),this.recipeNameInput=document.getElementById(p),this.recipeCategoryInput=document.getElementById(m),this.recipeServingsInput=document.getElementById(g),this.recipePrepTimeInput=document.getElementById(b),this.recipeDifficultyInput=document.getElementById(S),this.recipeStepsTextarea=document.getElementById(M),this.ingredientsListDiv=document.getElementById(L),this.addIngredientBtn=document.getElementById(O),this.saveRecipeBtn=document.getElementById(v),this.closeButton=document.getElementById(U),this.cancelButton=document.getElementById(Y),this.masterIngredientList=[],this.boundAddIngredient=()=>this.addIngredientInput(void 0,this.form.ingredients),this.boundCloseForm=()=>this.closeForm(),this.boundHandleSubmit=X=>this.handleSubmit(X),this.addIngredientBtn.addEventListener("click",this.boundAddIngredient),this.closeButton.addEventListener("click",this.boundCloseForm),this.cancelButton.addEventListener("click",this.boundCloseForm),this.saveRecipeBtn.addEventListener("click",this.boundHandleSubmit)}destroy(){this.addIngredientBtn.removeEventListener("click",this.boundAddIngredient),this.closeButton.removeEventListener("click",this.boundCloseForm),this.cancelButton.removeEventListener("click",this.boundCloseForm),this.saveRecipeBtn.removeEventListener("click",this.boundHandleSubmit)}async openForm(t=null,n="Ajouter une recette"){await this.fetchMasterIngredients(),console.log("openForm called with recipe:",t,"and title:",n),this.form.reset(),this.ingredientsListDiv.innerHTML="",this.modalTitle.textContent=n;const r=[];if(this.form.ingredients=r,t){this.recipeIdInput.value=t.id||"",this.recipeNameInput.value=t.name||"";const l=t.category||"Plat";for(const c of this.recipeCategoryInput.options)if(c.value.toLowerCase()===l.toLowerCase()){c.selected=!0;break}this.recipeServingsInput.value=parseInt(t.servings)||"",this.recipePrepTimeInput.value=parseInt(t.prepTime)||"",this.recipeDifficultyInput.value=t.difficulty||"Moyen",this.recipeStepsTextarea.value=t.steps||"",t.ingredients&&t.ingredients.length>0?t.ingredients.forEach(c=>this.addIngredientInput({...c},r)):this.addIngredientInput(void 0,r)}else this.recipeIdInput.value="",this.addIngredientInput(void 0,r);this.modal.classList.remove("hidden")}closeForm(){this.modal.classList.add("hidden")}async fetchMasterIngredients(){if(this.masterIngredientList=[],!!this.db)try{const t=await de(H(this.db,"ingredients"));this.masterIngredientList=t.docs.map(n=>({id:n.id,...n.data()})),this.masterIngredientList.sort((n,r)=>n.name.localeCompare(r.name))}catch(t){console.error("Erreur lors de la r√©cup√©ration de la liste des ingr√©dients: ",t),alert("Impossible de charger la liste des ingr√©dients de base. La recherche ne fonctionnera pas.")}}addIngredientInput(t={quantity:"",name:"",unit:""},n){const r=document.createElement("div");r.className="relative flex items-stretch space-x-2 ingredient-row";const l={...t};n.push(l);const c=n.length-1,p=document.createElement("input");p.type="text",p.className="ingredient-quantity mt-1 block w-1/4 rounded-md border-gray-300 shadow-sm",p.placeholder="Qt√©",p.value=l.quantity,p.addEventListener("change",L=>{n[c].quantity=L.target.value});const m=document.createElement("input");m.type="text",m.className="ingredient-unit mt-1 block w-1/4 rounded-md border-gray-300 shadow-sm bg-gray-100",m.placeholder="Unit√©",m.readOnly=!0,m.value=l.unit||"";const g=document.createElement("div");g.className="relative w-1/2";const b=document.createElement("input");b.type="text",b.className="ingredient-name mt-1 block w-full rounded-md border-gray-300 shadow-sm",b.placeholder="Chercher un ingr√©dient...",b.value=l.name,g.appendChild(b);const S=document.createElement("div");S.className="absolute z-10 w-full bg-white border border-gray-300 rounded-md shadow-lg mt-1 hidden max-h-48 overflow-y-auto",g.appendChild(S),b.addEventListener("input",()=>{const L=b.value.toLowerCase();if(!L){S.classList.add("hidden");return}const O=this.masterIngredientList.filter(U=>U.name.toLowerCase().includes(L));S.innerHTML="",O.forEach(U=>{const Y=document.createElement("div");Y.className="p-2 hover:bg-tomato hover:text-white cursor-pointer",Y.textContent=U.name,Y.addEventListener("click",()=>{b.value=U.name,m.value=U.unit,S.classList.add("hidden"),n[c].name=U.name,n[c].unit=U.unit,n[c].id=U.id}),S.appendChild(Y)});const v=document.createElement("div");v.className="p-2 bg-blue-50 hover:bg-blue-200 cursor-pointer font-bold text-blue-700",v.textContent=`+ Cr√©er "${b.value}"`,v.addEventListener("click",async()=>{const U=b.value,Y="pi√®ce(s)";try{const X=await Ie(H(this.db,"ingredients"),{name:U,unit:Y});await this.fetchMasterIngredients(),b.value=U,m.value=Y,S.classList.add("hidden"),n[c].name=U,n[c].unit=Y,n[c].id=X.id}catch(X){console.error("Erreur d'ajout d'ingr√©dient",X),alert("L'ingr√©dient n'a pas pu √™tre cr√©√©.")}}),S.appendChild(v),S.classList.remove("hidden")});const M=document.createElement("button");M.type="button",M.className="btn btn-ghost text-red-500 hover:bg-red-50 btn-sm mt-1",M.innerHTML='<i class="fas fa-trash"></i>',M.addEventListener("click",()=>{r.remove(),n[c]=null}),r.appendChild(g),r.appendChild(p),r.appendChild(m),r.appendChild(M),this.ingredientsListDiv.appendChild(r)}async handleSubmit(t){t.preventDefault(),this.saveRecipeBtn.disabled=!0,this.saveRecipeBtn.innerHTML='<i class="fas fa-spinner fa-spin mr-2"></i> Sauvegarde...',console.log("Ingredients array from form before filter:",this.form.ingredients);const n=this.form.ingredients.filter(c=>c!==null&&c.quantity&&c.name);console.log("Ingredients array after filter:",n);const r={name:this.recipeNameInput.value,category:this.recipeCategoryInput.value,servings:parseInt(this.recipeServingsInput.value)||0,prepTime:parseInt(this.recipePrepTimeInput.value)||0,difficulty:this.recipeDifficultyInput.value,steps:this.recipeStepsTextarea.value,ingredients:n,imageUrl:""};console.log("Recipe data being sent to Firebase:",r);const l=this.recipeIdInput.value;try{l?await ot(j(this.db,"recipes",l),r):await Ie(H(this.db,"recipes"),r),this.closeForm(),console.log("Recipe saved successfully!"),this.onSaveCallback&&this.onSaveCallback()}catch(c){console.error("Erreur de sauvegarde: ",c),alert("Une erreur est survenue lors de la sauvegarde.")}finally{this.saveRecipeBtn.disabled=!1,this.saveRecipeBtn.textContent="Sauvegarder"}}setOnSaveCallback(t){this.onSaveCallback=t}}const ln=Object.freeze(Object.defineProperty({__proto__:null,RecipeFormHandler:Ct},Symbol.toStringTag,{value:"Module"}));let bt=()=>{};function dn(){const e=document.getElementById("search-friends-input");return document.getElementById("search-friends-btn").addEventListener("click",()=>Nt(e.value)),e.addEventListener("keyup",n=>{n.key==="Enter"&&Nt(e.value)}),cn(),Rt(),()=>{bt&&bt()}}async function cn(){const e=document.getElementById("friends-list-container"),t=Te()?.uid;if(!t||!e)return;e.innerHTML='<p class="text-gray-500">Chargement...</p>';const n=j(f,"users",t);bt=Xe(n,async r=>{if(!r.exists()){e.innerHTML='<p class="text-red-500">Erreur: Utilisateur non trouv√©.</p>';return}const l=r.data().friends||[];if(e.innerHTML="",l.length===0){e.innerHTML=`<p class="text-gray-500">Vous n'avez pas encore d'amis. Utilisez la recherche pour en ajouter.</p>`;return}for(const c of l)try{const p=await Se(j(f,"users",c));p.exists()&&e.appendChild(un(p.data()))}catch(p){console.error("Erreur de chargement d'un ami",p)}})}function un(e){const t=document.createElement("div");t.className="bg-white p-3 rounded-lg flex items-center justify-between shadow-sm";const n=document.createElement("div");n.className="flex items-center",n.innerHTML=`
        <img src="${e.photoURL||"https://placehold.co/40"}" alt="Avatar" class="w-10 h-10 rounded-full mr-3">
        <div>
            <p class="font-bold">${e.displayName}</p>
            <p class="text-sm text-gray-500">${e.email}</p>
        </div>
    `;const r=document.createElement("button");return r.className="btn btn-ghost text-red-500 btn-sm",r.innerHTML='<i class="fas fa-user-times"></i>',r.title="Retirer cet ami",r.addEventListener("click",()=>mn(e.uid)),t.appendChild(n),t.appendChild(r),t}async function mn(e){const t=Te()?.uid;if(!t||!e){console.error("Impossible de supprimer l'ami : ID utilisateur ou ID ami manquant.");return}if(!confirm("Voulez-vous vraiment retirer cet ami ? Cette action est unilat√©rale."))return;console.log(`Tentative de suppression de l'ami ${e} pour l'utilisateur ${t}`);const n=j(f,"users",t);try{await Ee(n,{friends:$t(e)}),console.log("Ami supprim√© avec succ√®s de la base de donn√©es.")}catch(r){console.error("Erreur lors de la suppression de l'ami: ",r),alert("Une erreur est survenue.")}}async function Nt(e){const t=document.getElementById("search-results-container"),n=Te()?.uid;if(!(!e||!t)){t.innerHTML='<p class="text-gray-500">Recherche en cours...</p>';try{const r=e.toLowerCase(),l=r+"Ô£ø",c=me(H(f,"users"),Z("displayName_lowercase",">=",r),Z("displayName_lowercase","<",l)),p=me(H(f,"users"),Z("email","==",r)),[m,g]=await Promise.all([de(c),de(p)]),b=new Map;if(m.forEach(S=>b.set(S.id,S.data())),g.forEach(S=>b.set(S.id,S.data())),t.innerHTML="",b.size===0){t.innerHTML='<p class="text-gray-500">Aucun utilisateur trouv√©.</p>';return}b.forEach(S=>{if(S.uid===n)return;const M=document.createElement("div");M.className="bg-gray-50 p-2 rounded-lg flex items-center justify-between",M.innerHTML=`
                <div class="flex items-center">
                    <img src="${S.photoURL||"https://placehold.co/32"}" class="w-8 h-8 rounded-full mr-2">
                    <span class="font-medium text-sm">${S.displayName} (${S.email})</span>
                </div>
            `;const L=document.createElement("button");L.className="btn btn-secondary btn-xs",L.innerHTML='<i class="fas fa-user-plus"></i>',L.addEventListener("click",()=>pn(S.uid)),M.appendChild(L),t.appendChild(M)})}catch(r){console.error("Erreur de recherche: ",r),t.innerHTML='<p class="text-red-500">Erreur de recherche.</p>'}}}async function pn(e){const t=Te()?.uid;if(!t||t===e)return;const n=me(H(f,"friend_requests"),Z("senderId","==",t),Z("receiverId","==",e)),r=me(H(f,"friend_requests"),Z("senderId","==",e),Z("receiverId","==",t)),[l,c]=await Promise.all([de(n),de(r)]);if(!l.empty||!c.empty)return alert("Une demande d'ami existe d√©j√† avec cet utilisateur.");if((await Se(j(f,"users",t))).data()?.friends?.includes(e))return alert("Vous √™tes d√©j√† ami avec cet utilisateur.");try{await Ie(H(f,"friend_requests"),{senderId:t,receiverId:e,status:"pending",createdAt:tn()}),alert("Demande d'ami envoy√©e !")}catch(m){console.error("Erreur lors de l'envoi de la demande d'ami: ",m),alert("Une erreur est survenue.")}}async function Rt(){const e=document.getElementById("pending-requests-container"),t=document.getElementById("declined-requests-container"),n=Te()?.uid;if(!(!n||!e||!t)){e.innerHTML='<p class="text-gray-500">Chargement...</p>',t.innerHTML='<p class="text-gray-500">Chargement...</p>';try{const r=me(H(f,"friend_requests"),Z("senderId","==",n)),l=await de(r),c=[],p=[];for(const m of l.docs){const g={id:m.id,...m.data()},b=await Se(j(f,"users",g.receiverId));b.exists()&&(g.receiver=b.data()),g.status==="pending"?c.push(g):g.status==="declined"&&p.push(g)}e.innerHTML="",c.length>0?c.forEach(m=>e.appendChild(kt(m))):e.innerHTML='<p class="text-gray-500">Aucune demande en attente.</p>',t.innerHTML="",p.length>0?p.forEach(m=>t.appendChild(kt(m))):t.innerHTML='<p class="text-gray-500">Aucune demande rejet√©e.</p>'}catch(r){console.error("Erreur lors du chargement des demandes envoy√©es: ",r),e.innerHTML='<p class="text-red-500">Erreur de chargement.</p>',t.innerHTML='<p class="text-red-500">Erreur de chargement.</p>'}}}function kt(e){const t=document.createElement("div");t.className="bg-white p-3 rounded-lg flex items-center justify-between shadow-sm";const n=e.receiver,r=document.createElement("div");r.className="flex items-center",r.innerHTML=`
        <img src="${n?.photoURL||"https://placehold.co/40"}" alt="Avatar" class="w-10 h-10 rounded-full mr-3">
        <div>
            <p class="font-bold">${n?.displayName||"Utilisateur inconnu"}</p>
            <p class="text-sm text-gray-500">Statut : <span class="font-medium">${e.status}</span></p>
        </div>
    `;const l=document.createElement("button");return l.className="btn btn-ghost text-red-500 btn-sm",l.innerHTML='<i class="fas fa-times-circle"></i>',l.title="Annuler la demande",l.addEventListener("click",async()=>{confirm("Voulez-vous vraiment annuler cette demande ?")&&(await $e(j(f,"friend_requests",e.id)),Rt())}),t.appendChild(r),t.appendChild(l),t}async function At(e){try{const t=j(f,"friend_requests",e);await Ee(t,{status:"accepted"})}catch(t){throw console.error("Erreur lors de l'acceptation de la demande d'ami: ",t),t}}async function qt(e){try{const t=j(f,"friend_requests",e);await Ee(t,{status:"declined"})}catch(t){throw console.error("Erreur lors du refus de la demande d'ami: ",t),t}}const fn=Object.freeze(Object.defineProperty({__proto__:null,acceptFriendRequest:At,declineFriendRequest:qt,default:dn},Symbol.toStringTag,{value:"Module"}));function gn(){const e=document.getElementById("ingredients-list-container"),t=document.getElementById("add-ingredient-btn"),n=document.getElementById("category-tabs"),r=document.getElementById("search-bar"),l=document.getElementById("ingredient-form-modal"),c=document.getElementById("ingredient-modal-title"),p=document.getElementById("close-ingredient-modal"),m=document.getElementById("cancel-ingredient-btn"),g=document.getElementById("ingredient-form"),b=document.getElementById("ingredient-id"),S=document.getElementById("ingredient-name"),M=document.getElementById("ingredient-unit"),L=document.getElementById("ingredient-category"),O=document.getElementById("manage-categories-btn"),v=document.getElementById("category-management-modal"),U=document.getElementById("close-category-modal"),Y=document.getElementById("done-category-modal-btn"),X=document.getElementById("add-category-form"),Me=document.getElementById("new-category-name"),R=document.getElementById("category-list");let F=[],D=[],A="",G="",pe=null;const ne=["g","kg","ml","l","pi√®ce(s)","c.√†.s.","c.√†.c.","pinc√©e(s)"];async function ce(){await be(),await ae()}async function be(){if(f)try{D=(await de(H(f,"ingredient_categories"))).docs.map(B=>({id:B.id,...B.data()})),D.sort((B,w)=>B.name.localeCompare(w.name))}catch(T){console.error("Erreur lors de la r√©cup√©ration des cat√©gories: ",T)}}async function ae(){if(f)try{F=(await de(H(f,"ingredients"))).docs.map(B=>({id:B.id,...B.data()})),Q(),se()}catch(T){console.error("Erreur de chargement des ingr√©dients: ",T)}}function je(T=null){g.reset(),M.innerHTML="",ne.forEach(P=>{const W=document.createElement("option");W.value=P,W.textContent=P,M.appendChild(W)});const B=D.map(P=>P.name),w=[...new Set(F.map(P=>P.category).filter(Boolean))],C=[...new Set([...B,...w])];C.sort((P,W)=>P.localeCompare(W.name)),L.innerHTML="",C.forEach(P=>{const W=document.createElement("option");W.value=P,W.textContent=P,L.appendChild(W)}),T?(c.textContent="Modifier l'ingr√©dient",b.value=T.id,S.value=T.name,M.value=T.unit||"",L.value=T.category||(C.length>0?C[0]:"")):(c.textContent="Ajouter un ingr√©dient",b.value="",M.value=ne[0],L.value=A||(C.length>0?C[0]:"")),l.classList.remove("hidden")}function Re(){l.classList.add("hidden")}async function k(T){T.preventDefault();const B=b.value,w={name:S.value,unit:M.value,category:L.value};if(!w.name||!w.category){alert("Le nom et la cat√©gorie sont requis.");return}try{B?await ot(j(f,"ingredients",B),w):await Ie(H(f,"ingredients"),w),Re(),await ae()}catch(C){console.error("Erreur de sauvegarde de l'ingr√©dient: ",C)}}function E(){q(),v.classList.remove("hidden")}function $(){v.classList.add("hidden")}function q(){if(R.innerHTML="",D.length===0){R.innerHTML='<p class="text-gray-500">Aucune cat√©gorie d√©finie.</p>';return}D.forEach(T=>{const B=document.createElement("div");B.className="flex items-center justify-between p-2 border-b";const w=document.createElement("span");w.textContent=T.name,B.appendChild(w);const C=document.createElement("div");C.className="flex space-x-2";const P=document.createElement("button");P.className="btn btn-ghost btn-xs text-blue-500",P.innerHTML='<i class="fas fa-edit"></i>',P.addEventListener("click",()=>V(T)),C.appendChild(P);const W=document.createElement("button");W.className="btn btn-ghost btn-xs text-red-500",W.innerHTML='<i class="fas fa-trash"></i>',W.addEventListener("click",()=>ie(T)),C.appendChild(W),B.appendChild(C),R.appendChild(B)})}async function K(T){T.preventDefault();const B=Me.value.trim();if(B&&!D.find(w=>w.name.toLowerCase()===B.toLowerCase()))try{await Ie(H(f,"ingredient_categories"),{name:B}),Me.value="",await be(),q(),Q()}catch(w){console.error("Erreur d'ajout de cat√©gorie: ",w)}else alert("Cette cat√©gorie existe d√©j√† ou le nom est invalide.")}async function V(T){const B=T.name,w=prompt(`Entrez le nouveau nom pour la cat√©gorie "${B}":`,B);if(w&&w.trim()!==""&&w!==B)try{await ot(j(f,"ingredient_categories",T.id),{name:w});const C=me(H(f,"ingredients"),Z("category","==",B)),P=await de(C),W=Mt(f);P.forEach(Ae=>{W.update(Ae.ref,{category:w})}),await W.commit(),await ce(),q()}catch(C){console.error("Erreur de renommage: ",C)}}async function ie(T){if(confirm(`√ätes-vous s√ªr de vouloir supprimer la cat√©gorie "${T.name}"?

Tous les ingr√©dients associ√©s seront d√©plac√©s vers la cat√©gorie "Inconnue".`))try{await $e(j(f,"ingredient_categories",T.id));const B=me(H(f,"ingredients"),Z("category","==",T.name)),w=await de(B),C=Mt(f);w.forEach(P=>{C.update(P.ref,{category:"Inconnue"})}),await C.commit(),A="",await ce(),q()}catch(B){console.error("Erreur de suppression: ",B)}}function Q(){n.innerHTML="";const T=D.map(C=>C.name),B=[...new Set(F.map(C=>C.category||"Inconnue"))];let w=[...new Set([...T,...B])];w.sort((C,P)=>C.localeCompare(P)),w.includes("Inconnue")&&(w=w.filter(C=>C!=="Inconnue"),w.push("Inconnue")),w.length===0&&F.length>0&&w.push("Inconnue"),!A&&w.length>0&&(A=w[0]),w.forEach(C=>{const P=document.createElement("button"),W=C===A;P.className=`px-4 py-2 text-sm font-medium rounded-t-lg ${W?"bg-tomato text-white":"text-gray-500 hover:text-tomato"}`,P.textContent=C,P.addEventListener("click",()=>J(C)),n.appendChild(P)})}function J(T){A=T,Q(),se()}function se(){e.innerHTML="";const T=A||(D.length>0?D[0].name:"Inconnue");let B=F.filter(C=>(C.category||"Inconnue")===T);if(G){const C=G.toLowerCase();B=B.filter(P=>P.name.toLowerCase().includes(C))}if(B.length===0){e.innerHTML='<p class="text-center text-gray-500 p-10">Aucun ingr√©dient dans cette cat√©gorie.</p>';return}B.sort((C,P)=>C.name.localeCompare(P.name,"fr",{sensitivity:"base"}));const w=document.createElement("div");w.className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",B.forEach(C=>{const P=document.createElement("div");P.className="p-3 bg-white shadow-sm rounded-lg flex flex-col items-start space-y-2";const W=document.createElement("div");W.className="flex-grow w-full flex justify-between items-center";const Ae=document.createElement("span");Ae.className="font-medium text-gray-800",Ae.textContent=C.name;const Ye=document.createElement("span");Ye.className="text-gray-500 text-sm bg-gray-100 px-2 py-1 rounded-full",Ye.textContent=C.unit,W.appendChild(Ae),W.appendChild(Ye);const ze=document.createElement("div");ze.className="w-full flex justify-end items-center space-x-2 border-t pt-2 mt-2";const Ve=document.createElement("button");Ve.className="btn btn-ghost btn-xs text-blue-500 hover:bg-blue-50",Ve.innerHTML='<i class="fas fa-edit"></i>',Ve.addEventListener("click",()=>je(C));const Qe=document.createElement("button");Qe.className="btn btn-ghost btn-xs text-red-500 hover:bg-red-50",Qe.innerHTML='<i class="fas fa-trash-alt"></i>',Qe.addEventListener("click",()=>he(C.id,C.name)),ze.appendChild(Ve),ze.appendChild(Qe),P.appendChild(W),P.appendChild(ze),w.appendChild(P)}),e.appendChild(w)}async function he(T,B){if(confirm(`√ätes-vous s√ªr de vouloir supprimer l'ingr√©dient "${B}" ?`))try{await $e(j(f,"ingredients",T)),await ae()}catch(w){console.error("Erreur de suppression de l'ingr√©dient: ",w)}}r.addEventListener("input",T=>{const B=T.target.value.toLowerCase();if(!G&&B&&(pe=A),G=B,G){const w=F.find(C=>C.name.toLowerCase().includes(G));w&&(A=w.category||"Inconnue")}else pe&&(A=pe,pe=null);Q(),se()}),t.addEventListener("click",()=>je()),p.addEventListener("click",Re),m.addEventListener("click",Re),g.addEventListener("submit",k),O.addEventListener("click",E),U.addEventListener("click",$),Y.addEventListener("click",$),X.addEventListener("submit",K),ce()}const hn=Object.freeze(Object.defineProperty({__proto__:null,default:gn},Symbol.toStringTag,{value:"Module"})),ue={modal:document.getElementById("share-modal"),closeBtn:document.getElementById("close-share-modal"),title:document.getElementById("share-modal-title"),friendsList:document.getElementById("share-friends-list"),sharePlanCheckbox:document.getElementById("share-planning-checkbox"),shareShoppingListCheckbox:document.getElementById("share-shopping-list-checkbox"),confirmBtn:document.getElementById("confirm-share-btn")};let _e={};function Lt(){ue.modal.classList.add("hidden")}async function bn(){const e=Ce();if(!e||!_e.plan)return;const t=Array.from(ue.friendsList.querySelectorAll('input[type="checkbox"]:checked')).map(r=>r.value),n=document.querySelector('input[name="share-mode"]:checked')?.value;if(t.length===0){alert("Veuillez s√©lectionner au moins un ami.");return}if(!n){alert("Veuillez s√©lectionner un mode de partage.");return}ue.confirmBtn.disabled=!0,ue.confirmBtn.textContent="Envoi en cours...";try{const r=H(f,"shares");let l={};n==="collaborate"?l={senderId:e,createdAt:new Date,type:"collaborative_plan_invite",planId:_e.plan.id,planName:_e.plan.name}:l={senderId:e,createdAt:new Date,type:"share",plan:{name:_e.plan.name,weeks:_e.plan.weeks||{},manualItems:_e.plan.manualItems||[],defaultNumPeople:_e.plan.defaultNumPeople||1,startDay:_e.plan.startDay||"Lundi"}};for(const c of t)await Ie(r,{...l,receiverId:c,status:"pending"});Lt(),alert("Partage envoy√© avec succ√®s !")}catch(r){console.error("Erreur lors de l'envoi du partage : ",r),alert("Une erreur est survenue lors de l'envoi du partage.")}finally{ue.confirmBtn.disabled=!1,ue.confirmBtn.textContent="Envoyer le partage"}}async function It(e={}){const{plan:t}=e;if(!t){alert("Aucun plan s√©lectionn√© √† partager.");return}_e={plan:t},ue.title.textContent=`Partager le plan "${t.name}"`,ue.friendsList.innerHTML='<p class="text-gray-500">Chargement des amis...</p>',ue.modal.classList.remove("hidden");const n=Ce();if(n)try{const r=await Se(j(f,"users",n));if(r.exists()){const c=r.data().friends||[];if(c.length===0){ue.friendsList.innerHTML=`<p class="text-gray-500">Vous n'avez pas d'amis √† qui partager.</p>`;return}ue.friendsList.innerHTML="";for(const p of c){const m=await Se(j(f,"users",p));if(m.exists()){const g=m.data(),b=document.createElement("label");b.className="flex items-center p-2 hover:bg-gray-100 rounded-lg cursor-pointer";const S=document.createElement("input");S.type="checkbox",S.value=g.uid,S.className="form-checkbox h-5 w-5 text-tomato rounded focus:ring-tomato",b.appendChild(S);const M=document.createElement("img");M.src=g.photoURL||"https://placehold.co/40x40",M.alt=g.displayName,M.className="w-8 h-8 rounded-full ml-3 mr-3",b.appendChild(M);const L=document.createElement("span");L.className="font-medium",L.textContent=g.displayName||g.email,b.appendChild(L),ue.friendsList.appendChild(b)}}}}catch(r){console.error("Erreur lors du chargement des amis pour le partage : ",r),ue.friendsList.innerHTML='<p class="text-red-500">Une erreur est survenue.</p>'}}ue.closeBtn?.addEventListener("click",Lt);ue.modal?.addEventListener("click",e=>{e.target===ue.modal&&Lt()});ue.confirmBtn?.addEventListener("click",bn);const yn=Object.freeze(Object.defineProperty({__proto__:null,openShareModal:It},Symbol.toStringTag,{value:"Module"}));function vn(){const e=document.getElementById("search-bar"),t=document.getElementById("lists-container"),n=document.getElementById("add-list-btn"),r=document.getElementById("shared-lists-container"),l=document.getElementById("list-form-modal"),c=document.getElementById("list-modal-title"),p=document.getElementById("close-list-modal"),m=document.getElementById("cancel-list-btn"),g=document.getElementById("list-form"),b=document.getElementById("list-id"),S=document.getElementById("list-name"),M=document.getElementById("ingredients-list"),L=document.getElementById("add-ingredient-btn"),O=document.getElementById("save-list-btn");let v=[],U="",Y=[],X=[];async function Me(){await R(),await F(),await D()}async function R(){if(f)try{Y=(await de(H(f,"ingredients"))).docs.map(E=>({id:E.id,...E.data()})),Y.sort((E,$)=>E.name.localeCompare($.name))}catch(k){console.error("Erreur lors de la r√©cup√©ration de la liste des ingr√©dients: ",k)}}async function F(){const k=Ce();if(!(!f||!k))try{const E=me(H(f,"shopping_lists"),Z("userId","==",k));v=(await de(E)).docs.map(q=>({id:q.id,...q.data()})).filter(q=>q.isShared!==!0),ce()}catch(E){console.error("Erreur de chargement des listes: ",E)}}async function D(){const k=Ce();if(!(!f||!k)){console.log(`Recherche de listes partag√©es pour userId: ${k}`);try{const E=me(H(f,"shopping_lists"),Z("userId","==",k),Z("isShared","==",!0)),$=await de(E);console.log(`Trouv√© ${$.size} liste(s) partag√©e(s).`);const q=$.docs.map(K=>({id:K.id,...K.data()}));be(q)}catch(E){console.error("Erreur de chargement des listes partag√©es: ",E)}}}async function A(k=null){await R(),g.reset(),M.innerHTML="",X=[],k?(c.textContent="Modifier la liste",b.value=k.id,S.value=k.name,k.ingredients&&k.ingredients.length>0?k.ingredients.forEach(E=>ne(E)):ne()):(c.textContent="Cr√©er une liste",b.value="",ne()),l.classList.remove("hidden")}function G(){l.classList.add("hidden")}async function pe(k){k.preventDefault(),O.disabled=!0;const E=Ce();if(!E){alert("Erreur : utilisateur non connect√©."),O.disabled=!1;return}const $=X.filter(V=>V&&V.name&&V.quantity),q={name:S.value,ingredients:$,userId:E};if(!q.name){alert("Le nom de la liste est requis."),O.disabled=!1;return}const K=b.value;try{K?await ot(j(f,"shopping_lists",K),q):await Ie(H(f,"shopping_lists"),q),G(),await F()}catch(V){console.error("Erreur de sauvegarde de la liste: ",V)}finally{O.disabled=!1}}function ne(k={quantity:"",name:"",unit:""}){const E=document.createElement("div");E.className="relative flex items-stretch space-x-2 ingredient-row";const $={...k};X.push($);const q=X.length-1,K=document.createElement("input");K.type="text",K.className="ingredient-quantity mt-1 block w-1/4 rounded-md border-gray-300 shadow-sm",K.placeholder="Qt√©",K.value=$.quantity,K.addEventListener("change",he=>{X[q].quantity=he.target.value});const V=document.createElement("input");V.type="text",V.className="ingredient-unit mt-1 block w-1/4 rounded-md border-gray-300 shadow-sm bg-gray-100",V.placeholder="Unit√©",V.readOnly=!0,V.value=$.unit||"";const ie=document.createElement("div");ie.className="relative w-1/2";const Q=document.createElement("input");Q.type="text",Q.className="ingredient-name mt-1 block w-full rounded-md border-gray-300 shadow-sm",Q.placeholder="Chercher un ingr√©dient...",Q.value=$.name,ie.appendChild(Q);const J=document.createElement("div");J.className="absolute z-10 w-full bg-white border border-gray-300 rounded-md shadow-lg mt-1 hidden max-h-48 overflow-y-auto",ie.appendChild(J),Q.addEventListener("input",()=>{const he=Q.value.toLowerCase();if(!he){J.classList.add("hidden");return}const T=Y.filter(w=>w.name.toLowerCase().includes(he));J.innerHTML="",T.forEach(w=>{const C=document.createElement("div");C.className="p-2 hover:bg-tomato hover:text-white cursor-pointer",C.textContent=w.name,C.addEventListener("click",()=>{Q.value=w.name,V.value=w.unit,J.classList.add("hidden"),X[q].name=w.name,X[q].unit=w.unit,X[q].id=w.id}),J.appendChild(C)});const B=document.createElement("div");B.className="p-2 bg-blue-50 hover:bg-blue-200 cursor-pointer font-bold text-blue-700",B.textContent=`+ Cr√©er "${Q.value}"`,B.addEventListener("click",async()=>{const w=Q.value,C="pi√®ce(s)";try{const P=await Ie(H(f,"ingredients"),{name:w,unit:C,category:"Inconnue"});await R(),Q.value=w,V.value=C,J.classList.add("hidden"),X[q].name=w,X[q].unit=C,X[q].id=P.id}catch(P){console.error("Erreur d'ajout d'ingr√©dient",P),alert("L'ingr√©dient n'a pas pu √™tre cr√©√©.")}}),J.appendChild(B),J.classList.remove("hidden")});const se=document.createElement("button");se.type="button",se.className="btn btn-ghost text-red-500 hover:bg-red-50 btn-sm mt-1",se.innerHTML='<i class="fas fa-trash"></i>',se.addEventListener("click",()=>{E.remove(),X[q]=null}),E.appendChild(ie),E.appendChild(K),E.appendChild(V),E.appendChild(se),M.appendChild(E)}function ce(){t.innerHTML="";let k=v;if(U){const E=U.toLowerCase();k=v.filter($=>$.name.toLowerCase().includes(E))}if(k.length===0){t.innerHTML='<p class="text-center text-gray-500 p-10 col-span-full">Aucune liste de courses trouv√©e.</p>';return}k.sort((E,$)=>E.name.localeCompare($.name)),k.forEach(E=>{const $=document.createElement("div");$.className="bg-white rounded-lg shadow-md p-4 flex flex-col";const q=document.createElement("div");q.className="flex justify-between items-start border-b pb-2 mb-2";const K=document.createElement("h4");K.className="text-lg font-bold text-gray-800",K.textContent=E.name,q.appendChild(K);const V=document.createElement("div");V.className="flex space-x-2";const ie=document.createElement("button");ie.className="btn btn-ghost btn-sm text-blue-500",ie.innerHTML='<i class="fas fa-edit"></i>',ie.addEventListener("click",()=>A(E)),V.appendChild(ie);const Q=document.createElement("button");Q.className="btn btn-ghost btn-sm text-green-500",Q.innerHTML='<i class="fas fa-share-alt"></i>',Q.addEventListener("click",()=>It({})),V.appendChild(Q);const J=document.createElement("button");J.className="btn btn-ghost btn-sm text-red-500",J.innerHTML='<i class="fas fa-trash"></i>',J.addEventListener("click",()=>ae(E.id,E.name)),V.appendChild(J),q.appendChild(V);const se=document.createElement("ul");se.className="space-y-1 text-sm text-gray-600 flex-grow",E.ingredients&&E.ingredients.length>0?E.ingredients.forEach(he=>{const T=document.createElement("li");T.textContent=`${he.quantity} ${he.unit||""} - ${he.name}`.trim(),se.appendChild(T)}):se.innerHTML='<li class="italic text-gray-400">Cette liste est vide.</li>',$.appendChild(q),$.appendChild(se),t.appendChild($)})}function be(k){if(r.innerHTML="",k.length===0){r.innerHTML='<p class="text-center text-gray-500 p-10 col-span-full">Aucune liste de courses partag√©e trouv√©e.</p>';return}k.sort((E,$)=>E.name.localeCompare($.name)),k.forEach(E=>{const $=document.createElement("div");$.className="bg-white rounded-lg shadow-md p-4 flex flex-col";const q=document.createElement("div");q.className="flex justify-between items-start border-b pb-2 mb-2";const K=document.createElement("h4");K.className="text-lg font-bold text-gray-800",K.textContent=E.name,q.appendChild(K);const V=document.createElement("div");V.className="flex space-x-2";const ie=document.createElement("button");ie.className="btn btn-secondary btn-sm",ie.innerHTML='<i class="fas fa-copy mr-2"></i> Copier dans mes listes',ie.title="Copier cette liste dans vos listes personnelles",ie.addEventListener("click",()=>Re(E.id)),V.appendChild(ie);const Q=document.createElement("button");Q.className="btn btn-ghost btn-sm text-red-500",Q.innerHTML='<i class="fas fa-trash"></i>',Q.title="Supprimer cette liste partag√©e",Q.addEventListener("click",()=>je(E.id,E.name)),V.appendChild(Q),q.appendChild(V);const J=document.createElement("ul");J.className="space-y-1 text-sm text-gray-600 flex-grow",E.ingredients&&E.ingredients.length>0?E.ingredients.forEach(se=>{const he=document.createElement("li");he.textContent=`${se.quantity} ${se.unit||""} - ${se.name}`.trim(),J.appendChild(he)}):J.innerHTML='<li class="italic text-gray-400">Cette liste est vide.</li>',$.appendChild(q),$.appendChild(J),r.appendChild($)})}async function ae(k,E){if(confirm(`√ätes-vous s√ªr de vouloir supprimer la liste "${E}" ?`))try{await $e(j(f,"shopping_lists",k)),await F()}catch($){console.error("Erreur de suppression de la liste: ",$)}}async function je(k,E){if(confirm(`√ätes-vous s√ªr de vouloir supprimer la liste partag√©e "${E}" ?`))try{await $e(j(f,"shopping_lists",k)),await D()}catch($){console.error("Erreur de suppression de la liste partag√©e: ",$),alert("Une erreur est survenue.")}}async function Re(k){if(confirm("Voulez-vous vraiment copier cette liste dans vos listes personnelles ? Elle ne sera plus consid√©r√©e comme une liste partag√©e."))try{const E=j(f,"shopping_lists",k);await Ee(E,{isShared:!1}),await Me()}catch(E){console.error("Erreur lors de la copie de la liste: ",E),alert("Une erreur est survenue.")}}e.addEventListener("input",k=>{U=k.target.value,ce()}),n.addEventListener("click",()=>A()),p.addEventListener("click",G),m.addEventListener("click",G),g.addEventListener("submit",pe),L.addEventListener("click",()=>ne()),f&&Me()}const xn=Object.freeze(Object.defineProperty({__proto__:null,default:vn},Symbol.toStringTag,{value:"Module"}));let Ht=[],Ft=[],Ut=()=>{},Ot=()=>{};const le={btn:null,badge:null,dropdown:null,list:null};async function En(e,t,n){const r=Ce();if(r)try{const l=j(f,"shares",e);if(await Ee(l,{status:"accepted"}),t.plan){const c=n.displayName||"Inconnu",p=`Copie de "${t.plan.name}" (de ${c})`,m={...t.plan,userId:r,name:p,isShared:!0,originalOwnerId:t.senderId,sharedAt:new Date,collaborators:[]};delete m.id,await Ie(H(f,"plans"),m)}t.shoppingList&&await Ie(H(f,"shopping_lists"),{name:`${t.shoppingList.name} (de ${n.displayName})`,ingredients:t.shoppingList.ingredients,userId:r,isShared:!0,originalOwner:n.uid,sharedAt:new Date})}catch(l){console.error("Erreur lors de l'acceptation du partage : ",l),alert("Une erreur est survenue.")}}async function wn(e){try{const t=j(f,"shares",e);await Ee(t,{status:"accepted"})}catch(t){console.error("Erreur lors de l'acceptation de l'invitation : ",t),alert("Une erreur est survenue.")}}async function Tt(e){try{const t=j(f,"shares",e);await Ee(t,{status:"declined"})}catch(t){console.error("Erreur lors du refus du partage : ",t),alert("Une erreur est survenue.")}}async function Cn(e){try{await At(e)}catch{alert("Erreur lors de l'acceptation.")}}async function Ln(e){try{await qt(e)}catch{alert("Erreur lors du refus.")}}function zt(){if(!le.list)return;const e=[...Ht,...Ft];e.sort((t,n)=>n.createdAt.toMillis()-t.createdAt.toMillis()),e.length>0?(le.badge.textContent=e.length,le.badge.classList.remove("hidden")):le.badge.classList.add("hidden"),le.list.innerHTML="",e.length===0?le.list.innerHTML='<p class="text-gray-500 text-center p-4">Aucune nouvelle notification.</p>':e.forEach(t=>{const n=In(t);le.list.appendChild(n)})}function In(e){const t=document.createElement("div");t.className="p-3 border-b border-gray-100 hover:bg-gray-50";const n=document.createElement("p");n.className="text-sm font-medium text-gray-800";const r=document.createElement("p");r.className="text-xs text-gray-500 mb-3";const l=document.createElement("div");l.className="flex space-x-2 justify-end";const c=e.data.type||e.type;if(c==="collaborative_plan_invite"){n.textContent="Invitation √† collaborer",r.textContent=`${e.sender.displayName} vous invite √† modifier son plan "${e.data.planName}".`;const p=We("Accepter","btn-secondary",g=>{g.target.textContent="...",g.target.disabled=!0,wn(e.id)}),m=We("Refuser","btn-ghost text-red-500",g=>{g.target.disabled=!0,Tt(e.id)});l.append(p,m)}else if(c==="share"){n.textContent=`Partage de ${e.sender.displayName||e.sender.email}`;let p=[];e.data.plan&&p.push("planification"),e.data.shoppingList&&p.push("liste de courses"),r.textContent=`Contenu : ${p.join(" et ")}`;const m=We("Accepter","btn-secondary",b=>{b.target.textContent="...",b.target.disabled=!0,En(e.id,e.data,e.sender)}),g=We("Refuser","btn-ghost text-red-500",b=>{b.target.disabled=!0,Tt(e.id)});l.append(m,g)}else if(c==="friend_request"){n.textContent="Invitation d'ami",r.textContent=`${e.sender.displayName||e.sender.email} vous a envoy√© une invitation.`;const p=We("Accepter","btn-secondary",g=>{g.target.textContent="...",g.target.disabled=!0,Cn(e.id)}),m=We("Refuser","btn-ghost text-red-500",g=>{g.target.disabled=!0,Ln(e.id)});l.append(p,m)}return t.append(n,r,l),t}function We(e,t,n){const r=document.createElement("button");return r.className=`btn btn-xs ${t}`,r.textContent=e,r.addEventListener("click",l=>{l.stopPropagation(),n(l)}),r}function Sn(e){const t=H(f,"shares"),n=me(t,Z("receiverId","==",e),Z("status","==","pending"));Ut=Xe(n,async r=>{const l=[];for(const c of r.docs){const p=c.data(),m=await Se(j(f,"users",p.senderId));m.exists()&&l.push({type:p.type||"share",id:c.id,data:p,sender:m.data(),createdAt:p.createdAt})}Ht=l,zt()},r=>{console.error("Erreur d'√©coute des partages:",r)})}function Bn(e){const t=H(f,"friend_requests"),n=me(t,Z("receiverId","==",e),Z("status","==","pending"));Ot=Xe(n,async r=>{const l=[];for(const c of r.docs){const p=c.data(),m=await Se(j(f,"users",p.senderId));m.exists()&&l.push({type:"friend_request",id:c.id,data:p,sender:m.data(),createdAt:p.createdAt})}Ft=l,zt()},r=>{console.error("Erreur d'√©coute des invitations d'amis:",r)})}function Vt(){if(le.btn=document.getElementById("notifications-btn"),le.badge=document.getElementById("notifications-badge"),le.dropdown=document.getElementById("notifications-dropdown"),le.list=document.getElementById("notifications-list"),!le.btn)return;const e=Ce();e&&(Ut(),Ot(),Sn(e),Bn(e),le.btn.addEventListener("click",t=>{t.stopPropagation(),le.dropdown.classList.toggle("hidden")}),document.addEventListener("click",t=>{le.dropdown&&!le.dropdown.classList.contains("hidden")&&!le.btn.contains(t.target)&&!le.dropdown.contains(t.target)&&le.dropdown.classList.add("hidden")}))}const Mn=Object.freeze(Object.defineProperty({__proto__:null,initNotifications:Vt},Symbol.toStringTag,{value:"Module"})),Oe=nn();let at,ut,mt,tt,ee,st,pt,ft,nt,Ue,rt,gt,ht,yt,vt,dt=null,ct=null;function Nn(){at&&at.classList.remove("hidden")}function xt(){at&&at.classList.add("hidden"),tt&&tt.reset()}function kn(e,t){ct=e,Ue&&(Ue.value=t),st&&st.classList.remove("hidden"),Ue&&Ue.focus()}function Et(){ct=null,st&&st.classList.add("hidden"),nt&&nt.reset()}function Tn(e,t){dt=e,yt&&(yt.textContent="Confirmer la suppression"),vt&&(vt.textContent=`√ätes-vous s√ªr de vouloir supprimer le plan "${t}" ? Cette action est irr√©versible.`),rt&&rt.classList.remove("hidden")}function Dt(){dt=null,rt&&rt.classList.add("hidden")}async function Dn(e){const t=Te();if(t)try{await Ie(H(Oe,"plans"),{userId:t.uid,name:e,type:"personal",weeks:{},manualItems:[],defaultNumPeople:1,startDay:"Lundi",lastUpdated:new Date}),xt()}catch(n){console.error("Error creating plan: ",n),alert("Erreur lors de la cr√©ation du plan.")}}async function Pn(e,t){if(!(!e||!t))try{const n=j(Oe,"plans",e);await Ee(n,{name:t}),Et()}catch(n){console.error("Error renaming plan: ",n),alert("Erreur lors du renommage du plan.")}}async function _n(e){const t=Te()?.uid;if(!(!e||!t)&&confirm("Voulez-vous vraiment quitter ce plan partag√© ? Il n'appara√Ætra plus dans votre liste."))try{const n=j(Oe,"plans",e);await Ee(n,{collaborators:$t(t)})}catch(n){console.error("Erreur pour quitter le plan: ",n),alert("Une erreur est survenue.")}}async function $n(e){if(e)try{await $e(j(Oe,"plans",e))}catch(t){console.error("Error deleting plan: ",t),alert("Erreur lors de la suppression du plan.")}}function Qt(e){const t=Te();if(!t)return()=>{};let n=new Map;const r=()=>{e(Array.from(n.values()).sort((b,S)=>b.name.localeCompare(S.name)))},l=async b=>{const M=[b.userId,...b.collaborators||[]].map(O=>Se(j(Oe,"users",O)));return(await Promise.all(M)).map(O=>O.exists()?O.data():{uid:O.id,displayName:"Inconnu"})},c=me(H(Oe,"plans"),Z("userId","==",t.uid)),p=Xe(c,async b=>{const M=b.docChanges().map(async L=>{if(L.type==="removed")n.delete(L.doc.id);else{const O=L.doc.data(),v=await l(O);n.set(L.doc.id,{id:L.doc.id,...O,isOwner:!0,participants:v})}});await Promise.all(M),r()}),m=me(H(Oe,"plans"),Z("collaborators","array-contains",t.uid)),g=Xe(m,async b=>{const M=b.docChanges().map(async L=>{if(L.type==="removed")n.delete(L.doc.id);else{const O=L.doc.data(),v=await l(O),U=v.find(Y=>Y.uid===O.userId);n.set(L.doc.id,{id:L.doc.id,...O,isOwner:!1,ownerName:U?.displayName||"Inconnu",participants:v})}});await Promise.all(M),r()});return()=>{p(),g()}}function Jt(e){if(!ee)return;const t=ee.value;if(ee.innerHTML="",e.length===0){const n=document.createElement("option");n.value="",n.textContent="Aucun plan personnel",n.disabled=!0,ee.appendChild(n);return}e.forEach(n=>{const r=document.createElement("option");r.value=n.id;let l=n.name;n.collaborators&&n.collaborators.length>0&&(n.isOwner?l=`üëë ${n.name} [Collab]`:l=`üë• ${n.name} [Collab] (de ${n.ownerName})`),r.textContent=l,ee.appendChild(r)}),t&&ee.querySelector(`option[value="${t}"]`)?ee.value=t:ee.selectedIndex=0}function Wt(){at=document.getElementById("create-plan-modal"),ut=document.getElementById("close-create-plan-modal"),mt=document.getElementById("cancel-create-plan-btn"),tt=document.getElementById("create-plan-form"),ee=document.getElementById("plan-select"),st=document.getElementById("rename-plan-modal"),pt=document.getElementById("close-rename-plan-modal"),ft=document.getElementById("cancel-rename-plan-btn"),nt=document.getElementById("rename-plan-form"),Ue=document.getElementById("new-plan-name"),rt=document.getElementById("delete-confirm-modal"),gt=document.getElementById("cancel-delete-btn"),ht=document.getElementById("confirm-delete-btn"),yt=document.getElementById("delete-confirm-title"),vt=document.getElementById("delete-confirm-message");const e=document.getElementById("create-plan-btn"),t=document.getElementById("rename-plan-btn"),n=document.getElementById("leave-plan-btn"),r=document.getElementById("delete-plan-btn");e&&e.addEventListener("click",Nn),t&&t.addEventListener("click",()=>{if(ee&&ee.value){const l=ee.options[ee.selectedIndex];kn(ee.value,l.text)}else alert("Veuillez s√©lectionner un plan √† renommer.")}),n&&n.addEventListener("click",()=>{ee&&ee.value?_n(ee.value):alert("Veuillez s√©lectionner un plan.")}),r&&r.addEventListener("click",()=>{if(ee&&ee.value){const l=ee.options[ee.selectedIndex].text;Tn(ee.value,l)}else alert("Veuillez s√©lectionner un plan √† supprimer.")}),ut&&ut.addEventListener("click",xt),mt&&mt.addEventListener("click",xt),tt&&tt.addEventListener("submit",l=>{l.preventDefault();const c=document.getElementById("plan-name");c&&c.value&&Dn(c.value)}),pt&&pt.addEventListener("click",Et),ft&&ft.addEventListener("click",Et),nt&&nt.addEventListener("submit",l=>{l.preventDefault(),ct&&Ue.value&&Pn(ct,Ue.value)}),gt&&gt.addEventListener("click",Dt),ht&&ht.addEventListener("click",()=>{dt&&$n(dt).then(()=>{Dt()})})}const jn=Object.freeze(Object.defineProperty({__proto__:null,getUserPlans:Qt,initPlanManagement:Wt,populatePlanSelector:Jt},Symbol.toStringTag,{value:"Module"}));let Ge=null;function Rn(){const e=document.getElementById("search-bar"),t=document.getElementById("category-tabs"),n=document.getElementById("recipe-list-container"),r=document.getElementById("add-recipe-btn");Ge&&Ge.destroy(),Ge=new Ct(f,"recipe-form-modal","recipe-form","recipe-modal-title","recipe-id","recipe-name","recipe-category","recipe-servings","recipe-prep-time","recipe-difficulty","recipe-steps","ingredients-list","add-ingredient-btn","save-recipe-btn","close-recipe-modal","cancel-recipe-btn"),Ge.setOnSaveCallback(O);let l=[],c="",p="",m=null;const g=["Entr√©e","Plat","Accompagnement","Dessert"],b={PLAT:"bg-orange-100",DESSERT:"bg-amber-100",ENTREE:"bg-lime-100",ACCOMPAGNEMENT:"bg-stone-200","PETIT-DEJEUNER":"bg-orange-100",BOISSON:"bg-cyan-100",SAUCE:"bg-red-100"},S={PLAT:"text-orange-800",DESSERT:"text-amber-800",ENTREE:"text-lime-800",ACCOMPAGNEMENT:"text-stone-800","PETIT-DEJEUNER":"text-orange-800",BOISSON:"text-cyan-800",SAUCE:"text-red-800"},M="bg-gray-100",L="text-gray-800";async function O(){if(console.log("fetchAllRecipes called."),!!f)try{l=(await de(H(f,"recipes"))).docs.map(F=>({id:F.id,...F.data()})),console.log("Fetched recipes:",l),U(),Y()}catch(R){console.error("Erreur lors de la r√©cup√©ration des recettes: ",R)}}function v(R){c=R,U(),Y()}function U(){if(!t)return;t.innerHTML="";const F=[...new Set(l.map(D=>D.category||"Non class√©"))].sort((D,A)=>{const G=ce=>{const be=ce.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase();for(let ae=0;ae<g.length;ae++)if(g[ae].normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()===be)return ae;return-1},pe=G(D),ne=G(A);return pe>-1&&ne>-1?pe-ne:pe>-1?-1:ne>-1?1:D.localeCompare(A)});!c&&F.length>0&&(c=F[0]),F.forEach(D=>{const A=document.createElement("button"),G=D.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toUpperCase();if(D===c){const ne=b[G]||M,ce=S[G]||L;A.className=`px-4 py-2 text-sm font-bold rounded-t-lg ${ne} ${ce}`}else A.className="px-4 py-2 text-sm font-medium text-gray-500 hover:text-tomato";A.textContent=D,A.addEventListener("click",()=>v(D)),t.appendChild(A)})}function Y(){if(!n)return;n.innerHTML="";let R=l.filter(D=>(D.category||"Non class√©")===c);if(p){const D=p.toLowerCase();R=R.filter(A=>A.name.toLowerCase().includes(D))}if(R.sort((D,A)=>D.name.localeCompare(A.name)),R.length===0){n.innerHTML='<p class="text-gray-500 text-center p-10">Aucune recette trouv√©e.</p>';return}const F=document.createElement("div");F.className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",R.forEach(D=>{F.appendChild(X(D))}),n.appendChild(F)}function X(R){let F=M;if(R.category){const ae=R.category.normalize("NFD").replace(/[ÃÄ-ÕØ]/g,"").toUpperCase();F=b[ae]||M}const D=document.createElement("div");D.className=`rounded-lg shadow-sm flex flex-col p-2 ${F}`;const A=document.createElement("h4");A.className="text-sm font-bold text-gray-800 truncate",A.textContent=R.name,A.title=R.name,D.appendChild(A);const G=document.createElement("p");G.className="text-xs text-gray-600 mt-1",G.textContent=`${R.difficulty||""} - Pour ${R.servings||"?"} pers.`,D.appendChild(G);const pe=document.createElement("div");pe.className="flex-grow",D.appendChild(pe);const ne=document.createElement("div");ne.className="flex justify-end space-x-2 mt-2";const ce=document.createElement("button");ce.className="btn btn-outline btn-xs border-gray-400 hover:bg-gray-200",ce.innerHTML='<i class="fas fa-edit"></i>',ce.title="Modifier",ce.addEventListener("click",()=>Ge.openForm(R,"Modifier la recette")),ne.appendChild(ce);const be=document.createElement("button");return be.className="btn btn-ghost text-red-700 hover:bg-red-100 btn-xs",be.innerHTML='<i class="fas fa-trash-alt"></i>',be.title="Supprimer",be.addEventListener("click",()=>Me(R.id,R.name)),ne.appendChild(be),D.appendChild(ne),D}async function Me(R,F){if(confirm(`√ätes-vous s√ªr de vouloir supprimer la recette "${F}" ?`))try{await $e(j(f,"recipes",R)),O()}catch(D){console.error("Erreur lors de la suppression: ",D)}}r.addEventListener("click",()=>Ge.openForm(null,"Ajouter une recette")),e.addEventListener("input",R=>{const F=R.target.value;if(!p&&F&&(m=c),p=F,p){const D=p.toLowerCase(),A=l.find(G=>G.name.toLowerCase().includes(D));A&&(c=A.category||"Non class√©")}else m&&(c=m,m=null);U(),Y()}),f&&O()}const An=Object.freeze(Object.defineProperty({__proto__:null,default:Rn},Symbol.toStringTag,{value:"Module"}));let Fe=null;function qn(){const e={mealPlanGrid:document.getElementById("meal-plan-grid"),currentWeekDisplay:document.getElementById("current-week-display"),prevWeekBtn:document.getElementById("prev-week-btn"),nextWeekBtn:document.getElementById("next-week-btn"),clearMenuBtn:document.getElementById("clear-menu-btn"),shoppingListContainer:document.getElementById("shopping-list"),startDaySelect:document.getElementById("start-day-select"),defaultServingsControl:document.getElementById("default-servings-control"),mealSelectModal:document.getElementById("meal-select-modal"),closeMealSelectModalBtn:document.getElementById("close-meal-select-modal"),mealSelectModalTitle:document.getElementById("meal-select-modal-title"),mealSelectList:document.getElementById("meal-select-list"),recipeFormModal:document.getElementById("edit-recipe-form-modal"),closeRecipeModalBtn:document.getElementById("close-edit-recipe-modal"),cancelRecipeBtn:document.getElementById("edit-cancel-recipe-btn"),recipeForm:document.getElementById("edit-recipe-form"),addItemInput:document.getElementById("add-item-input"),addItemBtn:document.getElementById("add-item-btn"),addItemResults:document.getElementById("add-item-results"),importListBtn:document.getElementById("import-list-btn"),importListModal:document.getElementById("import-list-modal"),closeImportListModalBtn:document.getElementById("close-import-list-modal"),importListContainer:document.getElementById("import-list-container"),exportTxtBtn:document.getElementById("export-txt-btn"),exportPdfBtn:document.getElementById("export-pdf-btn"),exportPlanPdfBtn:document.getElementById("export-plan-pdf-btn"),sharePlanBtn:document.getElementById("share-plan-btn"),planSelect:document.getElementById("plan-select")};function t(s,a){const d=document.createElement("div");d.className="flex items-center space-x-2";const o=document.createElement("button");o.className="btn btn-outline btn-xs",o.textContent="-";const i=document.createElement("span");i.className="font-medium text-center w-6",i.textContent=s;const u=document.createElement("button");return u.className="btn btn-outline btn-xs",u.textContent="+",o.addEventListener("click",()=>{let y=parseInt(i.textContent,10);y>1&&(y--,i.textContent=y,a(y))}),u.addEventListener("click",()=>{let y=parseInt(i.textContent,10);y++,i.textContent=y,a(y)}),d.appendChild(o),d.appendChild(i),d.appendChild(u),d}function n(s,a,d,o=!1){const i=document.createElement("div");i.className="flex flex-col items-center justify-center h-full";const u=document.createElement("button");u.className="btn btn-ghost btn-xs p-0 h-4 flex items-center justify-center w-full",u.innerHTML='<i class="fas fa-plus"></i>',u.disabled=o;const y=document.createElement("span");y.className="font-medium text-center text-sm my-1",y.textContent=s;const h=document.createElement("button");return h.className="btn btn-ghost btn-xs p-0 h-4 flex items-center justify-center w-full",h.innerHTML='<i class="fas fa-minus"></i>',h.disabled=o,a&&(u.classList.add("text-white"),y.classList.add("text-white"),h.classList.add("text-white")),o||(u.addEventListener("click",()=>{let I=parseInt(y.textContent,10);I++,y.textContent=I,d(I)}),h.addEventListener("click",()=>{let I=parseInt(y.textContent,10);I>1&&(I--,y.textContent=I,d(I))})),i.appendChild(u),i.appendChild(y),i.appendChild(h),i}Fe&&Fe.destroy(),Fe=new Ct(f,"edit-recipe-form-modal","edit-recipe-form","edit-recipe-modal-title","edit-recipe-id","edit-recipe-name","edit-recipe-category","edit-recipe-servings","edit-recipe-prep-time","edit-recipe-difficulty","edit-recipe-steps","edit-ingredients-list","edit-add-ingredient-btn","edit-save-recipe-btn","close-edit-recipe-modal","edit-cancel-recipe-btn"),Fe.setOnSaveCallback(async()=>{await Me();for(const s in c){const a=c[s];if(Array.isArray(a)){const d=a.map(o=>{if(o&&o.id){const i=S.find(u=>u.id===o.id);return i?{...i}:o}return o});c[s]=d}}F(e.mealPlanGrid,{menuData:c,servingsData:p,remarksData:m,defaultNumPeople:L,startDay:l},!1),await k()});let r=1,l="Lundi",c={},p={},m={};const g=[];let b=null,S=[],M=[],L=1,O=[],v=null;function U(s){return s?s.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase():""}async function Y(s){const a=document.getElementById("unit-select-modal"),d=document.getElementById("unit-modal-title"),o=document.getElementById("unit-modal-list"),i=document.getElementById("unit-modal-cancel");return d.textContent=`Choisir une unit√© pour "${s}"`,o.innerHTML="",new Promise((u,y)=>{const h=["g","kg","ml","l","pi√®ce(s)","c.√†.s.","c.√†.c.","pinc√©e(s)"],I=x=>{a.classList.add("hidden"),u(x)};h.forEach(x=>{const N=document.createElement("button");N.className="btn btn-outline",N.textContent=x,N.addEventListener("click",()=>I(x)),o.appendChild(N)});const _=()=>{a.classList.add("hidden"),y()};i.addEventListener("click",_,{once:!0}),a.addEventListener("click",x=>{x.target===a&&_()},{once:!0}),a.classList.remove("hidden")})}async function X(){if(f)try{M=(await de(H(f,"ingredients"))).docs.map(a=>({id:a.id,...a.data()})),M.sort((a,d)=>a.name.localeCompare(d.name))}catch(s){console.error("Erreur lors de la r√©cup√©ration des ingr√©dients: ",s)}}async function Me(){if(!f)return;const s=H(f,"recipes");try{S=(await de(s)).docs.map(d=>({id:d.id,...d.data()}))}catch(a){console.error("Error loading available meals from Firebase:",a)}}function R(){if(!v)c={},p={},m={},L=1,l="Lundi";else{const s=v.weeks?v.weeks[r]||{}:{};c=s.menuData||{},p=s.servingsData||{},m=s.remarksData||{},L=v.defaultNumPeople||1,l=v.startDay||"Lundi"}if(e.startDaySelect&&(e.startDaySelect.value=l),e.defaultServingsControl){e.defaultServingsControl.innerHTML="";const s=t(L,async a=>{if(L=a,v){const d=j(f,"plans",v.id);await Ee(d,{defaultNumPeople:a,lastUpdated:new Date})}});e.defaultServingsControl.appendChild(s)}Ye(),F(e.mealPlanGrid,{menuData:c,servingsData:p,remarksData:m,defaultNumPeople:L,startDay:l},!1),k()}function F(s,a,d=!1){if(!s)return;const o=a.menuData||{},i=a.servingsData||{},u=a.remarksData||{},y=a.defaultNumPeople||1,h=a.startDay||"Lundi",I=document.createDocumentFragment(),_=["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"],x=["lunch","dinner"],N=5,z=_.indexOf(h);[..._.slice(z),..._.slice(0,z)].forEach(ye=>{const fe=_.indexOf(ye),ve=document.createElement("div");ve.className="grid grid-cols-[100px_35px_repeat(5,_minmax(0,_1fr))_35px_repeat(5,_minmax(0,_1fr))] items-stretch border-b border-gray-300";const xe=document.createElement("div");xe.className="font-bold p-2 flex items-center justify-center bg-gray-100 text-sm border-r border-gray-300",xe.textContent=ye.toUpperCase(),ve.appendChild(xe),x.forEach(we=>{const oe=`${fe}-${we}`,De=i[oe]||y,ge=i.hasOwnProperty(oe),re=document.createElement("div"),Be=n(De,ge,Ne=>{Xt(oe,Ne)},d);let Pe="border-r border-gray-300 flex items-center justify-center transition-colors duration-300";ge?Pe+=" bg-tomato":Pe+=we==="lunch"?" bg-amber-50":" bg-stone-100",re.className=Pe,re.appendChild(Be),ve.appendChild(re);for(let Ne=0;Ne<N;Ne++){const Le=`${fe}-${we}-${Ne}`,Je=o[Le],qe=document.createElement("div"),Ke=J(Le);let Ze="meal-slot p-1 min-h-[70px] flex flex-col justify-start border-r border-gray-300";if(Ze+=we==="lunch"?" bg-amber-50":" bg-stone-100",qe.className=Ze,qe.dataset.slotId=Le,Ke==="Remarque")qe.appendChild(B(Le,u,d));else if(Array.isArray(Je)&&Je.length>0){const He=document.createElement("div");He.className="w-full",Je.forEach((et,ke)=>{He.appendChild(se(et,Le,ke,d))}),qe.appendChild(He),d||qe.appendChild(T(Le,!0))}else d||qe.appendChild(T(Le,!1));ve.appendChild(qe)}}),I.appendChild(ve)}),s.innerHTML="",s.appendChild(I),d||w()}async function D(){const s=Ce();if(!f||!s)return[];try{const a=me(H(f,"shopping_lists"),Z("userId","==",s));return(await de(a)).docs.map(u=>({id:u.id,...u.data()})).filter(u=>u.isShared!==!0)}catch(a){return console.error("Erreur de chargement des listes de courses sauvegard√©es: ",a),[]}}async function A(){const s=await D();if(e.importListContainer.innerHTML="",s.length===0){e.importListContainer.innerHTML='<p class="text-center text-gray-500">Aucune liste sauvegard√©e.</p>';return}s.forEach(a=>{const d=document.createElement("button");d.className="w-full text-left p-2 hover:bg-gray-100 rounded-lg transition-colors duration-150",d.textContent=a.name,d.addEventListener("click",()=>{confirm(`Voulez-vous vraiment importer les ingr√©dients de la liste "${a.name}" ?`)&&(a.ingredients.forEach(o=>{const i=parseFloat(String(o.quantity).replace(",","."))||0;ae(o.name,i,o.unit)}),G())}),e.importListContainer.appendChild(d)}),e.importListModal.classList.remove("hidden")}function G(){e.importListModal.classList.add("hidden")}function pe(){e.addItemInput?.addEventListener("input",()=>{const s=e.addItemInput.value.toLowerCase(),a=e.addItemResults;if(a.innerHTML="",!s){a.classList.add("hidden");return}M.filter(i=>i.name.toLowerCase().includes(s)).forEach(i=>{const u=document.createElement("div");u.className="p-2 hover:bg-gray-100 cursor-pointer",u.textContent=i.name,u.addEventListener("click",()=>{ae(i.name,1,i.unit),e.addItemInput.value="",a.classList.add("hidden")}),a.appendChild(u)});const o=document.createElement("div");o.className="p-2 bg-green-50 hover:bg-green-200 cursor-pointer font-bold text-green-700",o.textContent=`+ Cr√©er "${e.addItemInput.value}"`,o.addEventListener("click",async()=>{const i=e.addItemInput.value;try{const u=await Y(i);await Ie(H(f,"ingredients"),{name:i,unit:u}),await X(),ae(i,1,u),e.addItemInput.value="",a.classList.add("hidden")}catch{}}),a.appendChild(o),a.classList.remove("hidden")}),e.addItemBtn?.addEventListener("click",()=>{const s=e.addItemInput.value;s&&(ae(s,1,""),e.addItemInput.value="",e.addItemResults.classList.add("hidden"))}),document.addEventListener("click",s=>{e.addItemInput&&!e.addItemInput.contains(s.target)&&!e.addItemResults.contains(s.target)&&e.addItemResults.classList.add("hidden")})}function ne(){if(g.length===0){alert("La liste de courses est vide.");return}const s=g.reduce((i,u)=>{const y=u.category||"Inconnue";return i[y]||(i[y]=[]),i[y].push(u),i},{}),a=Object.keys(s).sort((i,u)=>i==="Inconnue"?1:u==="Inconnue"?-1:i.localeCompare(u));let d=`Liste de courses - GustoPlan

`;a.forEach(i=>{d+=`--- ${i.toUpperCase()} ---
`,s[i].sort((y,h)=>y.name.localeCompare(h.name)).forEach(y=>{let I=`${Number.isInteger(y.totalQuantity)?y.totalQuantity:parseFloat(y.totalQuantity.toFixed(2))} ${y.unit||""} ${y.name}`;if(y.sources&&y.sources.length>0){const _=y.sources.reduce((N,z)=>{const te=`${z.recipeName} (${z.day} ${z.time})`;return N[te]||(N[te]=0),N[te]+=z.quantity,N},{}),x=Object.keys(_).join(" / ");I+=` *** ${x} ***`}d+=I+`
`}),d+=`
`});const o=new Blob([d],{type:"text/plain;charset=utf-8"});saveAs(o,"liste-de-courses.txt")}function ce(){if(g.length===0){alert("La liste de courses est vide.");return}const{jsPDF:s}=window.jspdf,a=new s,d=g.reduce((I,_)=>{const x=_.category||"Inconnue";return I[x]||(I[x]=[]),I[x].push(_),I},{}),o=Object.keys(d).sort((I,_)=>I==="Inconnue"?1:_==="Inconnue"?-1:I.localeCompare(_));a.setFontSize(18),a.text("Liste de courses - GustoPlan",14,22);let i=35;const u=a.internal.pageSize.height,y=20,h=()=>{i>u-y&&(a.addPage(),i=20)};o.forEach(I=>{h(),a.setFontSize(14),a.setFont(void 0,"bold"),a.text(`--- ${I.toUpperCase()} ---`,14,i),i+=8,a.setFont(void 0,"normal"),d[I].sort((x,N)=>x.name.localeCompare(N.name)).forEach(x=>{h(),a.setFontSize(12);const N=Number.isInteger(x.totalQuantity)?x.totalQuantity:parseFloat(x.totalQuantity.toFixed(2));if(a.text(`${N} ${x.unit||""} ${x.name}`,14,i),i+=6,x.sources&&x.sources.length>0){const z=x.sources.reduce((te,ye)=>{const fe=`${ye.recipeName} (${ye.day} ${ye.time})`;return te[fe]||(te[fe]=0),te[fe]+=ye.quantity,te},{});a.setFontSize(9),a.setTextColor(100);for(const te in z)h(),a.text(`  * ${te}`,18,i),i+=5;a.setTextColor(0)}i+=2}),i+=5}),a.save("liste-de-courses.pdf")}async function be(){if(!v){alert("Veuillez s√©lectionner un plan √† exporter.");return}const s=document.getElementById("loading-overlay");s&&s.classList.remove("hidden");try{const{jsPDF:a}=window.jspdf,d=new a,o=j(f,"plans",v.id),i=await Se(o),u=i.exists()?i.data():null;if(!u||!u.weeks){alert("Ce plan est vide et ne peut pas √™tre export√©.");return}d.setFontSize(18),d.text(`Plan de Repas: ${u.name}`,14,20);const y=["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"],h={0:"E",1:"P",2:"A",3:"D"},I=Object.keys(u.weeks).sort((x,N)=>parseInt(x)-parseInt(N));let _=!0;for(const x of I){const z=u.weeks[x].menuData||{};if(Object.keys(z).length===0)continue;const te=[["Jour","Midi","Soir"]],ye=[],fe=y.indexOf(u.startDay||"Lundi"),ve=[...y.slice(fe),...y.slice(0,fe)];for(const we of ve){const oe=y.indexOf(we);let De=[],ge=[];for(const re of["lunch","dinner"])for(const Be in h){const Pe=`${oe}-${re}-${Be}`;z[Pe]&&Array.isArray(z[Pe])&&z[Pe].forEach(Ne=>{const Le=`[${h[Be]}] ${Ne.name}`;re==="lunch"?De.push(Le):ge.push(Le)})}ye.push([we,De.join(`
`)||"-",ge.join(`
`)||"-"])}d.setFontSize(14);const xe=_?30:d.autoTable.previous.finalY+20;d.text(`Semaine ${x}`,14,xe-5),d.autoTable({startY:xe,head:te,body:ye,theme:"grid",styles:{cellPadding:2,fontSize:8,valign:"middle"},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[245,245,245]}}),_=!1}d.save(`plan_${u.name.replace(/ /g,"_")}.pdf`)}catch(a){console.error("Erreur lors de la g√©n√©ration du PDF du plan :",a),alert("Une erreur est survenue lors de la cr√©ation du PDF.")}finally{s&&s.classList.add("hidden")}}async function ae(s,a,d,o=!1){if(!v)return alert("Veuillez s√©lectionner un plan.");const i=j(f,"plans",v.id);try{await an(f,async u=>{const y=await u.get(i);if(!y.exists())throw"Le plan n'existe plus.";const h=y.data().manualItems||[],I=`${s.trim().toLowerCase()}_${d||""}`,_=h.findIndex(N=>`${N.name.trim().toLowerCase()}_${N.unit||""}`===I);if(_>-1)h[_].totalQuantity+=a;else{const N=M.find(z=>z.name.toLowerCase()===s.trim().toLowerCase());h.push({name:s.trim(),totalQuantity:a,unit:d,source:"manual",category:N?N.category:"Inconnue"})}const x=h.filter(N=>N.totalQuantity!==0);u.update(i,{manualItems:x,lastUpdated:new Date})})}catch(u){console.error("Erreur transactionnelle lors de l'ajustement de l'ingr√©dient: ",u),alert("Une erreur de synchronisation est survenue. Veuillez r√©essayer.")}}function je(s){const a=s?s.toLowerCase():"";return a.includes("g")||a.includes("ml")?10:1}function Re(){const s=e.shoppingListContainer;if(!s)return;if(s.innerHTML="",g.length===0){s.innerHTML='<p class="text-center text-gray-500 italic py-4">Votre liste de courses est vide.</p>';return}const a=g.reduce((o,i)=>{const u=i.category||"Inconnue";return o[u]||(o[u]=[]),o[u].push(i),o},{});Object.keys(a).sort((o,i)=>o==="Inconnue"?1:i==="Inconnue"?-1:o.localeCompare(i)).forEach(o=>{const i=document.createElement("h4");i.className="text-sm font-bold text-stone-800 bg-stone-200 mt-4 mb-2 px-3 py-1 rounded-md",i.textContent=o,s.appendChild(i);const u=document.createElement("ul");u.className="space-y-2",a[o].sort((h,I)=>h.name.localeCompare(I.name)).forEach(h=>{const I=document.createElement("li");let _="p-2 rounded";I.className=_+(h.source==="manual"?" bg-lemon":" bg-gray-50");const x=document.createElement("div");x.className="flex justify-between items-center";const N=document.createElement("span");N.className="flex-grow text-sm font-medium",N.textContent=h.name,x.appendChild(N);const z=document.createElement("div");z.className="flex items-center space-x-2 mx-2";const te=document.createElement("span");te.className="font-medium w-20 text-center text-sm";const ye=Number.isInteger(h.totalQuantity)?h.totalQuantity:parseFloat(h.totalQuantity.toFixed(2));te.textContent=`${ye} ${h.unit||""}`.trim();const fe=document.createElement("div");fe.className="flex flex-col";const ve=document.createElement("button");ve.className="btn btn-outline btn-xs rounded-b-none",ve.textContent="+",ve.addEventListener("click",async()=>{const oe=je(h.unit);await ae(h.name,oe,h.unit)});const xe=document.createElement("button");xe.className="btn btn-outline btn-xs rounded-t-none -mt-px",xe.textContent="-",xe.addEventListener("click",async()=>{const oe=je(h.unit);await ae(h.name,-oe,h.unit)}),fe.appendChild(ve),fe.appendChild(xe),z.appendChild(te),z.appendChild(fe),x.appendChild(z);const we=document.createElement("button");if(we.className="delete-item-btn text-red-500 hover:text-red-700",we.innerHTML='<i class="fas fa-trash-alt"></i>',we.addEventListener("click",()=>{ae(h.name,-h.totalQuantity,h.unit,!0)}),x.appendChild(we),I.appendChild(x),h.sources&&h.sources.length>0){const oe=document.createElement("div");oe.className="p-2 mt-1 ml-4 rounded-md bg-stone-100";const De=h.sources.reduce((ge,re)=>{const Be=`${re.recipeName} (${re.day} ${re.time})`;return ge[Be]||(ge[Be]=0),ge[Be]+=re.quantity,ge},{});for(const ge in De){const re=document.createElement("span");re.className="block text-xs text-gray-500",re.textContent=`‚Ü≥ ${ge}`,oe.appendChild(re)}I.appendChild(oe)}u.appendChild(I)}),s.appendChild(u)})}async function k(){if(!v){g.length=0,Re();return}const s=v.manualItems?JSON.parse(JSON.stringify(v.manualItems)):[],a=new Map(s.map(i=>[`${i.name.trim().toLowerCase()}_${i.unit||""}`,i])),d=["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"];if(v.weeks)for(const i in v.weeks){const u=v.weeks[i],y=u.menuData||{},h=u.servingsData||{};for(const I in y){const _=y[I];if(!Array.isArray(_))continue;const[x,N]=I.split("-"),z=parseInt(x,10),te=d[z]||"Jour inconnu",ye=N==="lunch"?"midi":"soir",fe=`${z}-${N}`,ve=parseInt(h[fe]||v.defaultNumPeople,10);for(const xe of _){const oe=S.find(ge=>ge.id===xe.id)||xe;if(!oe||!Array.isArray(oe.ingredients))continue;const De=oe.servings||1;De<=0||oe.ingredients.forEach(ge=>{const{name:re,quantity:Be,unit:Pe}=ge;if(!re||!Be)return;const Ne=M.find(ke=>ke.name.toLowerCase()===re.trim().toLowerCase()),Le=Ne?Ne.category:"Inconnue",Je=parseFloat(String(Be).replace(",","."));if(isNaN(Je))return;const Ke=Je/De*ve,Ze=Pe||"",He=`${re.trim().toLowerCase()}_${Ze}`,et={recipeName:oe.name,day:`${te} (S${i})`,time:ye,quantity:Ke};if(a.has(He)){const ke=a.get(He);ke.totalQuantity+=Ke,ke.source==="manual"&&(ke.source="mixed"),Array.isArray(ke.sources)?ke.sources.push(et):ke.sources=[et]}else a.set(He,{name:re.trim(),totalQuantity:Ke,unit:Ze,source:"plan",category:Le,sources:[et]})})}}}const o=Array.from(a.values()).filter(i=>i.totalQuantity>0);g.length=0,g.push(...o.sort((i,u)=>i.name.localeCompare(u.name))),Re()}function E(s){const a=J(s);if(!a||!e.mealSelectModal)return;e.mealSelectModalTitle.textContent=`S√©lectionner : ${a}`,e.mealSelectList.innerHTML="";const d=document.createElement("input");d.type="text",d.placeholder="Rechercher dans la cat√©gorie...",d.className="w-full p-2 mb-4 border border-gray-300 rounded-lg",e.mealSelectList.appendChild(d);const o=U(a),i=S.filter(h=>U(h.category)===o).sort((h,I)=>h.name.localeCompare(I.name)),u=document.createElement("div");u.className="space-y-1 max-h-80 overflow-y-auto",e.mealSelectList.appendChild(u);function y(h=""){u.innerHTML="";const I=h.toLowerCase(),_=i.filter(x=>x.name.toLowerCase().includes(I));_.length===0?u.innerHTML='<p class="text-gray-500 p-4">Aucun plat ne correspond √† votre recherche.</p>':_.forEach(x=>{const N=document.createElement("button");N.className="w-full text-left p-2 hover:bg-gray-100 rounded-lg transition-colors duration-150";const z=document.createElement("p");z.className="font-medium text-gray-800 text-sm",z.textContent=x.name,N.appendChild(z),N.addEventListener("click",()=>{C(s,x),$()}),u.appendChild(N)})}d.addEventListener("input",h=>y(h.target.value)),y(),e.mealSelectModal.classList.remove("hidden"),d.focus()}function $(){e.mealSelectModal&&e.mealSelectModal.classList.add("hidden")}function q(s){b=s.target.closest(".meal-card");const a=b.closest(".meal-slot").dataset.slotId;s.dataTransfer.setData("text/plain",a),setTimeout(()=>{b&&(b.style.opacity="0.5")},0)}function K(){b&&(b.style.opacity="1",b=null)}function V(s){s.preventDefault();const a=s.target.closest(".meal-slot");a&&J(a.dataset.slotId)!=="Remarque"&&a.classList.add("bg-gray-200")}function ie(s){const a=s.target.closest(".meal-slot");a&&a.classList.remove("bg-gray-200")}async function Q(s){s.preventDefault();const a=s.dataTransfer.getData("text/plain"),d=s.target.closest(".meal-slot");if(d){d.classList.remove("bg-gray-200");const o=d.dataset.slotId,i=J(o);if(i==="Remarque")return;if(a&&o&&a!==o){const u=c[a],y=J(a);if(U(y)!==U(i)){alert(`Action impossible : un(e) "${y}" ne peut pas aller dans la cat√©gorie "${i}".`);return}const h=c[o];c[o]=u,h?c[a]=h:delete c[a],F(e.mealPlanGrid,{menuData:c,servingsData:p,remarksData:m,defaultNumPeople:L,startDay:l},!1),await saveCurrentPlan(),await k()}}}function J(s){switch(s.split("-")[2]){case"0":return"Entr√©e";case"1":return"Plat";case"2":return"Accompagnement";case"3":return"Dessert";case"4":return"Remarque";default:return""}}function se(s,a,d,o=!1){const i=document.createElement("div");i.className="meal-card p-1 flex flex-col items-center bg-white rounded shadow-sm text-center relative w-full mb-1",o||(i.classList.add("cursor-grab"),i.draggable=!0);const u=document.createElement("span");if(u.className="text-xs font-medium p-1 break-words w-full",u.textContent=s.name,i.appendChild(u),!o){const I=document.createElement("div");I.className="absolute top-0 left-0 flex";const _=document.createElement("button");_.className="edit-meal-btn text-gray-600 hover:text-gray-800 hidden px-1 py-0.5",_.innerHTML='<i class="fas fa-pencil-alt fa-xs"></i>',_.title="Modifier la recette",_.addEventListener("click",N=>{N.stopPropagation();const z=S.find(te=>te.id===s.id);Fe.openForm(z||s,"Modifier la recette")}),I.appendChild(_);const x=document.createElement("button");x.className="delete-meal-btn text-red-700 hover:text-red-900 hidden px-1 py-0.5",x.innerHTML='<i class="fas fa-times-circle fa-xs"></i>',x.title="Retirer du planning",x.addEventListener("click",N=>{N.stopPropagation(),P(a,d)}),I.appendChild(x),i.appendChild(I),i.addEventListener("mouseenter",()=>{_.classList.remove("hidden"),x.classList.remove("hidden")}),i.addEventListener("mouseleave",()=>{_.classList.add("hidden"),x.classList.add("hidden")})}const y=document.createElement("div");y.className="absolute bottom-1 right-1";const h=document.createElement("button");return h.className="info-meal-btn bg-gray-500 text-white hover:bg-gray-600 rounded w-3 h-3 flex items-center justify-center shadow-sm",h.innerHTML='<i class="fas fa-plus fa-xs"></i>',h.title="Plus d'infos",h.dataset.slotId=a,h.dataset.mealIndex=d,y.appendChild(h),i.appendChild(y),i}function he(s,a){const d=s.classList.contains("info-open");if(document.querySelectorAll(".planner-ingredient-tooltip").forEach(o=>o.remove()),document.querySelectorAll(".info-meal-btn").forEach(o=>{o.classList.remove("info-open"),o.innerHTML='<i class="fas fa-plus fa-xs"></i>'}),!d){s.innerHTML='<i class="fas fa-times fa-xs"></i>',s.classList.add("info-open");const o=document.createElement("div");if(o.className="planner-ingredient-tooltip z-50 w-64 p-3 bg-white border border-gray-200 rounded-lg shadow-lg text-left text-sm",a.ingredients&&a.ingredients.length>0){if(a.servings&&a.servings>0){const x=document.createElement("p");x.className="mb-2 text-sm text-gray-600 flex items-center",x.innerHTML=`<i class="fas fa-users mr-2"></i> Pour ${a.servings} ${a.servings>1?"personnes":"personne"}`,o.appendChild(x)}const I=document.createElement("h4");I.className="font-bold mb-2 text-gray-800",I.textContent="Ingr√©dients :",o.appendChild(I);const _=document.createElement("ul");_.className="space-y-1 text-gray-600",a.ingredients.forEach(x=>{const N=document.createElement("li");N.textContent=`‚Ä¢ ${x.quantity||""} ${x.unit||""} ${x.name}`.trim(),_.appendChild(N)}),o.appendChild(_)}else o.textContent="Aucun ingr√©dient sp√©cifi√© pour cette recette.";document.body.appendChild(o);const i=s.closest(".meal-card").getBoundingClientRect(),u=o.getBoundingClientRect();let y=i.right+10;y+u.width>window.innerWidth&&(y=i.left-u.width-10);let h=i.top;h+u.height>window.innerHeight&&(h=i.bottom-u.height),h<10&&(h=10),o.style.position="fixed",o.style.left=`${y}px`,o.style.top=`${h}px`}}function T(s,a=!1){const d=document.createElement("div"),o=document.createElement("button");return a?(d.className="w-full flex justify-center pt-1",o.className="add-more-meal-btn text-gray-400 hover:text-green-500 transition-colors duration-150",o.innerHTML='<i class="fas fa-plus-circle"></i>',o.title="Ajouter une autre recette"):(d.className="flex items-center justify-center h-full",o.className="add-meal-btn text-green-500 hover:text-green-700 transition-transform duration-150 hover:scale-125",o.innerHTML='<i class="fas fa-plus-circle text-lg"></i>'),o.addEventListener("click",()=>E(s)),d.appendChild(o),d}function B(s,a,d=!1){if(d){const i=document.createElement("p");return i.className="w-full h-full p-1 text-xs text-gray-700",i.textContent=a[s]||"",i}const o=document.createElement("textarea");return o.className="w-full h-full p-1 text-xs bg-transparent border-0 rounded focus:outline-none focus:ring-1 focus:ring-tomato resize-none",o.placeholder="Remarque...",o.value=m[s]||"",o.addEventListener("change",i=>{const u=i.target.value;u?m[s]=u:delete m[s],saveCurrentPlan()}),o}function w(){document.querySelectorAll(".meal-card").forEach(s=>{s.addEventListener("dragstart",q),s.addEventListener("dragend",K)}),document.querySelectorAll(".meal-slot").forEach(s=>{s.addEventListener("dragover",V),s.addEventListener("dragleave",ie),s.addEventListener("drop",Q)})}async function C(s,a){const d=JSON.parse(JSON.stringify(c)),o=d[s];Array.isArray(o)?o.push({...a}):d[s]=[a];const i=j(f,"plans",v.id);try{await Ee(i,{[`weeks.${r}.menuData`]:d,lastUpdated:new Date}),$()}catch(u){console.error("Erreur lors de l'ajout de la recette: ",u),alert("Une erreur est survenue.")}}async function P(s,a){if(!v||!c[s]||!Array.isArray(c[s]))return;const d=JSON.parse(JSON.stringify(c));d[s].splice(a,1),d[s].length===0&&delete d[s];const o=j(f,"plans",v.id);try{await Ee(o,{[`weeks.${r}.menuData`]:d,lastUpdated:new Date})}catch(i){console.error("Erreur lors de la suppression de la recette: ",i),alert("Une erreur est survenue.")}}async function W(){if(confirm("Voulez-vous vraiment vider le menu de cette semaine ?")){const s={id:availablePlans.length>0?availablePlans[0].id:`${Ce()}_semaine-${r}`,name:availablePlans.length>0?availablePlans[0].name:"Mon plan",menuData:{},servingsData:{},remarksData:{},defaultNumPeople:L,startDay:l,lastUpdated:new Date};loadPlan(s),availablePlans.length>0?availablePlans[0]=s:availablePlans.push(s),await saveCurrentPlan()}}function Ae(s){s>=1&&s<=52&&(r=s,R())}function Ye(){e.currentWeekDisplay&&(e.currentWeekDisplay.textContent=`Semaine ${r}`)}function ze(){e.prevWeekBtn?.addEventListener("click",()=>Ae(r-1)),e.nextWeekBtn?.addEventListener("click",()=>Ae(r+1)),e.clearMenuBtn?.addEventListener("click",W),e.startDaySelect?.addEventListener("change",async s=>{if(l=s.target.value,v){const a=j(f,"plans",v.id);await Ee(a,{startDay:l,lastUpdated:new Date})}}),e.planSelect?.addEventListener("change",St),e.closeMealSelectModalBtn?.addEventListener("click",$),e.mealSelectModal?.addEventListener("click",s=>{s.target===e.mealSelectModal&&$()}),e.closeRecipeModalBtn?.addEventListener("click",()=>Fe.closeForm()),e.cancelRecipeBtn?.addEventListener("click",()=>Fe.closeForm()),e.importListBtn?.addEventListener("click",A),e.closeImportListModalBtn?.addEventListener("click",G),e.importListModal?.addEventListener("click",s=>{s.target===e.importListModal&&G()}),e.exportTxtBtn?.addEventListener("click",ne),e.exportPdfBtn?.addEventListener("click",ce),e.exportPlanPdfBtn?.addEventListener("click",be),e.mealPlanGrid?.addEventListener("click",s=>{const a=s.target.closest(".info-meal-btn");if(a){const d=a.dataset.slotId,o=parseInt(a.dataset.mealIndex,10);if(d&&!isNaN(o)){const i=c[d]?.[o];i&&he(a,i)}}}),e.sharePlanBtn?.addEventListener("click",()=>{if(!v){alert("Veuillez s√©lectionner un plan √† partager.");return}It({plan:v})})}function Ve(s=""){return s.split(" ").map(o=>o[0]).join("").substring(0,2).toUpperCase()}function Qe(s=[]){const a=document.getElementById("collaborators-bar"),d=document.getElementById("name-tooltip");if(!(!a||!d)){if(a.innerHTML="",s.length<=1){a.classList.add("hidden");return}s.forEach(o=>{const i=document.createElement("div");i.className="w-8 h-8 rounded-full flex items-center justify-center bg-gray-300 text-white font-bold text-xs ring-2 ring-white cursor-pointer",i.dataset.name=o.displayName||"Inconnu",o.photoURL?i.innerHTML=`<img src="${o.photoURL}" alt="${o.displayName}" class="w-full h-full rounded-full object-cover">`:i.textContent=Ve(o.displayName),i.addEventListener("mouseenter",u=>{d.textContent=u.currentTarget.dataset.name,d.classList.remove("hidden");const y=u.currentTarget.getBoundingClientRect();d.style.left=`${y.left+y.width/2-d.offsetWidth/2}px`,d.style.top=`${y.top-d.offsetHeight-5}px`}),i.addEventListener("mouseleave",()=>{d.classList.add("hidden")}),a.appendChild(i)}),a.classList.remove("hidden")}}function St(){const s=e.planSelect.value;v=O.find(i=>i.id===s)||null;const a=document.getElementById("delete-plan-btn"),d=document.getElementById("rename-plan-btn"),o=document.getElementById("leave-plan-btn");a&&(a.style.display=v&&v.isOwner?"inline-flex":"none"),d&&(d.style.display=v&&v.isOwner?"inline-flex":"none"),o&&(o.style.display=v&&!v.isOwner?"inline-flex":"none"),Qe(v?.participants),v&&(v.manualItems=v.manualItems||[]),R()}async function Xt(s,a){if(!v)return;const d=JSON.parse(JSON.stringify(p));a===L?delete d[s]:d[s]=a;const o=j(f,"plans",v.id);try{await Ee(o,{[`weeks.${r}.servingsData`]:d,lastUpdated:new Date})}catch(i){console.error("Erreur lors de la mise √† jour du nombre de personnes: ",i)}}async function Yt(){return f?(Wt(),ze(),pe(),await X(),await Me(),Qt(a=>{O=a,Jt(a),St()})):void 0}const Kt=Yt();return async()=>{const s=await Kt;typeof s=="function"&&s()}}const Hn=Object.freeze(Object.defineProperty({__proto__:null,default:qn},Symbol.toStringTag,{value:"Module"}));function Fn(){const e=Gt();return wt(),()=>{typeof e=="function"&&e()}}async function wt(){const e=document.getElementById("received-shares-container"),t=Ce();if(!(!t||!e)){e.innerHTML='<p class="text-gray-500">Chargement des partages re√ßus...</p>';try{const n=me(H(f,"plans"),Z("userId","==",t),Z("isShared","==",!0)),r=me(H(f,"plans"),Z("collaborators","array-contains",t)),[l,c]=await Promise.all([de(n),de(r)]);let p=[];if(l.forEach(m=>p.push({id:m.id,type:"Planification (Copie)",...m.data()})),c.forEach(m=>p.push({id:m.id,type:"Planification (Collaboratif)",...m.data()})),p.length===0){e.innerHTML=`<p class="text-gray-500">Vous n'avez aucun contenu partag√© par d'autres utilisateurs.</p>`;return}p.sort((m,g)=>(g.sharedAt?.seconds||g.lastUpdated?.seconds||0)-(m.sharedAt?.seconds||m.lastUpdated?.seconds||0)),e.innerHTML="";for(const m of p){const g=m.originalOwnerId||m.userId;if(!g)continue;const b=await Se(j(f,"users",g)),S=b.exists()?b.data().displayName:"Utilisateur inconnu";e.appendChild(Un(m,S))}}catch(n){console.error("Erreur lors du chargement des partages re√ßus : ",n),e.innerHTML='<p class="text-red-500">Une erreur est survenue.</p>'}}}function Un(e,t){const n=document.createElement("div");n.className="bg-white rounded-lg p-4 flex justify-between items-center shadow-sm";const r=document.createElement("div"),l=document.createElement("p");l.className="font-bold text-gray-800";let c="";e.type.includes("Collaboratif")?c=' <span class="text-xs font-medium bg-blue-100 text-blue-800 px-2 py-1 rounded-full">Collab</span>':e.type.includes("Copie")&&(c=' <span class="text-xs font-medium bg-gray-200 text-gray-800 px-2 py-1 rounded-full">Copie</span>'),l.innerHTML=`${e.name}${c}`;const p=document.createElement("p");p.className="text-sm text-gray-500 mt-1";const m=e.sharedAt?new Date(e.sharedAt.seconds*1e3).toLocaleDateString("fr-FR"):e.lastUpdated?new Date(e.lastUpdated.seconds*1e3).toLocaleDateString("fr-FR"):"date inconnue";p.textContent=`Partag√© par ${t} le ${m}`,r.appendChild(l),r.appendChild(p),n.appendChild(r);const g=document.createElement("button");return g.className="btn btn-ghost text-red-500 btn-sm",g.innerHTML='<i class="fas fa-trash"></i>',g.title="Supprimer ce contenu partag√©",g.addEventListener("click",()=>On(e.id,e.type)),n.appendChild(g),n}async function On(e,t){if(confirm(`Voulez-vous vraiment supprimer cette ${t.toLowerCase()} partag√©e ?`))try{const n=t.startsWith("Planification")?"plans":"shopping_lists",r=j(f,n,e),l=await Se(r);l.exists()&&l.data().userId===Ce()?(await $e(r),wt()):(alert("Vous n'avez pas la permission de supprimer cet √©l√©ment ou il a d√©j√† √©t√© supprim√©."),wt())}catch(n){console.error("Erreur de suppression: ",n),alert("Une erreur est survenue.")}}async function Gt(){const e=document.getElementById("sent-shares-container"),t=Ce();if(!t||!e)return()=>{};e.innerHTML='<p class="text-gray-500">Chargement des partages envoy√©s...</p>';const n=H(f,"shares"),r=me(n,Z("senderId","==",t));return Xe(r,async l=>{if(l.empty){e.innerHTML=`<p class="text-gray-500">Vous n'avez envoy√© aucun partage.</p>`;return}const c=l.docs.sort((p,m)=>(m.data().createdAt?.seconds||0)-(p.data().createdAt?.seconds||0));e.innerHTML="";for(const p of c){const m=p.data();try{const g=await Se(j(f,"users",m.receiverId));if(g.exists()){const b=g.data();e.appendChild(zn(m,b.displayName,p.id))}}catch(g){console.error("Could not load receiver for sent share",g)}}},l=>{console.error("Erreur lors du chargement des partages envoy√©s : ",l),e&&(e.innerHTML='<p class="text-red-500">Une erreur est survenue.</p>')})}function zn(e,t,n){const r=document.createElement("div");r.className="bg-white rounded-lg p-4 flex justify-between items-center shadow-sm";const l=document.createElement("div"),c=document.createElement("p");c.className="font-bold text-gray-800";let p=[];e.plan&&p.push("Planification"),e.shoppingList&&p.push("Liste de courses"),c.textContent=p.join(" et ");const m=document.createElement("p");m.className="text-sm text-gray-500";const g=new Date(e.createdAt.seconds*1e3).toLocaleDateString("fr-FR");m.textContent=`Envoy√© √† ${t} le ${g}`,l.appendChild(c),l.appendChild(m),r.appendChild(l);const b=document.createElement("div");b.className="flex items-center space-x-4";const S=document.createElement("span");S.textContent=e.status;let M="bg-gray-200 text-gray-800";switch(e.status){case"accepted":M="bg-green-100 text-green-800";break;case"declined":M="bg-red-100 text-red-800";break;case"pending":M="bg-yellow-100 text-yellow-800";break}S.className=`text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full ${M}`,b.appendChild(S);const L=document.createElement("button");return L.className="btn btn-ghost text-red-500 btn-sm",L.innerHTML='<i class="fas fa-trash"></i>',L.title="Annuler le partage",L.addEventListener("click",()=>Vn(n)),b.appendChild(L),r.appendChild(b),r}async function Vn(e){if(confirm("Voulez-vous vraiment annuler ce partage ? L'autre utilisateur ne le verra plus."))try{await $e(j(f,"shares",e)),Gt()}catch(t){console.error("Erreur lors de la suppression du partage: ",t),alert("Une erreur est survenue.")}}const Qn=Object.freeze(Object.defineProperty({__proto__:null,default:Fn},Symbol.toStringTag,{value:"Module"})),Pt=document.querySelector("main"),Jn={menu:{html:`
        <div class="flex flex-col md:flex-row md:space-x-2">

            <!-- Left Column: Meal Planner -->
            <div class="w-full md:w-5/6">
                <section id="meal-planning-section" aria-labelledby="meal-planning-heading" class="mb-8 md:mb-12">
                                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4">
                                        <h2 id="meal-planning-heading" class="text-xl md:text-2xl font-bold text-gray-800">Planification des repas</h2>
                                        <div class="mt-3 md:mt-0 flex items-center space-x-2 md:space-x-3">
                                            <button id="generate-plan-ai-btn" class="btn btn-primary btn-sm">
                                                <i class="fas fa-robot mr-1 md:mr-2"></i> IA Semaine
                                            </button>
                                            <button id="clear-menu-btn" class="btn btn-outline btn-sm text-red-800 hover:bg-red-100">
                                                <i class="fas fa-trash-alt mr-1 md:mr-2"></i> Vider le menu
                                            </button>
                                            <button id="export-plan-pdf-btn" class="btn btn-outline btn-sm">
                                                <i class="fas fa-file-pdf mr-1 md:mr-2"></i> Exporter Plan (PDF)
                                            </button>
                                            <button id="share-plan-btn" class="btn btn-secondary btn-sm">
                                                <i class="fas fa-share-alt mr-1 md:mr-2"></i> Partager
                                            </button>
                                        </div>
                                    </div>
                            
                                    <!-- Week Navigation & Plan Selector -->
                                    <div class="flex flex-col md:flex-row justify-between items-center mb-4 space-y-3 md:space-y-0">
                                        <!-- Week Navigation -->
                                        <div class="flex justify-between items-center bg-white p-2 md:p-3 rounded-lg shadow-sm">
                                            <button id="prev-week-btn" class="btn btn-ghost btn-sm" aria-label="Semaine pr√©c√©dente">
                                                <i class="fas fa-chevron-left mr-1 md:mr-2"></i> Pr√©c.
                                            </button>
                                            <div id="current-week-display" class="text-gray-700 font-medium text-sm md:text-base text-center mx-4">Semaine X</div>
                                            <button id="next-week-btn" class="btn btn-ghost btn-sm" aria-label="Semaine suivante">
                                                Suiv. <i class="fas fa-chevron-right ml-1 md:ml-2"></i>
                                            </button>
                                        </div>
                                        <!-- Plan Selector -->
                                        <div class="flex items-center space-x-2 bg-white p-3 rounded-lg shadow-sm">
                                            <label for="plan-select" class="text-sm font-medium text-gray-700">Plan affich√©:</label>
                                            <select id="plan-select" class="rounded-md border-gray-300 shadow-sm focus:border-tomato focus:ring focus:ring-tomato focus:ring-opacity-50 text-sm py-1">
                                                <!-- Options will be generated by JS -->
                                            </select>
                                            <button id="create-plan-btn" class="btn btn-primary btn-sm" title="Cr√©er un nouveau plan">
                                                <i class="fas fa-plus"></i>
                                            </button>
                                            <button id="rename-plan-btn" class="btn btn-ghost text-blue-500 hover:bg-blue-100 btn-sm" title="Renommer le plan s√©lectionn√©">
                                                <i class="fas fa-pencil-alt"></i>
                                            </button>
                                            <button id="leave-plan-btn" class="btn btn-ghost text-yellow-600 hover:bg-yellow-100 btn-sm" title="Quitter le plan collaboratif">
                                                <i class="fas fa-door-open"></i>
                                            </button>
                                            <button id="delete-plan-btn" class="btn btn-ghost text-red-500 hover:bg-red-100 btn-sm" title="Supprimer le plan s√©lectionn√©">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Collaborators Bar -->
                                    <div id="collaborators-bar" class="flex items-center space-x-2 mb-4 hidden">
                                        <!-- Avatars will be injected here -->
                                    </div>
                            
                                            <!-- Settings Section -->
                                            <div class="inline-flex items-center space-x-6 bg-white p-3 rounded-lg shadow-sm mb-4">                                        <div>
                                            <label for="start-day-select" class="text-sm font-medium text-gray-700">D√©but de semaine:</label>
                                            <select id="start-day-select" class="rounded-md border-gray-300 shadow-sm focus:border-tomato focus:ring-tomato text-sm py-1">
                                                <option>Lundi</option>
                                                <option>Mardi</option>
                                                <option>Mercredi</option>
                                                <option>Jeudi</option>
                                                <option>Vendredi</option>
                                                <option>Samedi</option>
                                                <option>Dimanche</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label for="default-servings-input" class="text-sm font-medium text-gray-700">Personnes par d√©faut:</label>
                                            <div id="default-servings-control" class="mt-1"></div>
                                        </div>
                                    </div>                    <!-- Meal Plan Grid -->
                    <div class="bg-white rounded-xl shadow-md p-4 overflow-x-auto">
                        <div id="meal-plan-grid-layout" class="min-w-[1400px]">
                            <!-- Header -->
                            <div class="grid grid-cols-[100px_35px_repeat(5,_minmax(0,_1fr))_35px_repeat(5,_minmax(0,_1fr))] gap-1 text-center mb-1">
                                <div class="p-2"></div> <!-- Empty corner -->
                                <div class="p-2 rounded-t-lg bg-amber-100 text-amber-800 font-bold col-span-6">MIDI</div>
                                <div class="p-2 rounded-t-lg bg-stone-200 text-stone-800 font-bold col-span-6">SOIR</div>
                                
                                <div class="p-1"></div> <!-- Empty under day name -->
                                <div class="p-1 text-xs font-semibold"><i class="fas fa-users"></i></div>
                                <div class="p-1 text-xs font-semibold text-gray-600">Entr√©e</div>
                                <div class="p-1 text-xs font-semibold text-gray-600">Plat</div>
                                <div class="p-1 text-xs font-semibold text-gray-600">Accomp.</div>
                                <div class="p-1 text-xs font-semibold text-gray-600">Dessert</div>
                                <div class="p-1 text-xs font-semibold text-gray-600">Remarque</div>

                                <div class="p-1 text-xs font-semibold"><i class="fas fa-users"></i></div>
                                <div class="p-1 text-xs font-semibold text-gray-600">Entr√©e</div>
                                <div class="p-1 text-xs font-semibold text-gray-600">Plat</div>
                                <div class="p-1 text-xs font-semibold text-gray-600">Accomp.</div>
                                <div class="p-1 text-xs font-semibold text-gray-600">Dessert</div>
                                <div class="p-1 text-xs font-semibold text-gray-600">Remarque</div>
                            </div>
                            <!-- Rows generated by JS -->
                            <div id="meal-plan-grid" class="space-y-1">
                                <div class="p-10 text-center text-gray-500 italic col-span-full">Chargement du planning...</div>
                            </div>                                            </div>
                                        </div>
                                    </section>


                                </div>
                    
                                <!-- Right Column: Shopping List -->
                                <div class="w-full md:w-1/6">
                                    <section id="shopping-list-section" aria-labelledby="shopping-list-heading" class="mb-8 md:mb-12 md:sticky md:top-24">
                                        <div class="bg-white rounded-xl shadow-md p-4 md:p-6">
                                            <h2 id="shopping-list-heading" class="text-xl md:text-2xl font-bold text-gray-800 mb-4">Liste de courses</h2>
                                            <div class="flex justify-end space-x-2 mb-4">
                                                <button id="import-list-btn" class="btn btn-secondary btn-sm">
                                                    <i class="fas fa-download mr-2"></i>Importer une liste
                                                </button>
                                                <div id="export-buttons-container" class="flex space-x-2">
                                                    <button id="export-txt-btn" class="btn btn-outline btn-sm">
                                                        <i class="fas fa-file-alt mr-2"></i>TXT
                                                    </button>
                                                    <button id="export-pdf-btn" class="btn btn-outline btn-sm">
                                                        <i class="fas fa-file-pdf mr-2"></i>PDF
                                                    </button>
                                                </div>
                                            </div>
                    
                                            <!-- Shopping List Container -->
                                            <div id="shopping-list-container" class="mb-4 max-h-[70vh] overflow-y-auto pr-2">                            <ul id="shopping-list" class="space-y-2 text-sm">
                                <!-- Les articles de la liste de courses seront g√©n√©r√©s ici -->
                            </ul>
                        </div>

                        <!-- Add Item Input -->
                        <div class="mt-4 flex items-stretch">
                            <div class="relative flex-grow">
                                <input type="text" id="add-item-input" placeholder="Chercher ou ajouter..." class="w-full border border-gray-300 rounded-l-lg px-2 py-1 text-xs focus:outline-none focus:ring-2 focus:ring-tomato focus:border-transparent">
                                <div id="add-item-results" class="absolute z-10 w-full bg-white border border-gray-300 rounded-md shadow-lg mt-1 hidden max-h-48 overflow-y-auto bottom-full mb-2"></div>
                            </div>
                            <button id="add-item-btn" class="btn btn-primary rounded-l-none -ml-px btn-xs" aria-label="Ajouter l'article">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>

                         <!-- AI Shopping Tips Placeholder -->
                        <div id="ai-shopping-tip" class="mt-6 bg-avocado bg-opacity-10 rounded-lg p-3 hidden">
                            <div class="flex items-start">
                                 <div class="w-8 h-8 bg-avocado bg-opacity-20 rounded-full flex items-center justify-center mr-3 shrink-0">
                                    <i class="fas fa-lightbulb text-avocado"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-avocado mb-1 text-sm">Astuce √âconomique</h4>
                                    <p id="ai-shopping-tip-text" class="text-sm text-gray-700">...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>

        <!-- Shared Plans Modal -->
        <div id="shared-plans-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[100] hidden">
            <div class="bg-white rounded-xl p-6 w-11/12 max-w-6xl max-h-[90vh] overflow-y-auto relative">
                <button id="close-shared-plans-modal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600" aria-label="Fermer">
                    <i class="fas fa-times text-xl"></i>
                </button>
                <h3 id="shared-plans-modal-title" class="text-2xl font-bold mb-6">Plans partag√©s pour la Semaine X</h3>
                <div id="shared-plans-modal-container" class="space-y-6">
                    <!-- Shared plans will be loaded here -->
                </div>
            </div>
        </div>
        `,script:"./script.js"},recipes:{html:`
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl md:text-3xl font-bold text-gray-800">Mes Recettes</h2>
            <button id="add-recipe-btn" class="btn btn-primary">
                <i class="fas fa-plus mr-2"></i> Ajouter une recette
            </button>
        </div>

        <!-- Search Bar -->
        <div class="mb-6">
            <input type="text" id="search-bar" placeholder="Rechercher une recette..." class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-tomato focus:border-tomato">
        </div>

        <!-- Tabs Navigation -->
        <div id="category-tabs" class="mb-6 border-b border-gray-200 flex space-x-4 flex-nowrap overflow-x-auto pb-2">
            <!-- Tabs will be generated by recipes.js here -->
        </div>

        <!-- Recipe List Container -->
        <div id="recipe-list-container">
            <!-- Recipes for the selected tab will be loaded here -->
        </div>

        <!-- Reconstructed Recipe Form Modal -->
        <div id="recipe-form-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[100] hidden">
            <div class="bg-white rounded-xl p-6 w-11/12 max-w-3xl max-h-[90vh] overflow-y-auto relative">
                <button id="close-recipe-modal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600" aria-label="Fermer">
                    <i class="fas fa-times text-xl"></i>
                </button>
                <h3 id="recipe-modal-title" class="text-2xl font-bold mb-6">Ajouter/Modifier une recette</h3>
                <form id="recipe-form" class="space-y-4">
                    <input type="hidden" id="recipe-id">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="md:col-span-2">
                            <label for="recipe-name" class="block text-sm font-medium text-gray-700">Nom de la recette</label>
                            <input type="text" id="recipe-name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" required>
                        </div>
                        <div>
                            <label for="recipe-category" class="block text-sm font-medium text-gray-700">Cat√©gorie</label>
                            <select id="recipe-category" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" required>
                                <option>ENTREE</option>
                                <option>PLAT</option>
                                <option>ACCOMPAGNEMENT</option>
                                <option>DESSERT</option>
                            </select>
                        </div>
                        <div>
                            <label for="recipe-servings" class="block text-sm font-medium text-gray-700">Nombre de personnes</label>
                            <input type="number" id="recipe-servings" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" min="1">
                        </div>
                        <div>
                            <label for="recipe-prep-time" class="block text-sm font-medium text-gray-700">Temps de pr√©paration (min)</label>
                            <input type="number" id="recipe-prep-time" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" min="0">
                        </div>
                         <div>
                            <label for="recipe-difficulty" class="block text-sm font-medium text-gray-700">Difficult√©</label>
                            <select id="recipe-difficulty" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                                <option>Tr√®s facile</option>
                                <option>Facile</option>
                                <option>Moyen</option>
                                <option>Difficile</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <h4 class="text-lg font-medium text-gray-800 mb-2">Ingr√©dients</h4>
                        <div id="ingredients-list" class="space-y-2"></div>
                        <button type="button" id="add-ingredient-btn" class="btn btn-outline btn-sm mt-2">
                            <i class="fas fa-plus mr-2"></i> Ajouter un ingr√©dient
                        </button>
                    </div>
                    <div>
                        <label for="recipe-steps" class="block text-lg font-medium text-gray-800">Pr√©paration</label>
                        <textarea id="recipe-steps" rows="8" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></textarea>
                    </div>
                    <div class="flex justify-end space-x-4 pt-4">
                        <button type="button" id="cancel-recipe-btn" class="btn btn-ghost">Annuler</button>
                        <button type="submit" id="save-recipe-btn" class="btn btn-primary">Sauvegarder</button>
                    </div>
                </form>
            </div>
        </div>
        `,script:"./recipes.js"},ingredients:{html:`
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl md:text-3xl font-bold text-gray-800">Mes Ingr√©dients</h2>
            <div class="flex space-x-2">
                <button id="manage-categories-btn" class="btn btn-outline">
                    <i class="fas fa-tags mr-2"></i> G√©rer les cat√©gories
                </button>
                <button id="add-ingredient-btn" class="btn btn-primary">
                    <i class="fas fa-plus mr-2"></i> Ajouter un ingr√©dient
                </button>
            </div>
        </div>

        <!-- Search Bar -->
        <div class="mb-6">
            <input type="text" id="search-bar" placeholder="Rechercher un ingr√©dient..." class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-tomato focus:border-tomato">
        </div>

        <!-- Tabs Navigation -->
        <div id="category-tabs" class="mb-6 border-b border-gray-200 flex space-x-4 flex-nowrap overflow-x-auto pb-2">
            <!-- Tabs will be generated by ingredients.js here -->
        </div>

        <!-- Ingredient List Container -->
        <div id="ingredients-list-container">
            <p class="text-center text-gray-500 p-10">Chargement des ingr√©dients...</p>
        </div>

        <!-- Ingredient Form Modal -->
        <div id="ingredient-form-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[100] hidden">
            <div class="bg-white rounded-xl p-6 w-11/12 max-w-md relative">
                <button id="close-ingredient-modal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600"><i class="fas fa-times text-xl"></i></button>
                <h3 id="ingredient-modal-title" class="text-lg font-bold mb-4">Ajouter un Ingr√©dient</h3>
                <form id="ingredient-form" class="space-y-4">
                    <input type="hidden" id="ingredient-id">
                    <div>
                        <label for="ingredient-name" class="block text-sm font-medium text-gray-700">Nom</label>
                        <input type="text" id="ingredient-name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" required>
                    </div>
                    <div>
                        <label for="ingredient-unit" class="block text-sm font-medium text-gray-700">Unit√© par d√©faut</label>
                        <select id="ingredient-unit" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></select>
                    </div>
                    <div>
                        <label for="ingredient-category" class="block text-sm font-medium text-gray-700">Cat√©gorie</label>
                        <select id="ingredient-category" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" required></select>
                    </div>
                    <div class="flex justify-end space-x-4 pt-2">
                        <button type="button" id="cancel-ingredient-btn" class="btn btn-ghost">Annuler</button>
                        <button type="submit" id="save-ingredient-btn" class="btn btn-primary">Sauvegarder</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Category Management Modal -->
        <div id="category-management-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[100] hidden">
            <div class="bg-white rounded-xl p-6 w-11/12 max-w-lg relative">
                <h3 class="text-lg font-bold mb-4">G√©rer les cat√©gories d'ingr√©dients</h3>
                <form id="add-category-form" class="flex items-center space-x-2 mb-4">
                    <input type="text" id="new-category-name" placeholder="Nom de la nouvelle cat√©gorie" class="flex-grow mt-1 block w-full rounded-md border-gray-300 shadow-sm" required>
                    <button type="submit" class="btn btn-secondary">Ajouter</button>
                </form>
                <div id="category-list" class="max-h-64 overflow-y-auto border rounded-lg p-2"></div>
                <div class="flex justify-end space-x-4 mt-4">
                     <button type="button" id="close-category-modal" class="btn btn-ghost">Annuler</button>
                    <button type="button" id="done-category-modal-btn" class="btn btn-primary">Termin√©</button>
                </div>
            </div>
        </div>
        `,script:"./ingredients.js"},lists:{html:`
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl md:text-3xl font-bold text-gray-800">Mes Listes de Courses</h2>
            <button id="add-list-btn" class="btn btn-primary">
                <i class="fas fa-plus mr-2"></i> Cr√©er une liste
            </button>
        </div>

        <!-- Search Bar -->
        <div class="mb-6">
            <input type="text" id="search-bar" placeholder="Rechercher une liste..." class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-tomato focus:border-tomato">
        </div>

        <!-- Lists Container -->
        <div id="lists-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>

        <div class="mt-12">
            <h2 class="text-2xl md:text-3xl font-bold text-gray-800 mb-6">Listes Partag√©es</h2>
            <div id="shared-lists-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Les listes partag√©es seront charg√©es ici par JS -->
            </div>
        </div>

        <!-- List Form Modal -->
        <div id="list-form-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-start justify-center z-[100] hidden pt-20">
            <div class="bg-white rounded-xl p-6 w-11/12 max-w-3xl min-h-[75vh] max-h-[90vh] overflow-y-auto relative">
                <button id="close-list-modal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 z-10"><i class="fas fa-times text-xl"></i></button>
                <h3 id="list-modal-title" class="text-lg font-bold mb-4">Cr√©er une liste</h3>
                <form id="list-form" class="space-y-4 pb-20">
                    <input type="hidden" id="list-id">
                    <div>
                        <label for="list-name" class="block text-sm font-medium text-gray-700">Nom de la liste</label>
                        <input type="text" id="list-name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" required>
                    </div>
                    <div>
                        <h4 class="text-md font-medium text-gray-800 mb-2">Ingr√©dients</h4>
                        <div id="ingredients-list" class="space-y-2"></div>
                        <button type="button" id="add-ingredient-btn" class="btn btn-outline btn-sm mt-2">
                            <i class="fas fa-plus mr-2"></i> Ajouter un ingr√©dient
                        </button>
                    </div>
                </form>
                <div class="absolute bottom-0 left-0 right-0 px-6 py-4 bg-white/95 backdrop-blur-sm border-t border-gray-200 flex justify-end space-x-4">
                    <button type="button" id="cancel-list-btn" class="btn btn-ghost">Annuler</button>
                    <button type="submit" form="list-form" id="save-list-btn" class="btn btn-primary">Sauvegarder la liste</button>
                </div>
            </div>
        </div>
        `,script:"./lists.js"},friends:{html:`
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl md:text-3xl font-bold text-gray-800">Mes Amis</h2>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            <div class="md:col-span-2 space-y-8">
                <div>
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Liste d'amis</h3>
                    <div id="friends-list-container" class="space-y-4">
                        <!-- La liste d'amis sera charg√©e ici -->
                    </div>
                </div>
                <div>
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Demandes envoy√©es en attente</h3>
                    <div id="pending-requests-container" class="space-y-4">
                        <!-- Les demandes envoy√©es en attente seront charg√©es ici -->
                    </div>
                </div>
                <div>
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Demandes rejet√©es</h3>
                    <div id="declined-requests-container" class="space-y-4">
                        <!-- Les demandes rejet√©es seront charg√©es ici -->
                    </div>
                </div>
            </div>
            <div>
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Rechercher un ami</h3>
                    <div class="mb-4">
                        <div class="flex items-center space-x-2">
                            <input type="text" id="search-friends-input" placeholder="Nom ou email..." class="flex-grow p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-tomato focus:border-tomato">
                            <button id="search-friends-btn" class="btn btn-primary"><i class="fas fa-search"></i></button>
                        </div>
                        <div id="search-results-container" class="mt-2 space-y-2"></div>
                    </div>
                </div>
            </div>
        </div>
        `,script:"./friends.js"},shared:{html:`
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl md:text-3xl font-bold text-gray-800">Mes Partages</h2>
        </div>

        <div class="space-y-12">
            <div>
                <h3 class="text-xl font-bold text-gray-700 border-b pb-2 mb-4">Partages Re√ßus</h3>
                <div id="received-shares-container" class="space-y-4">
                    <!-- L'historique des partages accept√©s sera charg√© ici -->
                </div>
            </div>
            <div>
                <h3 class="text-xl font-bold text-gray-700 border-b pb-2 mb-4">Mes Partages Envoy√©s</h3>
                <div id="sent-shares-container" class="space-y-4">
                    <!-- L'historique des partages envoy√©s sera charg√© ici -->
                </div>
            </div>
        </div>
        `,script:"./shared.js"}},Wn=Object.assign({"./auth.js":on,"./firebase-config.js":sn,"./form-handler.js":ln,"./friends.js":fn,"./ingredients.js":hn,"./lists.js":xn,"./main.js":rn,"./notifications.js":Mn,"./plans.js":jn,"./recipes.js":An,"./script.js":Hn,"./shared.js":Qn,"./sharing.js":yn});let it=null;async function _t(e){typeof it=="function"&&(it(),it=null);const t=Jn[e];if(t&&Pt){if(Pt.innerHTML=t.html,t.script){const n=Wn[t.script];n?n.default&&typeof n.default=="function"&&(it=n.default()):console.error(`Module not found for path: ${t.script}`)}}else console.error(`Route not found: ${e}`)}function Gn(){const e=Te();if(e){const n=document.getElementById("user-display-name");n&&(n.textContent=e.displayName||e.email)}const t=document.querySelectorAll(".nav-btn");t.forEach(n=>{n.addEventListener("click",r=>{const l=r.currentTarget.dataset.path;_t(l),t.forEach(c=>{c.classList.remove("bg-tomato","text-white"),c.classList.add("bg-white","text-tomato")}),r.currentTarget.classList.add("bg-tomato","text-white"),r.currentTarget.classList.remove("bg-white","text-tomato")})}),_t("menu"),Vt()}document.addEventListener("DOMContentLoaded",()=>{jt().then(e=>{e&&Gn()})});
