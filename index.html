<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GustoPlan</title>
    <!-- Tailwind CSS (via CDN for simplicity, or local build) -->
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <!-- jsPDF and FileSaver for PDF/TXT Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"></script>
    <link rel="manifest" href="/assets/manifest-X2GYo0pP.json">
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>
  <script type="module" crossorigin src="/assets/main-CPC2Lv91.js"></script>
  <link rel="modulepreload" crossorigin href="/assets/firebase-config-9gANoKOS.js">
  <link rel="stylesheet" crossorigin href="/assets/firebase-config-DuwEdJQT.css">
</head>

<body class="bg-background text-foreground transition-colors duration-200">

    <!-- Mobile Navigation -->
    <div class="md:hidden fixed bottom-0 left-0 right-0 bg-white shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] z-50">
        <div class="flex justify-around items-center py-3">
            <a href="#" class="flex flex-col items-center text-tomato" aria-label="Accueil">
                <i class="fas fa-home text-xl"></i>
                <span class="text-xs mt-1">Accueil</span>
            </a>
            <a href="#meal-planning-section" class="flex flex-col items-center text-gray-500 hover:text-tomato"
                aria-label="Planning">
                <i class="fas fa-calendar-alt text-xl"></i>
                <span class="text-xs mt-1">Planning</span>
            </a>
            <a href="#shopping-list-section" class="flex flex-col items-center text-gray-500 hover:text-tomato"
                aria-label="Courses">
                <i class="fas fa-list text-xl"></i>
                <span class="text-xs mt-1">Courses</span>
            </a>
            <a href="#ai-suggestions-section" class="flex flex-col items-center text-gray-500 hover:text-tomato"
                aria-label="Suggestions IA">
                <i class="fas fa-robot text-xl"></i>
                <span class="text-xs mt-1">IA</span>
            </a>
        </div>
    </div>

    <!-- Header -->
    <header class="bg-eggplant text-white shadow-lg sticky top-0 z-40">
        <div class="container mx-auto px-4 py-3">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-2">
                    <i class="fas fa-utensils text-2xl"></i>
                    <h1 class="text-xl md:text-2xl font-bold">GustoPlan</h1>
                    <span
                        class="text-xs font-mono bg-yellow-200 text-yellow-800 px-1 rounded border border-yellow-400">Vanilla
                        JS</span>
                </div>

                <!-- Hamburger Menu for Mobile -->
                <div class="md:hidden flex items-center">
                    <button id="mobile-menu-btn" class="text-white focus:outline-none ml-4">
                        <i class="fas fa-bars text-2xl"></i>
                    </button>
                </div>
            </div>

            <!-- Desktop Navigation -->
            <div class="hidden md:flex items-center space-x-3">
                <button id="menu-btn" data-path="menu"
                    class="inline-flex items-center justify-center px-4 py-2 rounded-full text-sm font-medium bg-tomato text-white hover:bg-tomato-dark transition-colors shadow-sm nav-btn">Mon
                    Menu</button>
                <button id="shopping-mode-btn" data-path="shopping-mode"
                    class="inline-flex items-center justify-center px-4 py-2 rounded-full text-sm font-medium bg-white text-green-600 border border-green-600 hover:bg-green-50 transition-colors shadow-sm nav-btn"><i
                        class="fas fa-check-square mr-2"></i>Faire les courses</button>
                <button id="plans-btn" data-path="plans"
                    class="inline-flex items-center justify-center px-4 py-2 rounded-full text-sm font-medium bg-white text-tomato hover:bg-gray-100 transition-colors shadow-sm nav-btn">Mes
                    Plans</button>
                <button id="recipes-btn" data-path="recipes"
                    class="inline-flex items-center justify-center px-4 py-2 rounded-full text-sm font-medium bg-white text-tomato hover:bg-gray-100 transition-colors shadow-sm nav-btn">Mes
                    Recettes</button>
                <button id="ingredients-btn" data-path="ingredients"
                    class="inline-flex items-center justify-center px-4 py-2 rounded-full text-sm font-medium bg-white text-tomato hover:bg-gray-100 transition-colors shadow-sm nav-btn">Mes
                    Ingr√©dients</button>
                <button id="ai-btn" data-path="ai-suggestions"
                    class="inline-flex items-center justify-center px-4 py-2 rounded-full text-sm font-medium bg-white text-tomato hover:bg-gray-100 transition-colors shadow-sm nav-btn">
                    <i class="fas fa-robot mr-2"></i> IA Profil</button>
                <button id="lists-btn" data-path="lists"
                    class="inline-flex items-center justify-center px-4 py-2 rounded-full text-sm font-medium bg-white text-tomato hover:bg-gray-100 transition-colors shadow-sm nav-btn">Mes
                    Listes</button>
                <button id="shared-btn" data-path="shared"
                    class="inline-flex items-center justify-center px-4 py-2 rounded-full text-sm font-medium bg-white text-tomato hover:bg-gray-100 transition-colors shadow-sm nav-btn">Contenus
                    partag√©s</button>

                <!-- Feedback Button (Beta) -->
                <button id="feedback-btn"
                    class="inline-flex items-center justify-center px-4 py-2 rounded-full text-sm font-bold bg-yellow-400 text-yellow-900 hover:bg-yellow-500 transition-colors shadow-sm nav-btn animate-pulse"
                    title="Signaler un bug ou donner un avis">
                    <i class="fas fa-bug mr-2"></i> Avis / Bug
                </button>

                <!-- Notifications Bell -->
                <div class="relative">
                    <button id="notifications-btn"
                        class="w-10 h-10 flex items-center justify-center bg-white text-tomato rounded-full hover:bg-gray-100 shadow-sm transition-colors"
                        aria-label="Notifications">
                        <i class="fas fa-envelope"></i>
                        <span id="notifications-badge"
                            class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center hidden">0</span>
                    </button>
                </div>

                <!-- Profile Dropdown -->
                <div class="relative ml-2">
                    <button id="profile-btn"
                        class="flex items-center space-x-2 bg-gray-100 hover:bg-gray-200 rounded-full py-1 px-3 transition-colors">
                        <div
                            class="w-8 h-8 rounded-full bg-tomato text-white flex items-center justify-center font-bold">
                            <i class="fas fa-user"></i>
                        </div>
                        <span id="user-display-name" class="text-sm font-bold text-gray-800">Chargement...</span>
                        <i class="fas fa-chevron-down text-xs text-gray-500"></i>
                    </button>

                    <div id="profile-menu"
                        class="absolute top-12 right-0 bg-white rounded-lg shadow-xl w-64 py-2 hidden text-gray-700 z-[1000] border border-gray-100">
                        <div class="px-4 py-3 border-b bg-gray-50">
                            <p class="text-xs text-gray-500 uppercase font-semibold">Connect√© en tant que</p>
                            <p class="text-sm font-bold truncate" id="menu-user-name">Invit√©</p>
                        </div>
                        <button class="w-full text-left px-4 py-2 hover:bg-gray-100 transition-colors" id="btn-logout">
                            <i class="fas fa-sign-out-alt mr-2 text-red-500"></i> D√©connexion
                        </button>
                    </div>
                </div>

                <button id="header-settings-btn"
                    class="w-10 h-10 flex items-center justify-center bg-white text-gray-600 rounded-full hover:bg-gray-100 shadow-sm transition-colors mr-2"
                    aria-label="Param√®tres">
                    <i class="fas fa-cog"></i>
                </button>


                <button id="logout-btn"
                    class="inline-flex items-center justify-center px-4 py-2 rounded-full text-sm font-medium bg-red-500 text-white hover:bg-red-600 transition-colors shadow-sm">
                    <i class="fas fa-sign-out-alt mr-2"></i> D√©connexion
                </button>
            </div>
        </div>

        <!-- Mobile Menu Panel -->
        <div id="mobile-menu" class="hidden md:hidden">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <button data-path="menu"
                    class="nav-btn-mobile text-white hover:bg-tomato-dark block w-full text-left rounded-md px-3 py-2 font-medium">Mon
                    Menu</button>
                <button data-path="shopping-mode"
                    class="nav-btn-mobile text-white hover:bg-tomato-dark block w-full text-left rounded-md px-3 py-2 font-medium"><i
                        class="fas fa-check-square mr-2"></i>Faire les courses</button>
                <button data-path="plans"
                    class="nav-btn-mobile text-white hover:bg-tomato-dark block w-full text-left rounded-md px-3 py-2 font-medium">Mes
                    Plans</button>
                <button data-path="recipes"
                    class="nav-btn-mobile text-white hover:bg-tomato-dark block w-full text-left rounded-md px-3 py-2 font-medium">Mes
                    Recettes</button>
                <button data-path="ingredients"
                    class="nav-btn-mobile text-white hover:bg-tomato-dark block w-full text-left rounded-md px-3 py-2 font-medium">Mes
                    Ingr√©dients</button>
                <button data-path="ai-suggestions"
                    class="nav-btn-mobile text-white hover:bg-tomato-dark block w-full text-left rounded-md px-3 py-2 font-medium"><i
                        class="fas fa-robot mr-2"></i> IA Profil</button>
                <button data-path="lists"
                    class="nav-btn-mobile text-white hover:bg-tomato-dark block w-full text-left rounded-md px-3 py-2 font-medium">Mes
                    Listes</button>
                <button data-path="shared"
                    class="nav-btn-mobile text-white hover:bg-tomato-dark block w-full text-left rounded-md px-3 py-2 font-medium">Contenus
                    partag√©s</button>
                <button id="profile-btn-mobile"
                    class="text-white hover:bg-tomato-dark block w-full text-left rounded-md px-3 py-2 font-medium">Mon
                    Profil</button>
                <button id="logout-btn-mobile"
                    class="text-white bg-red-500 hover:bg-red-600 block w-full text-left rounded-md px-3 py-2 font-medium">D√©connexion</button>
            </div>
        </div>
        </div>
    </header>

    <div id="firebase-status" class="text-center text-sm py-1 hidden"></div>

    <!-- Main Content -->
    <main class="mx-auto px-2 py-6 md:py-8 pb-20 md:pb-8"></main>

    <!-- Tooltip pour les plats -->
    <div id="meal-tooltip" class="hidden fixed bg-white shadow-lg rounded-lg p-4 text-sm text-gray-800 z-50">
        <h4 id="tooltip-title" class="font-bold mb-2"></h4>
        <ul id="tooltip-ingredients" class="list-disc pl-4"></ul>
    </div>

    <!-- Tooltip for long meal names -->
    <div id="name-tooltip" class="hidden fixed bg-gray-800 text-white text-xs rounded py-1 px-2 z-50"></div>

    <!-- Footer -->
    <footer class="bg-eggplant text-white py-8 hidden md:block">
        <div class="container mx-auto px-4">
            <!-- Footer content -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-lg font-bold mb-4">GustoPlan</h3>
                    <p class="text-gray-300 text-sm">Votre assistant personnel pour des repas sains, √©conomiques et
                        savoureux.</p>
                </div>
                <div>
                    <h3 class="text-lg font-bold mb-4">Navigation</h3>
                    <ul class="space-y-2 text-sm">
                        <li><a href="#" class="text-gray-300 hover:text-white transition">Accueil</a></li>
                        <li><a href="#meal-planning-section"
                                class="text-gray-300 hover:text-white transition">Planification</a></li>
                        <li><a href="#ai-suggestions-section" class="text-gray-300 hover:text-white transition">Recettes
                                IA</a></li>
                        <li><a href="#community-section"
                                class="text-gray-300 hover:text-white transition">Communaut√©</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-bold mb-4">Aide</h3>
                    <ul class="space-y-2 text-sm">
                        <li><a href="#" class="text-gray-300 hover:text-white transition">FAQ</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-white transition">Contact</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-white transition">Conditions</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-white transition">Confidentialit√©</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-bold mb-4">Suivez-nous</h3>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-300 hover:text-white transition" aria-label="Facebook"><i
                                class="fab fa-facebook-f"></i></a>
                        <a href="#" class="text-gray-300 hover:text-white transition" aria-label="Twitter"><i
                                class="fab fa-twitter"></i></a>
                        <a href="#" class="text-gray-300 hover:text-white transition" aria-label="Instagram"><i
                                class="fab fa-instagram"></i></a>
                        <a href="#" class="text-gray-300 hover:text-white transition" aria-label="Pinterest"><i
                                class="fab fa-pinterest"></i></a>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-8 pt-6 text-center text-gray-400 text-sm">
                <p>¬© 2023 GustoPlan. Tous droits r√©serv√©s.</p>
            </div>
        </div>
    </footer>

    <!-- Modals -->

    <!-- Import List Modal -->
    <div id="import-list-modal"
        class="fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center z-[100] hidden"
        role="dialog">
        <div class="bg-card text-card-foreground border border-border rounded-xl p-6 w-11/12 max-w-lg relative">
            <button id="close-import-list-modal" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600"
                aria-label="Fermer">
                <i class="fas fa-times text-xl"></i>
            </button>
            <h3 id="import-list-modal-title" class="text-lg font-bold mb-4">Importer une liste de courses</h3>
            <div id="import-list-container" class="max-h-96 overflow-y-auto">
                <!-- List of saved shopping lists will be generated here -->
            </div>
        </div>
    </div>

    <!-- Voice Assistant Modal -->
    <div id="voice-modal"
        class="fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center z-[100] hidden" role="dialog"
        aria-modal="true" aria-labelledby="voice-modal-title">
        <div class="bg-card text-card-foreground border border-border rounded-xl p-6 w-11/12 max-w-md relative">
            <button id="close-voice-modal" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600"
                aria-label="Fermer">
                <i class="fas fa-times text-xl"></i>
            </button>
            <h3 id="voice-modal-title" class="text-lg md:text-xl font-bold text-center mb-4">Assistant vocal</h3>
            <div class="text-center py-6">
                <div id="voice-icon-container"
                    class="w-16 h-16 bg-tomato bg-opacity-10 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i id="voice-icon"
                        class="fas fa-microphone text-tomato text-2xl transition-transform duration-200"></i>
                </div>
                <p id="voice-status" class="text-muted-foreground font-medium min-h-[1.5em]">Pr√™t √† √©couter</p>
                <p id="voice-result" class="text-sm text-gray-500 mt-2 min-h-[2.5em]">Dites "Ajoute du poulet √† la
                    liste" ou "Quel est le repas de demain midi ?"</p>
            </div>
            <div class="flex justify-center">
                <button id="toggle-listening-btn" class="btn btn-primary rounded-full px-6 py-3">
                    <i class="fas fa-microphone mr-2"></i> Parler
                </button>
            </div>
        </div>
    </div>

    <!-- Recipe Details Modal -->
    <div id="recipe-modal"
        class="fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center z-[100] hidden" role="dialog"
        aria-modal="true" aria-labelledby="recipe-modal-title">
        <div
            class="bg-card text-card-foreground border border-border rounded-xl p-4 md:p-6 w-11/12 max-w-2xl max-h-[90vh] overflow-y-auto relative">
            <button id="close-recipe-modal" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600 z-10"
                aria-label="Fermer la recette">
                <i class="fas fa-times text-xl"></i>
            </button>
            <!-- Contenu charg√© par JS -->
            <div id="recipe-modal-content" class="opacity-0 transition-opacity duration-300">
                <div class="flex flex-col sm:flex-row justify-between sm:items-start mb-3 md:mb-4">
                    <div>
                        <h3 id="recipe-modal-title" class="text-xl md:text-2xl font-bold pr-8">Chargement...</h3>
                        <div class="flex items-center mt-1 space-x-2">
                            <span id="recipe-modal-score" class="nutrition-score score-c">?</span>
                            <span id="recipe-modal-info" class="text-xs md:text-sm text-gray-600">‚Ç¨?.?? ‚Ä¢ ?? min ‚Ä¢ ?
                                pers.</span>
                            <span id="recipe-modal-tags" class="text-xs"></span><!-- Tags like V√©g√©, Saison -->
                        </div>
                    </div>
                    <img id="recipe-modal-image" src="https://placehold.co/150x100.png?text=GustoPlan"
                        alt="Image du plat"
                        class="w-full sm:w-32 md:w-40 h-auto rounded-lg object-cover mt-3 sm:mt-0 flex-shrink-0">
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6 mt-4">
                    <div class="md:col-span-2">
                        <h4 class="font-bold text-base md:text-lg mb-2">Ingr√©dients</h4>
                        <ul id="recipe-modal-ingredients" class="space-y-1 text-sm md:text-base">
                            <li>Chargement...</li>
                        </ul>

                        <h4 class="font-bold text-base md:text-lg mt-4 md:mt-6 mb-2">Pr√©paration</h4>
                        <ol id="recipe-modal-steps" class="list-decimal list-inside space-y-2 text-sm md:text-base">
                            <li>Chargement...</li>
                        </ol>
                    </div>

                    <div>
                        <h4 class="font-bold text-base md:text-lg mb-2">Nutrition (indicatif)</h4>
                        <div id="recipe-modal-nutrition" class="bg-gray-50 p-3 rounded-lg space-y-1 text-xs md:text-sm">
                            <div class="flex justify-between"><span class="text-gray-600">Calories</span> <span
                                    class="font-medium">--- kcal</span></div>
                            <!-- Autres nutriments -->
                        </div>

                        <div id="recipe-modal-tip-section" class="mt-4 md:mt-6 hidden">
                            <h4 class="font-bold text-base md:text-lg mb-2">Astuce <i
                                    class="fas fa-lightbulb text-yellow-500"></i></h4>
                            <div class="bg-blue-50 p-3 rounded-lg">
                                <p id="recipe-modal-tip-text" class="text-sm text-blue-800">...</p>
                            </div>
                        </div>

                        <div class="mt-4 md:mt-6 space-y-2">
                            <button id="recipe-modal-add-plan-btn" class="btn btn-primary w-full btn-sm">
                                Ajouter au planning
                            </button>
                            <button id="recipe-modal-add-fav-btn" class="btn btn-outline w-full btn-sm">
                                <i class="far fa-heart mr-2"></i> Ajouter aux favoris
                            </button>
                            <button id="recipe-modal-remove-plan-btn"
                                class="btn btn-ghost text-red-600 hover:bg-red-50 w-full btn-sm hidden">
                                <i class="fas fa-trash-alt mr-2"></i> Retirer du planning
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="mt-6 flex justify-end">
                <button id="save-settings-btn" class="btn btn-primary px-6">
                    <i class="fas fa-save mr-2"></i> Sauver
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Spinner/Overlay (Optional) -->
    <div id="loading-overlay"
        class="fixed inset-0 bg-white bg-opacity-75 flex items-center justify-center z-[200] hidden">
        <i class="fas fa-spinner fa-spin text-tomato text-4xl"></i>
    </div>


    <!-- Create Plan Modal -->
    <div id="create-plan-modal"
        class="fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center z-[100] hidden"
        role="dialog">
        <div class="bg-card text-card-foreground border border-border rounded-xl p-6 w-11/12 max-w-md relative">
            <button id="close-create-plan-modal" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600"
                aria-label="Fermer">
                <i class="fas fa-times text-xl"></i>
            </button>
            <h3 class="text-lg font-bold mb-4">Cr√©er un nouveau menu</h3>
            <form id="create-plan-form">
                <div class="space-y-4">
                    <div>
                        <label for="plan-name" class="block text-sm font-medium text-muted-foreground">Nom du
                            menu</label>
                        <input type="text" id="plan-name"
                            class="mt-1 block w-full rounded-md bg-input border-input text-foreground shadow-sm focus:ring-2 focus:ring-ring focus:border-ring focus:border-tomato focus:ring-tomato"
                            required>
                    </div>
                </div>
                <div class="flex justify-end space-x-4 mt-6">
                    <button type="button" id="cancel-create-plan-btn" class="btn btn-ghost">Annuler</button>
                    <button type="submit" class="btn btn-primary">Cr√©er</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Rename Plan Modal -->
    <div id="rename-plan-modal"
        class="fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center z-[100] hidden"
        role="dialog">
        <div class="bg-card text-card-foreground border border-border rounded-xl p-6 w-11/12 max-w-md relative">
            <button id="close-rename-plan-modal" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600"
                aria-label="Fermer">
                <i class="fas fa-times text-xl"></i>
            </button>
            <h3 class="text-lg font-bold mb-4">Renommer le menu</h3>
            <form id="rename-plan-form">
                <div>
                    <label for="new-plan-name" class="block text-sm font-medium text-muted-foreground">Nouveau nom du
                        menu</label>
                    <input type="text" id="new-plan-name"
                        class="mt-1 block w-full rounded-md bg-input border-input text-foreground shadow-sm focus:ring-2 focus:ring-ring focus:border-ring focus:border-tomato focus:ring-tomato"
                        required>
                </div>
                <div class="flex justify-end space-x-4 mt-6">
                    <button type="button" id="cancel-rename-plan-btn" class="btn btn-ghost">Annuler</button>
                    <button type="submit" class="btn btn-primary">Renommer</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-confirm-modal"
        class="fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center z-[150] hidden"
        role="dialog">
        <div class="bg-card text-card-foreground border border-border rounded-xl p-6 w-11/12 max-w-sm text-center">
            <h3 id="delete-confirm-title" class="text-lg font-bold mb-4">Confirmer la suppression</h3>
            <p id="delete-confirm-message" class="text-gray-600 mb-6">√ätes-vous s√ªr de vouloir supprimer cet √©l√©ment ?
            </p>
            <div class="flex justify-center space-x-4">
                <button id="cancel-delete-btn" class="btn btn-ghost">Annuler</button>
                <button id="confirm-delete-btn" class="btn bg-red-500 text-white hover:bg-red-600">Supprimer</button>
            </div>
        </div>
    </div>

    <!-- Seasonal List Generator Modal -->
    <div id="seasonal-list-modal"
        class="fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center z-[100] hidden">
        <div
            class="bg-card text-card-foreground border border-border rounded-xl p-6 w-11/12 max-w-lg relative max-h-[90vh] overflow-y-auto">
            <button id="close-seasonal-modal" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600"
                aria-label="Fermer">
                <i class="fas fa-times text-xl"></i>
            </button>
            <h3 class="text-lg font-bold mb-4">G√©n√©rer une liste de saison</h3>

            <div class="space-y-4">
                <!-- Step 1: Season -->
                <!-- Step 1: Mode & Selection -->
                <div>
                    <div class="flex space-x-4 mb-4 border-b pb-2">
                        <label class="flex items-center cursor-pointer">
                            <input type="radio" name="gen-mode" value="season"
                                class="form-radio text-tomato focus:ring-tomato" checked>
                            <span class="ml-2 text-sm font-medium text-gray-700">Par Saison</span>
                        </label>
                        <label class="flex items-center cursor-pointer">
                            <input type="radio" name="gen-mode" value="month"
                                class="form-radio text-tomato focus:ring-tomato">
                            <span class="ml-2 text-sm font-medium text-gray-700">Par Mois</span>
                        </label>
                    </div>

                    <div id="gen-season-selector">
                        <label class="block text-sm font-medium text-muted-foreground mb-2">Choisir la saison</label>
                        <div class="grid grid-cols-2 gap-3">
                            <label class="cursor-pointer">
                                <input type="radio" name="gen-season" value="Printemps" class="peer sr-only">
                                <div
                                    class="p-3 rounded-lg border text-center peer-checked:bg-green-100 peer-checked:border-green-500 hover:bg-gray-50">
                                    <span class="block text-2xl">üå∏</span>
                                    <span class="text-sm font-medium">Printemps</span>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="gen-season" value="Et√©" class="peer sr-only">
                                <div
                                    class="p-3 rounded-lg border text-center peer-checked:bg-yellow-100 peer-checked:border-yellow-500 hover:bg-gray-50">
                                    <span class="block text-2xl">‚òÄÔ∏è</span>
                                    <span class="text-sm font-medium">Et√©</span>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="gen-season" value="Automne" class="peer sr-only">
                                <div
                                    class="p-3 rounded-lg border text-center peer-checked:bg-orange-100 peer-checked:border-orange-500 hover:bg-gray-50">
                                    <span class="block text-2xl">üçÇ</span>
                                    <span class="text-sm font-medium">Automne</span>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="gen-season" value="Hiver" class="peer sr-only">
                                <div
                                    class="p-3 rounded-lg border text-center peer-checked:bg-blue-100 peer-checked:border-blue-500 hover:bg-gray-50">
                                    <span class="block text-2xl">‚ùÑÔ∏è</span>
                                    <span class="text-sm font-medium">Hiver</span>
                                </div>
                            </label>
                        </div>
                    </div>

                    <div id="gen-month-selector" class="hidden">
                        <label for="gen-month" class="block text-sm font-medium text-muted-foreground mb-2">Choisir le
                            mois</label>
                        <select id="gen-month"
                            class="block w-full rounded-md border-gray-300 shadow-sm focus:border-tomato focus:ring-tomato">
                            <option value="Janvier">Janvier</option>
                            <option value="F√©vrier">F√©vrier</option>
                            <option value="Mars">Mars</option>
                            <option value="Avril">Avril</option>
                            <option value="Mai">Mai</option>
                            <option value="Juin">Juin</option>
                            <option value="Juillet">Juillet</option>
                            <option value="Ao√ªt">Ao√ªt</option>
                            <option value="Septembre">Septembre</option>
                            <option value="Octobre">Octobre</option>
                            <option value="Novembre">Novembre</option>
                            <option value="D√©cembre">D√©cembre</option>
                        </select>
                    </div>
                </div>

                <!-- Step 2: Category -->
                <div>
                    <label for="gen-category" class="block text-sm font-medium text-muted-foreground mb-2">2. Choisir la
                        cat√©gorie</label>
                    <select id="gen-category"
                        class="block w-full rounded-md border-gray-300 shadow-sm focus:border-tomato focus:ring-tomato">
                        <!-- Categories will be loaded here -->
                    </select>
                </div>

                <!-- Step 3: Preview -->
                <div id="gen-preview-section" class="hidden">
                    <label class="block text-sm font-medium text-muted-foreground mb-2">3. S√©lectionner les
                        ingr√©dients</label>
                    <div id="gen-preview-list"
                        class="max-h-48 overflow-y-auto border rounded-md p-2 space-y-2 bg-gray-50">
                        <!-- Checkboxes will be loaded here -->
                    </div>
                </div>
            </div>

            <div class="flex justify-end space-x-4 mt-6">
                <button id="gen-preview-btn" class="btn btn-secondary">Voir les ingr√©dients</button>
                <button id="gen-create-btn" class="btn btn-primary hidden">Cr√©er la liste</button>
            </div>
        </div>
    </div>

    <!-- Save Plan As Modal -->
    <div id="save-plan-as-modal"
        class="fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center z-[100] hidden"
        role="dialog">
        <div class="bg-card text-card-foreground border border-border rounded-xl p-6 w-11/12 max-w-md relative">
            <button id="close-save-plan-as-modal" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600"
                aria-label="Fermer">
                <i class="fas fa-times text-xl"></i>
            </button>
            <h3 class="text-lg font-bold mb-4">Nommer la sauvegarde</h3>
            <form id="save-plan-as-form">
                <div>
                    <label for="save-plan-name" class="block text-sm font-medium text-muted-foreground">Nom de la
                        sauvegarde</label>
                    <input type="text" id="save-plan-name"
                        class="mt-1 block w-full rounded-md bg-input border-input text-foreground shadow-sm focus:ring-2 focus:ring-ring focus:border-ring focus:border-tomato focus:ring-tomato"
                        required>
                </div>
                <div class="flex justify-end space-x-4 mt-6">
                    <button type="button" id="cancel-save-plan-as-btn" class="btn btn-ghost">Annuler</button>
                    <button type="submit" class="btn btn-primary">Enregistrer</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Meal Selection Modal -->
    <div id="meal-select-modal"
        class="fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center z-[100] hidden"
        role="dialog">
        <div class="bg-card text-card-foreground border border-border rounded-xl p-6 w-11/12 max-w-lg relative">
            <button id="close-meal-select-modal" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600"
                aria-label="Fermer">
                <i class="fas fa-times text-xl"></i>
            </button>
            <h3 id="meal-select-modal-title" class="text-lg font-bold mb-4">S√©lectionner un plat</h3>
            <div id="meal-select-list" class="max-h-96 overflow-y-auto">
                <!-- Meal list will be generated here -->
            </div>
        </div>
    </div>


    <!-- Recipe EDIT Form Modal -->
    <div id="edit-recipe-form-modal"
        class="fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center z-[100] hidden">
        <div
            class="bg-card text-card-foreground border border-border rounded-xl p-6 w-11/12 max-w-3xl max-h-[90vh] overflow-y-auto relative">
            <button id="close-edit-recipe-modal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600"
                aria-label="Fermer">
                <i class="fas fa-times text-xl"></i>
            </button>
            <h3 id="edit-recipe-modal-title" class="text-2xl font-bold mb-6">Modifier la recette</h3>

            <!-- Magic Import Section -->
            <div class="mb-6 p-4 bg-purple-50 border border-purple-200 rounded-lg">
                <label class="block text-sm font-medium text-purple-700 mb-2">‚ú® Import Intelligent (IA)</label>
                <div class="flex gap-2">
                    <input type="url" id="magic-import-url" placeholder="Collez l'URL d'une recette (Marmiton, 750g...)"
                        class="flex-1 rounded-md border-purple-300 focus:border-purple-500 focus:ring-purple-500 text-sm">
                    <button type="button" id="btn-magic-import"
                        class="bg-purple-600 text-white px-4 py-2 rounded-md hover:bg-purple-700 font-medium text-sm flex items-center">
                        <i class="fas fa-magic mr-2"></i> Importer
                    </button>
                </div>
                <p id="magic-import-status" class="text-xs text-purple-600 mt-1 hidden">
                    <i class="fas fa-spinner fa-spin mr-1"></i> Analyse en cours...
                </p>
            </div>

            <!-- AI Generator Section -->
            <div class="mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                <label class="block text-sm font-medium text-blue-700 mb-2">üí° G√©n√©rateur (Chef Gusto)</label>
                <div class="flex gap-2">
                    <input type="text" id="ai-generate-prompt"
                        placeholder="Ex: Risotto aux champignons, J'ai des courgettes..."
                        class="flex-1 rounded-md border-blue-300 focus:border-blue-500 focus:ring-blue-500 text-sm">
                    <button type="button" id="btn-ai-generate"
                        class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 font-medium text-sm flex items-center">
                        <i class="fas fa-lightbulb mr-2"></i> Cr√©er
                    </button>
                </div>
                <p id="ai-generate-status" class="text-xs text-blue-600 mt-1 hidden">
                    <i class="fas fa-spinner fa-spin mr-1"></i> Chef Gusto r√©fl√©chit...
                </p>
            </div>
            <form id="edit-recipe-form" class="space-y-4">
                <input type="hidden" id="edit-recipe-id">

                <!-- Main Details Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="md:col-span-2">
                        <label for="edit-recipe-name" class="block text-sm font-medium text-muted-foreground">Nom de la
                            recette</label>
                        <input type="text" id="edit-recipe-name"
                            class="mt-1 block w-full rounded-md bg-input border-input text-foreground shadow-sm focus:ring-2 focus:ring-ring focus:border-ring focus:border-tomato focus:ring-tomato"
                            required>
                    </div>
                    <div class="md:col-span-2">
                        <label for="edit-recipe-image-url" class="block text-sm font-medium text-muted-foreground">URL
                            de l'image</label>
                        <input type="text" id="edit-recipe-image-url"
                            class="mt-1 block w-full rounded-md bg-input border-input text-foreground shadow-sm focus:ring-2 focus:ring-ring focus:border-ring focus:border-tomato focus:ring-tomato"
                            placeholder="Laisser vide pour une image al√©atoire">
                    </div>
                    <div>
                        <label for="edit-recipe-category"
                            class="block text-sm font-medium text-muted-foreground">Cat√©gorie</label>
                        <select id="edit-recipe-category"
                            class="mt-1 block w-full rounded-md bg-input border-input text-foreground shadow-sm focus:ring-2 focus:ring-ring focus:border-ring focus:border-tomato focus:ring-tomato"
                            required>
                            <option>ENTREE</option>
                            <option>PLAT</option>
                            <option>ACCOMPAGNEMENT</option>
                            <option>DESSERT</option>
                        </select>
                    </div>
                    <div>
                        <label for="edit-recipe-servings" class="block text-sm font-medium text-muted-foreground">Nombre
                            de personnes</label>
                        <input type="number" id="edit-recipe-servings"
                            class="mt-1 block w-full rounded-md bg-input border-input text-foreground shadow-sm focus:ring-2 focus:ring-ring focus:border-ring focus:border-tomato focus:ring-tomato"
                            min="1">
                    </div>
                    <div>
                        <label for="edit-recipe-prep-time" class="block text-sm font-medium text-muted-foreground">Temps
                            de pr√©paration (min)</label>
                        <input type="number" id="edit-recipe-prep-time"
                            class="mt-1 block w-full rounded-md bg-input border-input text-foreground shadow-sm focus:ring-2 focus:ring-ring focus:border-ring focus:border-tomato focus:ring-tomato"
                            min="0">
                    </div>
                    <div>
                        <label for="edit-recipe-difficulty"
                            class="block text-sm font-medium text-muted-foreground">Difficult√©</label>
                        <select id="edit-recipe-difficulty"
                            class="mt-1 block w-full rounded-md bg-input border-input text-foreground shadow-sm focus:ring-2 focus:ring-ring focus:border-ring focus:border-tomato focus:ring-tomato">
                            <option>Tr√®s facile</option>
                            <option>Facile</option>
                            <option>Moyen</option>
                            <option>Difficile</option>
                        </select>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-muted-foreground mb-1">Saisonnalit√©</label>
                        <div class="grid grid-cols-2 gap-4 mb-2">
                            <!-- Printemps -->
                            <div class="border border-green-200 rounded-md p-3 bg-green-50">
                                <label class="flex items-center space-x-2 cursor-pointer mb-2 font-medium">
                                    <input type="checkbox" id="recipe-season-printemps" value="Printemps"
                                        class="form-checkbox h-4 w-4 text-green-600 focus:ring-green-500 recipe-season-checkbox"
                                        data-months="avril,mai,juin">
                                    <span class="text-sm text-green-800">Printemps üå∏</span>
                                </label>
                                <div class="ml-6 space-y-1 flex flex-col">
                                    <label
                                        class="flex items-center space-x-2 cursor-pointer text-xs text-gray-700 hover:text-green-700">
                                        <input type="checkbox" id="recipe-month-avril" value="Avril"
                                            class="form-checkbox h-3 w-3 text-green-500 recipe-month-checkbox rounded-sm"
                                            data-season="Printemps">
                                        <span>Avril</span>
                                    </label>
                                    <label
                                        class="flex items-center space-x-2 cursor-pointer text-xs text-gray-700 hover:text-green-700">
                                        <input type="checkbox" id="recipe-month-mai" value="Mai"
                                            class="form-checkbox h-3 w-3 text-green-500 recipe-month-checkbox rounded-sm"
                                            data-season="Printemps">
                                        <span>Mai</span>
                                    </label>
                                    <label
                                        class="flex items-center space-x-2 cursor-pointer text-xs text-gray-700 hover:text-green-700">
                                        <input type="checkbox" id="recipe-month-juin" value="Juin"
                                            class="form-checkbox h-3 w-3 text-green-500 recipe-month-checkbox rounded-sm"
                                            data-season="Printemps">
                                        <span>Juin</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Et√© -->
                            <div class="border border-yellow-200 rounded-md p-3 bg-yellow-50">
                                <label class="flex items-center space-x-2 cursor-pointer mb-2 font-medium">
                                    <input type="checkbox" id="recipe-season-ete" value="Et√©"
                                        class="form-checkbox h-4 w-4 text-yellow-600 focus:ring-yellow-500 recipe-season-checkbox"
                                        data-months="juillet,aout,septembre">
                                    <span class="text-sm text-yellow-800">Et√© ‚òÄÔ∏è</span>
                                </label>
                                <div class="ml-6 space-y-1 flex flex-col">
                                    <label
                                        class="flex items-center space-x-2 cursor-pointer text-xs text-gray-700 hover:text-yellow-700">
                                        <input type="checkbox" id="recipe-month-juillet" value="Juillet"
                                            class="form-checkbox h-3 w-3 text-yellow-500 recipe-month-checkbox rounded-sm"
                                            data-season="Et√©">
                                        <span>Juillet</span>
                                    </label>
                                    <label
                                        class="flex items-center space-x-2 cursor-pointer text-xs text-gray-700 hover:text-yellow-700">
                                        <input type="checkbox" id="recipe-month-aout" value="Ao√ªt"
                                            class="form-checkbox h-3 w-3 text-yellow-500 recipe-month-checkbox rounded-sm"
                                            data-season="Et√©">
                                        <span>Ao√ªt</span>
                                    </label>
                                    <label
                                        class="flex items-center space-x-2 cursor-pointer text-xs text-gray-700 hover:text-yellow-700">
                                        <input type="checkbox" id="recipe-month-septembre" value="Septembre"
                                            class="form-checkbox h-3 w-3 text-yellow-500 recipe-month-checkbox rounded-sm"
                                            data-season="Et√©">
                                        <span>Septembre</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Automne -->
                            <div class="border border-orange-200 rounded-md p-3 bg-orange-50">
                                <label class="flex items-center space-x-2 cursor-pointer mb-2 font-medium">
                                    <input type="checkbox" id="recipe-season-automne" value="Automne"
                                        class="form-checkbox h-4 w-4 text-orange-600 focus:ring-orange-500 recipe-season-checkbox"
                                        data-months="octobre,novembre,decembre">
                                    <span class="text-sm text-orange-800">Automne üçÇ</span>
                                </label>
                                <div class="ml-6 space-y-1 flex flex-col">
                                    <label
                                        class="flex items-center space-x-2 cursor-pointer text-xs text-gray-700 hover:text-orange-700">
                                        <input type="checkbox" id="recipe-month-octobre" value="Octobre"
                                            class="form-checkbox h-3 w-3 text-orange-500 recipe-month-checkbox rounded-sm"
                                            data-season="Automne">
                                        <span>Octobre</span>
                                    </label>
                                    <label
                                        class="flex items-center space-x-2 cursor-pointer text-xs text-gray-700 hover:text-orange-700">
                                        <input type="checkbox" id="recipe-month-novembre" value="Novembre"
                                            class="form-checkbox h-3 w-3 text-orange-500 recipe-month-checkbox rounded-sm"
                                            data-season="Automne">
                                        <span>Novembre</span>
                                    </label>
                                    <label
                                        class="flex items-center space-x-2 cursor-pointer text-xs text-gray-700 hover:text-orange-700">
                                        <input type="checkbox" id="recipe-month-decembre" value="D√©cembre"
                                            class="form-checkbox h-3 w-3 text-orange-500 recipe-month-checkbox rounded-sm"
                                            data-season="Automne">
                                        <span>D√©cembre</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Hiver -->
                            <div class="border border-blue-200 rounded-md p-3 bg-blue-50">
                                <label class="flex items-center space-x-2 cursor-pointer mb-2 font-medium">
                                    <input type="checkbox" id="recipe-season-hiver" value="Hiver"
                                        class="form-checkbox h-4 w-4 text-blue-600 focus:ring-blue-500 recipe-season-checkbox"
                                        data-months="janvier,fevrier,mars">
                                    <span class="text-sm text-blue-800">Hiver ‚ùÑÔ∏è</span>
                                </label>
                                <div class="ml-6 space-y-1 flex flex-col">
                                    <label
                                        class="flex items-center space-x-2 cursor-pointer text-xs text-gray-700 hover:text-blue-700">
                                        <input type="checkbox" id="recipe-month-janvier" value="Janvier"
                                            class="form-checkbox h-3 w-3 text-blue-500 recipe-month-checkbox rounded-sm"
                                            data-season="Hiver">
                                        <span>Janvier</span>
                                    </label>
                                    <label
                                        class="flex items-center space-x-2 cursor-pointer text-xs text-gray-700 hover:text-blue-700">
                                        <input type="checkbox" id="recipe-month-fevrier" value="F√©vrier"
                                            class="form-checkbox h-3 w-3 text-blue-500 recipe-month-checkbox rounded-sm"
                                            data-season="Hiver">
                                        <span>F√©vrier</span>
                                    </label>
                                    <label
                                        class="flex items-center space-x-2 cursor-pointer text-xs text-gray-700 hover:text-blue-700">
                                        <input type="checkbox" id="recipe-month-mars" value="Mars"
                                            class="form-checkbox h-3 w-3 text-blue-500 recipe-month-checkbox rounded-sm"
                                            data-season="Hiver">
                                        <span>Mars</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ingredients Section -->
                <div>
                    <h4 class="text-lg font-medium text-gray-800 mb-2">Ingr√©dients</h4>
                    <div id="edit-ingredients-list" class="space-y-2"></div>
                    <button type="button" id="edit-add-ingredient-btn" class="btn btn-outline btn-sm mt-2">
                        <i class="fas fa-plus mr-2"></i> Ajouter un ingr√©dient
                    </button>
                </div>

                <!-- Steps Section -->
                <div>
                    <label for="edit-recipe-steps" class="block text-lg font-medium text-gray-800">Pr√©paration</label>
                    <textarea id="edit-recipe-steps" rows="8"
                        class="mt-1 block w-full rounded-md bg-input border-input text-foreground shadow-sm focus:ring-2 focus:ring-ring focus:border-ring focus:border-tomato focus:ring-tomato"></textarea>
                </div>

                <!-- Form Actions -->
                <div class="flex justify-end space-x-4 pt-4">
                    <button type="button" id="edit-cancel-recipe-btn" class="btn btn-ghost">Annuler</button>
                    <button type="submit" id="edit-save-recipe-btn" class="btn btn-primary">Sauvegarder</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Share Modal -->
    <div id="share-modal"
        class="fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center z-[100] hidden"
        role="dialog">
        <div class="bg-card text-card-foreground border border-border rounded-xl p-6 w-11/12 max-w-lg relative">
            <button id="close-share-modal" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600"
                aria-label="Fermer">
                <i class="fas fa-times text-xl"></i>
            </button>
            <h3 id="share-modal-title" class="text-lg font-bold mb-4">Partager</h3>
            <div id="share-friends-list" class="max-h-64 overflow-y-auto border rounded-lg p-2 mb-4">
                <!-- Friend list for sharing will be generated here -->
            </div>
            <div id="share-mode-selection" class="my-4 space-y-2">
                <div>
                    <label class="flex items-center p-2 border rounded-lg cursor-pointer hover:bg-gray-50">
                        <input type="radio" name="share-mode" value="collaborate"
                            class="form-radio h-5 w-5 text-tomato focus:ring-tomato" checked>
                        <span class="ml-3">
                            <span class="block font-medium">Inviter √† collaborer</span>
                            <span class="block text-sm text-gray-500">L'ami pourra modifier le plan original.</span>
                        </span>
                    </label>
                </div>
                <div>
                    <label class="flex items-center p-2 border rounded-lg cursor-pointer hover:bg-gray-50">
                        <input type="radio" name="share-mode" value="copy"
                            class="form-radio h-5 w-5 text-tomato focus:ring-tomato">
                        <span class="ml-3">
                            <span class="block font-medium">Envoyer une copie</span>
                            <span class="block text-sm text-gray-500">L'ami recevra une copie ind√©pendante du
                                plan.</span>
                        </span>
                    </label>
                </div>
            </div>
            <div class="flex justify-end">
                <button id="confirm-share-btn" class="btn btn-primary">Envoyer le partage</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal"
        class="fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center z-[100] hidden"
        role="dialog">
        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 w-11/12 max-w-md relative">
            <button id="close-settings-modal" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600"
                aria-label="Fermer">
                <i class="fas fa-times text-xl"></i>
            </button>
            <h3 class="text-lg font-bold mb-4 text-gray-900 dark:text-white">Param√®tres</h3>
            <div class="space-y-4 max-h-[70vh] overflow-y-auto pr-2">

                <!-- Dark Mode -->
                <div class="flex items-center justify-between p-3 border rounded-lg dark:border-gray-700">
                    <span class="font-medium text-gray-900 dark:text-gray-300">Mode Sombre</span>
                    <label for="dark-mode-toggle" class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="dark-mode-toggle" class="sr-only peer">
                        <div
                            class="w-11 h-6 bg-gray-200 rounded-full peer dark:bg-gray-700 peer-focus:ring-4 peer-focus:ring-tomato-300 dark:peer-focus:ring-tomato-800 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-tomato">
                        </div>
                    </label>
                </div>

                <!-- Seasonality Section -->
                <div class="border-t pt-4 dark:border-gray-700">
                    <h4 class="text-md font-bold text-gray-900 dark:text-white mb-2 flex items-center">
                        <span class="mr-2">üå±</span> Saisonnalit√© Intelligente
                    </h4>

                    <!-- Mode -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Mode de
                            saison</label>
                        <div class="flex flex-col space-y-2">
                            <label class="inline-flex items-center">
                                <input type="radio" name="season-mode" value="auto" class="form-radio text-tomato">
                                <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Automatique (Date du
                                    jour)</span>
                            </label>
                            <label class="inline-flex items-center">
                                <input type="radio" name="season-mode" value="forced" class="form-radio text-tomato">
                                <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Forc√©e</span>
                            </label>
                            <div id="forced-season-selector" class="ml-6 hidden">
                                <select id="forced-season-select" class="form-select mt-1">
                                    <option value="Printemps">üå∏ Printemps</option>
                                    <option value="Et√©">‚òÄÔ∏è Et√©</option>
                                    <option value="Automne">üçÇ Automne</option>
                                    <option value="Hiver">‚ùÑÔ∏è Hiver</option>
                                </select>
                            </div>
                            <label class="inline-flex items-center">
                                <input type="radio" name="season-mode" value="disabled" class="form-radio text-tomato">
                                <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">D√©sactiv√©e</span>
                            </label>
                        </div>
                    </div>

                    <!-- Hors Saison Behavior -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Produits hors
                            saison</label>
                        <select id="off-season-behavior" class="form-select mt-1">
                            <option value="last">Afficher en dernier (d√©faut)</option>
                            <option value="dim">Afficher normalement (gris√©)</option>
                            <option value="hide">Masquer compl√®tement</option>
                        </select>
                    </div>

                    <!-- Recipe Rules -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Recettes</label>
                        <div class="space-y-2">
                            <label class="inline-flex items-center">
                                <input type="checkbox" id="rule-prioritize-seasonal"
                                    class="form-checkbox text-tomato rounded">
                                <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Prioriser les recettes de
                                    saison</span>
                            </label>
                            <label class="inline-flex items-center">
                                <input type="checkbox" id="rule-warn-off-season"
                                    class="form-checkbox text-tomato rounded">
                                <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Avertir si hors
                                    saison</span>
                            </label>
                        </div>
                    </div>
                    <!-- Friends Section -->
                    <div class="border-t pt-4 dark:border-gray-700">
                        <h4 class="text-md font-bold text-gray-900 dark:text-white mb-3 flex items-center">
                            <span class="mr-2">üë•</span> Mes Amis
                        </h4>

                        <!-- My Friends List -->
                        <div id="settings-friends-list"
                            class="space-y-2 mb-4 max-h-48 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-200 dark:scrollbar-thumb-gray-700 pr-1">
                            <!-- Injected via JS -->
                        </div>

                        <!-- Search for Friends -->
                        <div
                            class="mt-4 p-3 bg-gray-50 dark:bg-gray-900/50 rounded-xl border border-gray-100 dark:border-gray-700">
                            <label
                                class="block text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-2">Ajouter
                                un ami</label>
                            <div class="flex gap-2">
                                <input type="text" id="settings-friends-search-input"
                                    class="flex-1 text-sm rounded-lg border-gray-200 dark:bg-gray-800 dark:border-gray-700 focus:ring-tomato focus:border-tomato py-1.5 px-3"
                                    placeholder="Nom ou email...">
                                <button id="settings-friends-search-btn"
                                    class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 hover:border-tomato p-2 rounded-lg transition-all shadow-sm">
                                    <i class="fas fa-search text-gray-500 dark:text-gray-400"></i>
                                </button>
                            </div>
                            <div id="settings-friends-search-results" class="space-y-2 mt-3">
                                <!-- Injected via JS -->
                            </div>
                        </div>
                    </div>

                </div>

                <!-- Modal Footer -->
                <div class="mt-6 flex justify-end pt-4 border-t dark:border-gray-700">
                    <button id="save-settings-btn"
                        class="btn btn-primary px-6 py-2 rounded-lg font-medium shadow-sm transition-transform hover:scale-105">
                        <i class="fas fa-save mr-2"></i> Sauver
                    </button>
                </div>
            </div>
        </div>

        <!-- Notifications Dropdown -->
        <div id="notifications-dropdown"
            class="absolute right-0 mt-2 w-80 bg-white rounded-xl shadow-lg z-50 hidden origin-top-right">
            <div class="p-4 font-bold border-b text-gray-800">Nouveaux Partages</div>
            <div id="notifications-list" class="p-2 max-h-96 overflow-y-auto">
                <!-- Notifications will be loaded here -->
            </div>
        </div>

        <!-- Trash Modal -->
        <div id="trash-modal"
            class="fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center z-[160] hidden"
            role="dialog">
            <div
                class="bg-card text-card-foreground border border-border rounded-xl p-6 w-11/12 max-w-md relative max-h-[80vh] flex flex-col">
                <button id="close-trash-modal" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600"
                    aria-label="Fermer">
                    <i class="fas fa-times text-xl"></i>
                </button>
                <div class="flex justify-between items-center mb-4 pr-8">
                    <h3 id="trash-modal-title" class="text-lg font-bold text-gray-800"><i
                            class="fas fa-trash-alt mr-2"></i>
                        Corbeille</h3>
                    <button id="empty-trash-btn"
                        class="text-sm text-red-500 hover:text-red-700 font-medium hover:underline hidden">
                        Vider tout
                    </button>
                </div>
                <div id="trash-list-container" class="flex-grow overflow-y-auto pr-2">
                    <!-- Deleted items will be generated here -->
                    <p class="text-center text-gray-500 italic py-4">La corbeille est vide.</p>
                </div>
            </div>
        </div>


        <!-- Ingredient Form Modal (Moved from Router) -->
        <div id="ingredient-form-modal"
            class="fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center z-[100] hidden">
            <div class="bg-white rounded-xl p-6 w-11/12 max-w-md relative">
                <button id="close-ingredient-modal"
                    class="absolute top-4 right-4 text-gray-400 hover:text-muted-foreground"><i
                        class="fas fa-times text-xl"></i></button>
                <h3 id="ingredient-modal-title" class="text-lg font-bold mb-4">Ajouter un Ingr√©dient</h3>
                <form id="ingredient-form" class="space-y-4">
                    <input type="hidden" id="ingredient-id">
                    <div>
                        <label for="ingredient-name" class="block text-sm font-medium text-gray-700">Nom</label>
                        <input type="text" id="ingredient-name"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" required>
                    </div>
                    <div>
                        <label for="ingredient-unit" class="block text-sm font-medium text-gray-700">Unit√© par
                            d√©faut</label>
                        <select id="ingredient-unit"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></select>
                    </div>
                    <div>
                        <label for="ingredient-category"
                            class="block text-sm font-medium text-gray-700">Cat√©gorie</label>
                        <select id="ingredient-category" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"
                            required></select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Saisonnalit√© (Optionnel)</label>
                        <!-- Seasons -->
                        <div class="grid grid-cols-2 gap-4 mb-2">
                            <!-- Printemps -->
                            <div class="border border-green-200 rounded-md p-3 bg-green-50">
                                <label class="flex items-center space-x-2 cursor-pointer mb-2 font-medium">
                                    <input type="checkbox" id="season-printemps" value="Printemps"
                                        class="form-checkbox h-4 w-4 text-green-600 focus:ring-green-500 season-checkbox"
                                        data-months="avril,mai,juin">
                                    <span class="text-sm text-green-800">Printemps üå∏</span>
                                </label>
                                <div class="ml-6 space-y-1 flex flex-col">
                                    <label
                                        class="flex items-center space-x-2 cursor-pointer text-xs text-gray-700 hover:text-green-700">
                                        <input type="checkbox" id="month-avril" value="Avril"
                                            class="form-checkbox h-3 w-3 text-green-500 month-checkbox rounded-sm"
                                            data-season="Printemps">
                                        <span>Avril</span>
                                    </label>
                                    <label
                                        class="flex items-center space-x-2 cursor-pointer text-xs text-gray-700 hover:text-green-700">
                                        <input type="checkbox" id="month-mai" value="Mai"
                                            class="form-checkbox h-3 w-3 text-green-500 month-checkbox rounded-sm"
                                            data-season="Printemps">
                                        <span>Mai</span>
                                    </label>
                                    <label
                                        class="flex items-center space-x-2 cursor-pointer text-xs text-gray-700 hover:text-green-700">
                                        <input type="checkbox" id="month-juin" value="Juin"
                                            class="form-checkbox h-3 w-3 text-green-500 month-checkbox rounded-sm"
                                            data-season="Printemps">
                                        <span>Juin</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Et√© -->
                            <div class="border border-yellow-200 rounded-md p-3 bg-yellow-50">
                                <label class="flex items-center space-x-2 cursor-pointer mb-2 font-medium">
                                    <input type="checkbox" id="season-ete" value="Et√©"
                                        class="form-checkbox h-4 w-4 text-yellow-600 focus:ring-yellow-500 season-checkbox"
                                        data-months="juillet,aout,septembre">
                                    <span class="text-sm text-yellow-800">Et√© ‚òÄÔ∏è</span>
                                </label>
                                <div class="ml-6 space-y-1 flex flex-col">
                                    <label
                                        class="flex items-center space-x-2 cursor-pointer text-xs text-gray-700 hover:text-yellow-700">
                                        <input type="checkbox" id="month-juillet" value="Juillet"
                                            class="form-checkbox h-3 w-3 text-yellow-500 month-checkbox rounded-sm"
                                            data-season="Et√©">
                                        <span>Juillet</span>
                                    </label>
                                    <label
                                        class="flex items-center space-x-2 cursor-pointer text-xs text-gray-700 hover:text-yellow-700">
                                        <input type="checkbox" id="month-aout" value="Ao√ªt"
                                            class="form-checkbox h-3 w-3 text-yellow-500 month-checkbox rounded-sm"
                                            data-season="Et√©">
                                        <span>Ao√ªt</span>
                                    </label>
                                    <label
                                        class="flex items-center space-x-2 cursor-pointer text-xs text-gray-700 hover:text-yellow-700">
                                        <input type="checkbox" id="month-septembre" value="Septembre"
                                            class="form-checkbox h-3 w-3 text-yellow-500 month-checkbox rounded-sm"
                                            data-season="Et√©">
                                        <span>Septembre</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Automne -->
                            <div class="border border-orange-200 rounded-md p-3 bg-orange-50">
                                <label class="flex items-center space-x-2 cursor-pointer mb-2 font-medium">
                                    <input type="checkbox" id="season-automne" value="Automne"
                                        class="form-checkbox h-4 w-4 text-orange-600 focus:ring-orange-500 season-checkbox"
                                        data-months="octobre,novembre,decembre">
                                    <span class="text-sm text-orange-800">Automne üçÇ</span>
                                </label>
                                <div class="ml-6 space-y-1 flex flex-col">
                                    <label
                                        class="flex items-center space-x-2 cursor-pointer text-xs text-gray-700 hover:text-orange-700">
                                        <input type="checkbox" id="month-octobre" value="Octobre"
                                            class="form-checkbox h-3 w-3 text-orange-500 month-checkbox rounded-sm"
                                            data-season="Automne">
                                        <span>Octobre</span>
                                    </label>
                                    <label
                                        class="flex items-center space-x-2 cursor-pointer text-xs text-gray-700 hover:text-orange-700">
                                        <input type="checkbox" id="month-novembre" value="Novembre"
                                            class="form-checkbox h-3 w-3 text-orange-500 month-checkbox rounded-sm"
                                            data-season="Automne">
                                        <span>Novembre</span>
                                    </label>
                                    <label
                                        class="flex items-center space-x-2 cursor-pointer text-xs text-gray-700 hover:text-orange-700">
                                        <input type="checkbox" id="month-decembre" value="D√©cembre"
                                            class="form-checkbox h-3 w-3 text-orange-500 month-checkbox rounded-sm"
                                            data-season="Automne">
                                        <span>D√©cembre</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Hiver -->
                            <div class="border border-blue-200 rounded-md p-3 bg-blue-50">
                                <label class="flex items-center space-x-2 cursor-pointer mb-2 font-medium">
                                    <input type="checkbox" id="season-hiver" value="Hiver"
                                        class="form-checkbox h-4 w-4 text-blue-600 focus:ring-blue-500 season-checkbox"
                                        data-months="janvier,fevrier,mars">
                                    <span class="text-sm text-blue-800">Hiver ‚ùÑÔ∏è</span>
                                </label>
                                <div class="ml-6 space-y-1 flex flex-col">
                                    <label
                                        class="flex items-center space-x-2 cursor-pointer text-xs text-gray-700 hover:text-blue-700">
                                        <input type="checkbox" id="month-janvier" value="Janvier"
                                            class="form-checkbox h-3 w-3 text-blue-500 month-checkbox rounded-sm"
                                            data-season="Hiver">
                                        <span>Janvier</span>
                                    </label>
                                    <label
                                        class="flex items-center space-x-2 cursor-pointer text-xs text-gray-700 hover:text-blue-700">
                                        <input type="checkbox" id="month-fevrier" value="F√©vrier"
                                            class="form-checkbox h-3 w-3 text-blue-500 month-checkbox rounded-sm"
                                            data-season="Hiver">
                                        <span>F√©vrier</span>
                                    </label>
                                    <label
                                        class="flex items-center space-x-2 cursor-pointer text-xs text-gray-700 hover:text-blue-700">
                                        <input type="checkbox" id="month-mars" value="Mars"
                                            class="form-checkbox h-3 w-3 text-blue-500 month-checkbox rounded-sm"
                                            data-season="Hiver">
                                        <span>Mars</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label for="ingredient-image-url" class="block text-sm font-medium text-gray-700">URL de
                            l'image</label>
                        <input type="text" id="ingredient-image-url"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"
                            placeholder="Laisser vide pour une image al√©atoire">
                    </div>
                    <div class="flex justify-end space-x-4 pt-2">
                        <button type="button" id="cancel-ingredient-btn"
                            class="text-gray-700 hover:bg-gray-100 px-4 py-2 rounded-md">Annuler</button>
                        <button type="submit" id="save-ingredient-btn" class="btn btn-primary">Sauvegarder</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Unit Selection Modal -->
        <div id="unit-select-modal"
            class="fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center z-[150] hidden">
            <div class="bg-card text-card-foreground border border-border rounded-xl p-6 w-11/12 max-w-sm">
                <h3 id="unit-modal-title" class="text-lg font-bold mb-4">Choisir une unit√©</h3>
                <div id="unit-modal-list" class="flex flex-wrap gap-2">
                    <!-- Units will be injected here by JS -->
                </div>
                <div class="flex justify-end mt-6">
                    <button id="unit-modal-cancel" class="btn btn-ghost">Annuler</button>
                </div>
            </div>
        </div>

        <!-- Plan History Modal -->
        <div id="plan-history-modal"
            class="fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center z-[100] hidden"
            role="dialog">
            <div
                class="bg-card text-card-foreground border border-border rounded-xl p-6 w-11/12 max-w-2xl relative max-h-[80vh] flex flex-col">
                <button id="close-plan-history-modal" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600"
                    aria-label="Fermer">
                    <i class="fas fa-times text-xl"></i>
                </button>
                <h3 class="text-lg font-bold mb-4">Historique des modifications</h3>
                <div id="plan-history-list" class="flex-grow overflow-y-auto border-t pt-4">
                    <!-- History items will be generated here -->
                </div>
            </div>
        </div>

        <!-- Feedback Modal -->
        <div id="feedback-modal"
            class="fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center z-[120] hidden"
            role="dialog">
            <div class="bg-white rounded-xl p-6 w-11/12 max-w-lg relative shadow-2xl overflow-y-auto max-h-[90vh]">
                <button id="close-feedback-modal"
                    class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors">
                    <i class="fas fa-times text-xl"></i>
                </button>

                <h2 class="text-2xl font-bold text-tomato mb-2 flex items-center">
                    <i class="fas fa-comment-dots mr-2"></i> Votre avis compte !
                </h2>
                <p class="text-gray-600 text-sm mb-6">Aidez-nous √† am√©liorer GustoPlan en signalant un bug ou en
                    partageant vos id√©es.</p>

                <form id="feedback-modal-form" class="space-y-4">
                    <!-- Type Selection -->
                    <div class="grid grid-cols-3 gap-3">
                        <label class="cursor-pointer">
                            <input type="radio" name="feedback-type" value="bug" class="peer sr-only" required checked>
                            <div
                                class="border-2 border-gray-200 rounded-lg p-3 text-center peer-checked:border-tomato peer-checked:bg-tomato/5 transition-all text-gray-600 hover:bg-gray-50 flex flex-col items-center">
                                <i class="fas fa-bug text-xl mb-1"></i>
                                <span class="text-xs font-semibold">Bug</span>
                            </div>
                        </label>
                        <label class="cursor-pointer">
                            <input type="radio" name="feedback-type" value="feature" class="peer sr-only">
                            <div
                                class="border-2 border-gray-200 rounded-lg p-3 text-center peer-checked:border-tomato peer-checked:bg-tomato/5 transition-all text-gray-600 hover:bg-gray-50 flex flex-col items-center">
                                <i class="fas fa-lightbulb text-xl mb-1"></i>
                                <span class="text-xs font-semibold">Id√©e</span>
                            </div>
                        </label>
                        <label class="cursor-pointer">
                            <input type="radio" name="feedback-type" value="avis" class="peer sr-only">
                            <div
                                class="border-2 border-gray-200 rounded-lg p-3 text-center peer-checked:border-tomato peer-checked:bg-tomato/5 transition-all text-gray-600 hover:bg-gray-50 flex flex-col items-center">
                                <i class="fas fa-heart text-xl mb-1"></i>
                                <span class="text-xs font-semibold">Avis</span>
                            </div>
                        </label>
                    </div>

                    <!-- Message -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Votre message</label>
                        <textarea id="feedback-message" rows="4"
                            class="w-full rounded-md border-gray-300 shadow-sm focus:border-tomato focus:ring-tomato resize-none"
                            placeholder="D√©crivez le probl√®me ou votre suggestion..." required></textarea>
                    </div>

                    <!-- Contact -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Email (facultatif)</label>
                        <input type="email" id="feedback-email"
                            class="w-full rounded-md border-gray-300 shadow-sm focus:border-tomato focus:ring-tomato"
                            placeholder="Pour vous recontacter si besoin">
                    </div>

                    <div class="flex justify-end pt-4">
                        <button type="submit" class="btn btn-primary w-full sm:w-auto">
                            <i class="fas fa-paper-plane mr-2"></i> Envoyer
                        </button>
                    </div>
                </form>
            </div>
        </div>
        <script>
            // Direct script to handle profile dropdown
            document.addEventListener('DOMContentLoaded', function () {
                const profileBtn = document.getElementById('profile-btn');
                const profileMenu = document.getElementById('profile-menu');

                if (profileBtn && profileMenu) {
                    profileBtn.onclick = function (e) {
                        e.stopPropagation();
                        profileMenu.classList.toggle('hidden');
                    };

                    document.addEventListener('click', function (e) {
                        if (!profileBtn.contains(e.target) && !profileMenu.contains(e.target)) {
                            profileMenu.classList.add('hidden');
                        }
                    });
                }
            });
        </script>
</body>

</html>