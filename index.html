<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>GustoPlan - Planificateur Intelligent</title>
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
      }
    </script>
    <!-- Font Awesome pour les icônes -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;500;600;700&family=Raleway:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Lien vers le fichier CSS Personnalisé -->
    <!-- jsPDF and FileSaver for PDF/TXT Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <script type="module" crossorigin src="/assets/main-CKBNYHZs.js"></script>
  <link rel="modulepreload" crossorigin href="/assets/firebase-config-DRNfbNj5.js">
  <link rel="stylesheet" crossorigin href="/assets/main-CoAz2X4c.css">
</head>
<body class="bg-body-bg">
    
    <!-- Mobile Navigation -->
    <div class="md:hidden fixed bottom-0 left-0 right-0 bg-white shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] z-50">
        <div class="flex justify-around items-center py-3">
            <a href="#" class="flex flex-col items-center text-tomato" aria-label="Accueil">
                <i class="fas fa-home text-xl"></i>
                <span class="text-xs mt-1">Accueil</span>
            </a>
            <a href="#meal-planning-section" class="flex flex-col items-center text-gray-500 hover:text-tomato" aria-label="Planning">
                <i class="fas fa-calendar-alt text-xl"></i>
                <span class="text-xs mt-1">Planning</span>
            </a>
            <a href="#shopping-list-section" class="flex flex-col items-center text-gray-500 hover:text-tomato" aria-label="Courses">
                <i class="fas fa-list text-xl"></i>
                <span class="text-xs mt-1">Courses</span>
            </a>
            <a href="#ai-suggestions-section" class="flex flex-col items-center text-gray-500 hover:text-tomato" aria-label="Suggestions IA">
                <i class="fas fa-robot text-xl"></i>
                <span class="text-xs mt-1">IA</span>
            </a>
        </div>
    </div>

    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg sticky top-0 z-40">
        <div class="container mx-auto px-4 py-3">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-2">
                    <i class="fas fa-utensils text-2xl"></i>
                    <h1 class="text-xl md:text-2xl font-bold">GustoPlan</h1>
                </div>

                <!-- Hamburger Menu for Mobile -->
                <div class="md:hidden flex items-center space-x-4">
                    <!-- Notifications Bell for Mobile -->
                    <div class="relative">
                        <button id="notifications-btn-mobile" class="btn btn-icon text-white" aria-label="Notifications">
                            <i class="fas fa-envelope text-2xl"></i>
                            <span id="notifications-badge-mobile" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center hidden">0</span>
                        </button>
                    </div>
                    <button id="mobile-menu-btn" class="text-white focus:outline-none">
                        <i class="fas fa-bars text-2xl"></i>
                    </button>
                </div>

                <!-- Desktop Navigation -->
                <div class="hidden md:flex items-center space-x-3">
                    <button id="voice-btn" class="btn btn-icon bg-white text-tomato rounded-full hover:bg-gray-100" aria-label="Commande vocale">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <button id="menu-btn" data-path="menu" class="btn bg-tomato text-white rounded-full text-sm nav-btn">Mon Menu</button>
                    <button id="plans-btn" data-path="plans" class="btn bg-white text-tomato rounded-full hover:bg-gray-100 text-sm nav-btn">Mes Plans</button>
                    <button id="recipes-btn" data-path="recipes" class="btn bg-white text-tomato rounded-full hover:bg-gray-100 text-sm nav-btn">Mes Recettes</button>
                    <button id="ingredients-btn" data-path="ingredients" class="btn bg-white text-tomato rounded-full hover:bg-gray-100 text-sm nav-btn">Mes Ingrédients</button>
                    <button id="lists-btn" data-path="lists" class="btn bg-white text-tomato rounded-full hover:bg-gray-100 text-sm nav-btn">Mes Listes</button>
                    <button id="friends-btn" data-path="friends" class="btn bg-white text-tomato rounded-full hover:bg-gray-100 text-sm nav-btn">Amis</button>
                    <button id="shared-btn" data-path="shared" class="btn bg-white text-tomato rounded-full hover:bg-gray-100 text-sm nav-btn">Contenus partagés</button>

                    <!-- Notifications Bell -->
                    <div class="relative">
                        <button id="notifications-btn" class="btn btn-icon bg-white text-tomato rounded-full hover:bg-gray-100" aria-label="Notifications">
                            <i class="fas fa-envelope"></i>
                            <span id="notifications-badge" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center hidden">0</span>
                        </button>
                    </div>

                    <span id="user-display-name" class="text-sm font-medium hidden md:inline-block mr-4"></span>
                    <!-- Profile Dropdown -->
                    <div class="relative inline-block text-left">
                        <div>
                            <button type="button" id="profile-btn" class="btn bg-white text-tomato rounded-full hover:bg-gray-100 text-sm" aria-expanded="true" aria-haspopup="true">
                                <i class="fas fa-user mr-2"></i> Mon Profil
                            </button>
                        </div>

                        <div id="profile-menu" class="hidden origin-top-right absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none" role="menu" aria-orientation="vertical" aria-labelledby="menu-button" tabindex="-1">
                            <div class="py-1" role="none">
                                <a href="#" class="text-gray-700 block px-4 py-2 text-sm" role="menuitem" tabindex="-1" id="profile-details-link">Détail du profil</a>
                                <a href="#" class="text-gray-700 block px-4 py-2 text-sm" role="menuitem" tabindex="-1" id="settings-link">Paramètres</a>
                            </div>
                        </div>
                    </div>
                    <button id="logout-btn" class="btn bg-red-500 text-white rounded-full hover:bg-red-600 text-sm">
                        <i class="fas fa-sign-out-alt mr-2"></i> Déconnexion
                    </button>
                </div>
            </div>

            <!-- Mobile Menu Panel -->
            <div id="mobile-menu" class="hidden md:hidden">
                <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                    <button data-path="menu" class="nav-btn-mobile text-white hover:bg-tomato-dark block w-full text-left rounded-md px-3 py-2 font-medium">Mon Menu</button>
                    <button data-path="plans" class="nav-btn-mobile text-white hover:bg-tomato-dark block w-full text-left rounded-md px-3 py-2 font-medium">Mes Plans</button>
                    <button data-path="recipes" class="nav-btn-mobile text-white hover:bg-tomato-dark block w-full text-left rounded-md px-3 py-2 font-medium">Mes Recettes</button>
                    <button data-path="ingredients" class="nav-btn-mobile text-white hover:bg-tomato-dark block w-full text-left rounded-md px-3 py-2 font-medium">Mes Ingrédients</button>
                    <button data-path="lists" class="nav-btn-mobile text-white hover:bg-tomato-dark block w-full text-left rounded-md px-3 py-2 font-medium">Mes Listes</button>
                    <button data-path="friends" class="nav-btn-mobile text-white hover:bg-tomato-dark block w-full text-left rounded-md px-3 py-2 font-medium">Amis</button>
                    <button data-path="shared" class="nav-btn-mobile text-white hover:bg-tomato-dark block w-full text-left rounded-md px-3 py-2 font-medium">Contenus partagés</button>
                    <button id="profile-btn-mobile" class="text-white hover:bg-tomato-dark block w-full text-left rounded-md px-3 py-2 font-medium">Mon Profil</button>
                    <button id="logout-btn-mobile" class="text-white bg-red-500 hover:bg-red-600 block w-full text-left rounded-md px-3 py-2 font-medium">Déconnexion</button>
                </div>
            </div>
        </div>
    </header>

    <div id="firebase-status" class="text-center text-sm py-1 hidden"></div>

    <!-- Main Content -->
    <main class="mx-auto px-2 py-6 md:py-8 pb-20 md:pb-8"></main>

    <!-- Tooltip pour les plats -->
    <div id="meal-tooltip" class="hidden fixed bg-white shadow-lg rounded-lg p-4 text-sm text-gray-800 z-50">
        <h4 id="tooltip-title" class="font-bold mb-2"></h4>
        <ul id="tooltip-ingredients" class="list-disc pl-4"></ul>
    </div>

    <!-- Tooltip for long meal names -->
    <div id="name-tooltip" class="hidden fixed bg-gray-800 text-white text-xs rounded py-1 px-2 z-50"></div>

    <!-- Footer -->
    <footer class="bg-eggplant text-white py-8 hidden md:block">
        <div class="container mx-auto px-4">
            <!-- Footer content -->
             <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-lg font-bold mb-4">GustoPlan</h3>
                    <p class="text-gray-300 text-sm">Votre assistant personnel pour des repas sains, économiques et savoureux.</p>
                </div>
                <div>
                    <h3 class="text-lg font-bold mb-4">Navigation</h3>
                    <ul class="space-y-2 text-sm">
                        <li><a href="#" class="text-gray-300 hover:text-white transition">Accueil</a></li>
                        <li><a href="#meal-planning-section" class="text-gray-300 hover:text-white transition">Planification</a></li>
                        <li><a href="#ai-suggestions-section" class="text-gray-300 hover:text-white transition">Recettes IA</a></li>
                        <li><a href="#community-section" class="text-gray-300 hover:text-white transition">Communauté</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-bold mb-4">Aide</h3>
                    <ul class="space-y-2 text-sm">
                        <li><a href="#" class="text-gray-300 hover:text-white transition">FAQ</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-white transition">Contact</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-white transition">Conditions</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-white transition">Confidentialité</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-bold mb-4">Suivez-nous</h3>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-300 hover:text-white transition" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="text-gray-300 hover:text-white transition" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="text-gray-300 hover:text-white transition" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                        <a href="#" class="text-gray-300 hover:text-white transition" aria-label="Pinterest"><i class="fab fa-pinterest"></i></a>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-8 pt-6 text-center text-gray-400 text-sm">
                <p>© 2023 GustoPlan. Tous droits réservés.</p>
            </div>
        </div>
    </footer>

    <!-- Modals -->

    <!-- Import List Modal -->
    <div id="import-list-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[100] hidden" role="dialog">
        <div class="bg-white rounded-xl p-6 w-11/12 max-w-lg relative">
            <button id="close-import-list-modal" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600" aria-label="Fermer">
                <i class="fas fa-times text-xl"></i>
            </button>
            <h3 id="import-list-modal-title" class="text-lg font-bold mb-4">Importer une liste de courses</h3>
            <div id="import-list-container" class="max-h-96 overflow-y-auto">
                <!-- List of saved shopping lists will be generated here -->
            </div>
        </div>
    </div>

    <!-- Voice Assistant Modal -->
    <div id="voice-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[100] hidden" role="dialog" aria-modal="true" aria-labelledby="voice-modal-title">
        <div class="bg-white rounded-xl p-6 w-11/12 max-w-md relative">
            <button id="close-voice-modal" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600" aria-label="Fermer">
                <i class="fas fa-times text-xl"></i>
            </button>
            <h3 id="voice-modal-title" class="text-lg md:text-xl font-bold text-center mb-4">Assistant vocal</h3>
            <div class="text-center py-6">
                <div id="voice-icon-container" class="w-16 h-16 bg-tomato bg-opacity-10 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i id="voice-icon" class="fas fa-microphone text-tomato text-2xl transition-transform duration-200"></i>
                </div>
                <p id="voice-status" class="text-gray-700 font-medium min-h-[1.5em]">Prêt à écouter</p>
                <p id="voice-result" class="text-sm text-gray-500 mt-2 min-h-[2.5em]">Dites "Ajoute du poulet à la liste" ou "Quel est le repas de demain midi ?"</p>
            </div>
            <div class="flex justify-center">
                <button id="toggle-listening-btn" class="btn btn-primary rounded-full px-6 py-3">
                    <i class="fas fa-microphone mr-2"></i> Parler
                </button>
            </div>
        </div>
    </div>

    <!-- Recipe Details Modal -->
    <div id="recipe-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[100] hidden" role="dialog" aria-modal="true" aria-labelledby="recipe-modal-title">
        <div class="bg-white rounded-xl p-4 md:p-6 w-11/12 max-w-2xl max-h-[90vh] overflow-y-auto relative">
             <button id="close-recipe-modal" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600 z-10" aria-label="Fermer la recette">
                <i class="fas fa-times text-xl"></i>
            </button>
            <!-- Contenu chargé par JS -->
            <div id="recipe-modal-content" class="opacity-0 transition-opacity duration-300">
                <div class="flex flex-col sm:flex-row justify-between sm:items-start mb-3 md:mb-4">
                    <div>
                        <h3 id="recipe-modal-title" class="text-xl md:text-2xl font-bold pr-8">Chargement...</h3>
                        <div class="flex items-center mt-1 space-x-2">
                            <span id="recipe-modal-score" class="nutrition-score score-c">?</span>
                            <span id="recipe-modal-info" class="text-xs md:text-sm text-gray-600">€?.?? • ?? min • ? pers.</span>
                             <span id="recipe-modal-tags" class="text-xs"></span><!-- Tags like Végé, Saison -->
                        </div>
                    </div>
                     <img id="recipe-modal-image" src="https://placehold.co/150x100.png?text=GustoPlan" alt="Image du plat" class="w-full sm:w-32 md:w-40 h-auto rounded-lg object-cover mt-3 sm:mt-0 flex-shrink-0">
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6 mt-4">
                    <div class="md:col-span-2">
                        <h4 class="font-bold text-base md:text-lg mb-2">Ingrédients</h4>
                        <ul id="recipe-modal-ingredients" class="space-y-1 text-sm md:text-base">
                            <li>Chargement...</li>
                        </ul>

                        <h4 class="font-bold text-base md:text-lg mt-4 md:mt-6 mb-2">Préparation</h4>
                        <ol id="recipe-modal-steps" class="list-decimal list-inside space-y-2 text-sm md:text-base">
                             <li>Chargement...</li>
                        </ol>
                    </div>

                    <div>
                        <h4 class="font-bold text-base md:text-lg mb-2">Nutrition (indicatif)</h4>
                        <div id="recipe-modal-nutrition" class="bg-gray-50 p-3 rounded-lg space-y-1 text-xs md:text-sm">
                            <div class="flex justify-between"><span class="text-gray-600">Calories</span> <span class="font-medium">--- kcal</span></div>
                            <!-- Autres nutriments -->
                        </div>

                        <div id="recipe-modal-tip-section" class="mt-4 md:mt-6 hidden">
                            <h4 class="font-bold text-base md:text-lg mb-2">Astuce <i class="fas fa-lightbulb text-yellow-500"></i></h4>
                            <div class="bg-blue-50 p-3 rounded-lg">
                                <p id="recipe-modal-tip-text" class="text-sm text-blue-800">...</p>
                            </div>
                        </div>

                        <div class="mt-4 md:mt-6 space-y-2">
                            <button id="recipe-modal-add-plan-btn" class="btn btn-primary w-full btn-sm">
                                Ajouter au planning
                            </button>
                            <button id="recipe-modal-add-fav-btn" class="btn btn-outline w-full btn-sm">
                                <i class="far fa-heart mr-2"></i> Ajouter aux favoris
                            </button>
                             <button id="recipe-modal-remove-plan-btn" class="btn btn-ghost text-red-600 hover:bg-red-50 w-full btn-sm hidden">
                                <i class="fas fa-trash-alt mr-2"></i> Retirer du planning
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Spinner/Overlay (Optional) -->
    <div id="loading-overlay" class="fixed inset-0 bg-white bg-opacity-75 flex items-center justify-center z-[200] hidden">
        <i class="fas fa-spinner fa-spin text-tomato text-4xl"></i>
    </div>


    <!-- Create Plan Modal -->
    <div id="create-plan-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[100] hidden" role="dialog">
        <div class="bg-white rounded-xl p-6 w-11/12 max-w-md relative">
            <button id="close-create-plan-modal" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600" aria-label="Fermer">
                <i class="fas fa-times text-xl"></i>
            </button>
            <h3 class="text-lg font-bold mb-4">Créer un nouveau plan</h3>
            <form id="create-plan-form">
                <div class="space-y-4">
                                    <div>
                                        <label for="plan-name" class="block text-sm font-medium text-gray-700">Nom du plan</label>
                                        <input type="text" id="plan-name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-tomato focus:ring-tomato" required>
                                    </div>                </div>
                <div class="flex justify-end space-x-4 mt-6">
                    <button type="button" id="cancel-create-plan-btn" class="btn btn-ghost">Annuler</button>
                    <button type="submit" class="btn btn-primary">Créer</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Rename Plan Modal -->
    <div id="rename-plan-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[100] hidden" role="dialog">
        <div class="bg-white rounded-xl p-6 w-11/12 max-w-md relative">
            <button id="close-rename-plan-modal" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600" aria-label="Fermer">
                <i class="fas fa-times text-xl"></i>
            </button>
            <h3 class="text-lg font-bold mb-4">Renommer le plan</h3>
            <form id="rename-plan-form">
                <div>
                    <label for="new-plan-name" class="block text-sm font-medium text-gray-700">Nouveau nom du plan</label>
                    <input type="text" id="new-plan-name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-tomato focus:ring-tomato" required>
                </div>
                <div class="flex justify-end space-x-4 mt-6">
                    <button type="button" id="cancel-rename-plan-btn" class="btn btn-ghost">Annuler</button>
                    <button type="submit" class="btn btn-primary">Renommer</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-confirm-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[150] hidden" role="dialog">
        <div class="bg-white rounded-xl p-6 w-11/12 max-w-sm text-center">
            <h3 id="delete-confirm-title" class="text-lg font-bold mb-4">Confirmer la suppression</h3>
            <p id="delete-confirm-message" class="text-gray-600 mb-6">Êtes-vous sûr de vouloir supprimer cet élément ?</p>
            <div class="flex justify-center space-x-4">
                <button id="cancel-delete-btn" class="btn btn-ghost">Annuler</button>
                <button id="confirm-delete-btn" class="btn bg-red-500 text-white hover:bg-red-600">Supprimer</button>
            </div>
                </div>
            </div>
        
            <!-- Save Plan As Modal -->
            <div id="save-plan-as-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[100] hidden" role="dialog">
                <div class="bg-white rounded-xl p-6 w-11/12 max-w-md relative">
                    <button id="close-save-plan-as-modal" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600" aria-label="Fermer">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                    <h3 class="text-lg font-bold mb-4">Nommer la sauvegarde</h3>
                    <form id="save-plan-as-form">
                        <div>
                            <label for="save-plan-name" class="block text-sm font-medium text-gray-700">Nom de la sauvegarde</label>
                            <input type="text" id="save-plan-name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-tomato focus:ring-tomato" required>
                        </div>
                        <div class="flex justify-end space-x-4 mt-6">
                            <button type="button" id="cancel-save-plan-as-btn" class="btn btn-ghost">Annuler</button>
                            <button type="submit" class="btn btn-primary">Enregistrer</button>
                        </div>
                    </form>
                </div>
            </div>
        
            <!-- Meal Selection Modal -->
    <div id="meal-select-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[100] hidden" role="dialog">
        <div class="bg-white rounded-xl p-6 w-11/12 max-w-lg relative">
            <button id="close-meal-select-modal" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600" aria-label="Fermer">
                <i class="fas fa-times text-xl"></i>
            </button>
            <h3 id="meal-select-modal-title" class="text-lg font-bold mb-4">Sélectionner un plat</h3>
            <div id="meal-select-list" class="max-h-96 overflow-y-auto">
                <!-- Meal list will be generated here -->
            </div>
        </div>
    </div>


    <!-- Recipe EDIT Form Modal -->
    <div id="edit-recipe-form-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[100] hidden">
        <div class="bg-white rounded-xl p-6 w-11/12 max-w-3xl max-h-[90vh] overflow-y-auto relative">
            <button id="close-edit-recipe-modal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600" aria-label="Fermer">
                <i class="fas fa-times text-xl"></i>
            </button>
            <h3 id="edit-recipe-modal-title" class="text-2xl font-bold mb-6">Modifier la recette</h3>
            <form id="edit-recipe-form" class="space-y-4">
                <input type="hidden" id="edit-recipe-id">
                
                <!-- Main Details Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="md:col-span-2">
                        <label for="edit-recipe-name" class="block text-sm font-medium text-gray-700">Nom de la recette</label>
                        <input type="text" id="edit-recipe-name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-tomato focus:ring-tomato" required>
                    </div>
                    <div class="md:col-span-2">
                        <label for="edit-recipe-image-url" class="block text-sm font-medium text-gray-700">URL de l'image</label>
                        <input type="text" id="edit-recipe-image-url" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-tomato focus:ring-tomato" placeholder="Laisser vide pour une image aléatoire">
                    </div>
                    <div>
                        <label for="edit-recipe-category" class="block text-sm font-medium text-gray-700">Catégorie</label>
                        <select id="edit-recipe-category" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-tomato focus:ring-tomato" required>
                            <option>ENTREE</option>
                            <option>PLAT</option>
                            <option>ACCOMPAGNEMENT</option>
                            <option>DESSERT</option>
                        </select>
                    </div>
                    <div>
                        <label for="edit-recipe-servings" class="block text-sm font-medium text-gray-700">Nombre de personnes</label>
                        <input type="number" id="edit-recipe-servings" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-tomato focus:ring-tomato" min="1">
                    </div>
                    <div>
                        <label for="edit-recipe-prep-time" class="block text-sm font-medium text-gray-700">Temps de préparation (min)</label>
                        <input type="number" id="edit-recipe-prep-time" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-tomato focus:ring-tomato" min="0">
                    </div>
                     <div>
                        <label for="edit-recipe-difficulty" class="block text-sm font-medium text-gray-700">Difficulté</label>
                        <select id="edit-recipe-difficulty" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-tomato focus:ring-tomato">
                            <option>Très facile</option>
                            <option>Facile</option>
                            <option>Moyen</option>
                            <option>Difficile</option>
                        </select>
                    </div>
                </div>

                <!-- Ingredients Section -->
                <div>
                    <h4 class="text-lg font-medium text-gray-800 mb-2">Ingrédients</h4>
                    <div id="edit-ingredients-list" class="space-y-2"></div>
                    <button type="button" id="edit-add-ingredient-btn" class="btn btn-outline btn-sm mt-2">
                        <i class="fas fa-plus mr-2"></i> Ajouter un ingrédient
                    </button>
                </div>

                <!-- Steps Section -->
                <div>
                    <label for="edit-recipe-steps" class="block text-lg font-medium text-gray-800">Préparation</label>
                    <textarea id="edit-recipe-steps" rows="8" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-tomato focus:ring-tomato"></textarea>
                </div>

                <!-- Form Actions -->
                <div class="flex justify-end space-x-4 pt-4">
                    <button type="button" id="edit-cancel-recipe-btn" class="btn btn-ghost">Annuler</button>
                    <button type="submit" id="edit-save-recipe-btn" class="btn btn-primary">Sauvegarder</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Share Modal -->
    <div id="share-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[100] hidden" role="dialog">
        <div class="bg-white rounded-xl p-6 w-11/12 max-w-lg relative">
            <button id="close-share-modal" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600" aria-label="Fermer">
                <i class="fas fa-times text-xl"></i>
            </button>
            <h3 id="share-modal-title" class="text-lg font-bold mb-4">Partager</h3>
            <div id="share-friends-list" class="max-h-64 overflow-y-auto border rounded-lg p-2 mb-4">
                <!-- Friend list for sharing will be generated here -->
            </div>
            <div id="share-mode-selection" class="my-4 space-y-2">
                <div>
                    <label class="flex items-center p-2 border rounded-lg cursor-pointer hover:bg-gray-50">
                        <input type="radio" name="share-mode" value="collaborate" class="form-radio h-5 w-5 text-tomato focus:ring-tomato" checked>
                        <span class="ml-3">
                            <span class="block font-medium">Inviter à collaborer</span>
                            <span class="block text-sm text-gray-500">L'ami pourra modifier le plan original.</span>
                        </span>
                    </label>
                </div>
                <div>
                    <label class="flex items-center p-2 border rounded-lg cursor-pointer hover:bg-gray-50">
                        <input type="radio" name="share-mode" value="copy" class="form-radio h-5 w-5 text-tomato focus:ring-tomato">
                        <span class="ml-3">
                            <span class="block font-medium">Envoyer une copie</span>
                            <span class="block text-sm text-gray-500">L'ami recevra une copie indépendante du plan.</span>
                        </span>
                    </label>
                </div>
            </div>
            <div class="flex justify-end">
                <button id="confirm-share-btn" class="btn btn-primary">Envoyer le partage</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[100] hidden" role="dialog">
        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 w-11/12 max-w-md relative">
            <button id="close-settings-modal" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600" aria-label="Fermer">
                <i class="fas fa-times text-xl"></i>
            </button>
            <h3 class="text-lg font-bold mb-4 text-gray-900 dark:text-white">Paramètres</h3>
            <div class="space-y-4">
                <div class="flex items-center justify-between p-3 border rounded-lg dark:border-gray-700">
                    <span class="font-medium text-gray-700 dark:text-gray-300">Mode Sombre</span>
                    <label for="dark-mode-toggle" class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="dark-mode-toggle" class="sr-only peer">
                        <div class="w-11 h-6 bg-gray-200 rounded-full peer dark:bg-gray-700 peer-focus:ring-4 peer-focus:ring-tomato-300 dark:peer-focus:ring-tomato-800 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-tomato"></div>
                    </label>
                </div>
            </div>
        </div>
    </div>

    <!-- Notifications Dropdown -->
    <div id="notifications-dropdown" class="absolute right-0 mt-2 w-80 bg-white rounded-xl shadow-lg z-50 hidden origin-top-right">
        <div class="p-4 font-bold border-b text-gray-800">Nouveaux Partages</div>
        <div id="notifications-list" class="p-2 max-h-96 overflow-y-auto">
            <!-- Notifications will be loaded here -->
        </div>
    </div>


    <!-- Unit Selection Modal -->
    <div id="unit-select-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[150] hidden">
        <div class="bg-white rounded-xl p-6 w-11/12 max-w-sm">
            <h3 id="unit-modal-title" class="text-lg font-bold mb-4">Choisir une unité</h3>
            <div id="unit-modal-list" class="flex flex-wrap gap-2">
                <!-- Units will be injected here by JS -->
            </div>
            <div class="flex justify-end mt-6">
                <button id="unit-modal-cancel" class="btn btn-ghost">Annuler</button>
            </div>
        </div>
    </div>

    <!-- Plan History Modal -->
    <div id="plan-history-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[100] hidden" role="dialog">
        <div class="bg-white rounded-xl p-6 w-11/12 max-w-2xl relative max-h-[80vh] flex flex-col">
            <button id="close-plan-history-modal" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600" aria-label="Fermer">
                <i class="fas fa-times text-xl"></i>
            </button>
            <h3 class="text-lg font-bold mb-4">Historique des modifications</h3>
            <div id="plan-history-list" class="flex-grow overflow-y-auto border-t pt-4">
                <!-- History items will be generated here -->
            </div>
        </div>
    </div>
</body>
</html>